!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],factory):factory(root.Stratus,root._)}(this,function(Stratus,_){Stratus.Controllers.InvoiceProductFilter=["$scope","$log",function($scope,$log){function filter(type,data){$scope.collection.meta.set(type,data),$scope.collection.fetch().then(function(response){$log.log("response:",response)})}Stratus.Instances[_.uniqueId("invoice_product_filter_")]=$scope,$scope.Stratus=Stratus,$scope._=_,$scope.timeStart=null,$scope.timeEnd=null,$scope.status=[{desc:"Cancelled",value:-1},{desc:"Active",value:1},{desc:"Pending Activation",value:0}],$scope.showOnly=[],$scope.billingIncrementOptions={i:"Minutely",h:"Hourly",d:"Daily",w:"Weekly",m:"Monthly",q:"Quarterly",y:"Yearly"},$scope.toggle=function(value){var index=$scope.showOnly.indexOf(value);-1!==index?$scope.showOnly.splice(index,1):$scope.showOnly.push(value),filter("api.options.invoiceStatus",$scope.showOnly)},$scope.getStatus=function(invoiceProduct){var currentTime=Math.floor(Date.now()),timeEnd=invoiceProduct.timeEnd?invoiceProduct.timeEnd:currentTime+1e3,timeStart=invoiceProduct.timeStart||currentTime+1e3;return timeEnd<=currentTime?"cancelled":currentTime<timeStart?"pendingActivation":timeStart<=currentTime&&currentTime<=timeEnd?"active":void 0},$scope.filterSite=function(siteId){filter("api.options.siteId",siteId)},$scope.filterProduct=function(productContentId){filter("api.options.productContentId",productContentId)},$scope.filterDateRanger=function(){$scope.timeStart&&$scope.timeEnd&&angular.isDate($scope.timeStart)&&angular.isDate($scope.timeEnd)&&($scope.timeStart=new Date($scope.timeStart),$scope.timeEnd=new Date($scope.timeEnd),$scope.collection.meta.set("api.options.timeStart",$scope.timeStart.getTime()/1e3),$scope.collection.meta.set("api.options.timeEnd",$scope.timeEnd.getTime()/1e3),$scope.collection.fetch().then(function(response){$log.log("response:",response)}))},$scope.getSiteName=function(siteId,siteList){var siteName;return siteList.length>0?(siteList.forEach(function(site){site.id===siteId&&(siteName=site.name)}),siteName):"Site Name"},$scope.getTags=function(contentId,tagList){var tags=[];return tagList.length>0?(tagList.forEach(function(tag){contentId===tag.assets[0].id&&-1==tags.indexOf($scope.upperFirst(tag.name))&&tags.push($scope.upperFirst(tag.name))}),"("+tags.toString()+")"):""},$scope.upperFirst=function(string){return string.charAt(0).toUpperCase()+string.slice(1)}}]});