!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.collection","stratus.services.commonMethods"],factory):factory(root.Stratus,root._)}(this,function(Stratus,_){Stratus.Controllers.UserFilter=["$scope","$log","collection","commonMethods",function($scope,$log,collection,commonMethods){function retrieveData(url,query){return commonMethods.sendRequest(null,"GET",url+query).then(function(response){return response.hasOwnProperty("data")&&response.data.hasOwnProperty("payload")?response.data.payload:[]},function(error){console.error(error)})}(Stratus.Instances[_.uniqueId("user_filter_")]=$scope).Stratus=Stratus,$scope._=_,$scope.userRoles=[],$scope.showOnly=[],$scope.more=!1,$scope.getStatus=function(member){return status="",member.flags&&($scope.isVerify(member)||(status="unverified")),status},$scope.isVerify=function(member){return!(!member||!member.flags)&&-1!=member.flags.findIndex(function(x){return x.flagType&&"verify"==x.flagType.title})},$scope.init=function(){(collection=new collection).target="Role",collection.urlRoot="/Api/Role",collection.fetch().then(function(response){$scope.userRoles=response})},$scope.toggle=function(roleId){var index=$scope.showOnly.indexOf(roleId);-1!==index?$scope.showOnly.splice(index,1):$scope.showOnly.push(roleId),$scope.collection.meta.set("api.options.identityRoles",$scope.showOnly),$scope.collection.fetch().then(function(response){$log.log("users",response)}),delete $scope.collection.meta.get("api").options},$scope.moreFilter=function(){$scope.more=!$scope.more},$scope.locationCustom=function(chip){return angular.isObject(chip)?chip:{address:chip}},$scope.queryRole=function(query){return retrieveData("/Api/Role?p=1&q=",query)},$scope.queryMailList=function(query){return retrieveData("/Api/MailList?p=1&q=",query)},$scope.queryLocation=function(query){return retrieveData("/Api/Location?p=1&q=",query)}}]});