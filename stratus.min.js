//     Stratus.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,e){"function"==typeof define&&define.amd?define(["text","jquery","underscore","backbone","bowser","promise","jquery-cookie"],function(n,o,i,s,r){return t.Stratus=e(n,o,i,s,r)}):t.Stratus=e(t.text,t.$,t._,t.Backbone,t.bowser)}(this,function(t,e,n,o,i){n.templateSettings={evaluate:/\{%(.+?)%\}/g,interpolate:/\{\{(.+?)\}\}/g,escape:/\{#(.+?)#\}/g};var s={Settings:{image:{size:{xs:200,s:400,m:600,l:800,xl:1200,hq:1600}},status:{reset:-2,deleted:-1,inactive:0,active:1},consent:{reject:-1,pending:0,accept:1}},DOM:{},Key:{},PostMessage:{},BaseUrl:(requirejs&&n.has(requirejs.s.contexts._,"config")?requirejs.s.contexts._.config.baseUrl:null)||"/",Collections:new o.Model,Models:new o.Model,Routers:new o.Model,Views:{Plugins:{},Widgets:{}},Events:{},Relations:{},Apps:{},Catalog:{},Components:{},Controllers:{},Directives:{},Filters:{},Services:{},Client:i,CSS:{},Chronos:null,Cookies:null,Environment:new o.Model({ip:null,production:!("string"==typeof document.cookie&&document.cookie.indexOf("env=")!==-1),language:navigator.language,timezone:null,trackLocation:0,trackLocationConsent:0,lat:null,lng:null,postalCode:null,city:null,region:null,country:null,debugNest:!1,liveEdit:!1,viewPortChange:!1,lastScroll:!1}),History:{},Instances:{},Internals:{},Prototypes:{},Resources:{},PluginMethods:{},RegisterGroup:{},Api:{GoogleMaps:"AIzaSyBatGvzPR7u7NZ3tsCy93xj4gEBfytffyA"}};return s.Environment.get("production")||console.group("Stratus Warm Up"),n.mixin({ucfirst:function(t){return"string"==typeof t&&t?t.charAt(0).toUpperCase()+t.substring(1):null},lcfirst:function(t){return"string"==typeof t&&t?t.charAt(0).toLowerCase()+t.substring(1):null},converge:function(t,e){if("string"!=typeof e&&(e="min"),"min"===e){var o=n.min(t);return n.findKey(t,function(t){return t===o})}if("radial"===e);else if("gauss"!==e)return t},repeat:function(t,e){if("function"==typeof t&&"number"==typeof e){var n;for(n=0;n<e;n++)t()}else console.warn("Underscore cannot repeat function:",t,"with number of times:",e)},hydrate:function(t){return n.isJSON(t)?JSON.parse(t):t},hydrateString:function(t){return n.hydrate(t)},cloneDeep:function(t){if("object"!=typeof t)return t;var e=n.clone(t);return n.each(e,function(t,o){e[o]=n.cloneDeep(t)}),e},getUrlParams:function(t,e){var n={};return e="undefined"!=typeof e?e:window.location.href,e.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,o){n[e]=o}),"undefined"!=typeof t&&t?n[t]:n},allTrue:function(t){return"object"==typeof t&&n.every(t,function(t){return t})},isJSON:function(t){try{JSON.parse(t)}catch(e){return!1}return!0},seconds:function(t){var e=0;if("string"==typeof t){var o=t.match(/([\d+\.]*[\d+])(?=[sSmMhHdDwWyY]+)([sSmMhHdDwWyY]+)/gi);if(n.size(o)){var i,s,r,a=/([\d+\.]*[\d+])(?=[sSmMhHdDwWyY]+)([sSmMhHdDwWyY]+)/i;n.each(o,function(t){if(i=a.exec(t),r=parseFloat(i[1]),s=i[2],!isNaN(r)){switch(i[2]){case"s":s=1;break;case"m":s=60;break;case"h":s=3600;break;case"d":s=86400;break;case"w":s=604800;break;case"y":s=31558149.504;break;default:s=0}e+=r*s}},this)}else e=null}else e="number"==typeof t?t:null;return e},startsWith:function(t,e){return t.substr(0,e.length).toUpperCase()==e.toUpperCase()},truncate:function(t,e,n){e=e||100,n=n||"...";for(var o,i,s,r,a,l=t.replace(/</g,"\n<").replace(/>/g,">\n").replace(/\n\n/g,"\n").replace(/^\n/g,"").replace(/\n$/g,"").split("\n"),u=0,c=[],d=!1,f=0;f<l.length;f++){o=l[f];var h=o.replace(/[ ]+/g," ");if(o.length){if("<"!==o[0])if(u>=e)o="";else if(u+h.length>=e){if(i=e-u," "===o[i-1])for(;i&&(i-=1," "===o[i-1]););else s=o.substring(i).split("").indexOf(" "),s!==-1?i+=s:i=o.length;o=o.substring(0,i)+n,u=e,d=!0}else u+=h.length;else if(u>=e)if(r=o.match(/[a-zA-Z]+/),a=r?r[0]:"")if("</"!==o.substring(0,2))c.push(a),o="";else{for(;c[c.length-1]!==a&&c.length;)c.pop();c.length&&(o=""),c.pop()}else o="";l[f]=o}}return l.join("\n").replace(/\n/g,"")}}),e.fn.isJSON=function(t){try{JSON.parse(t)}catch(e){return!1}return!0},e.fn.dataAttr=function(t,n){return void 0===t&&console.error("$().dataAttr(key, value) contains an undefined key!"),void 0===n?(n=this.attr("data-"+t),e.fn.isJSON(n)?JSON.parse(n):n):this.attr("data-"+t,JSON.stringify(n))},e.fn.notClicked=function(t){return this.selector||console.error("No Selector:",this),!sandbox(t.target).closest(this.selector).length&&!sandbox(t.target).parents(this.selector).length},s.Internals.LoadEnvironment=function(){var t=document.querySelector("body").getAttribute("data-environment");n.isJSON(t)&&(t=JSON.parse(t)),t&&"object"==typeof t&&n.size(t)&&s.Environment.set(t)},s.Instances.Clean=function(t){return"undefined"==typeof t?console.error("Stratus.Instances.Clean() requires a string or array containing Unique ID(s)."):"string"==typeof t&&(t=[t]),!("object"!=typeof t||!Array.isArray(t))&&void n.each(t,function(t){n.has(s.Instances,t)&&("function"==typeof s.Instances[t].remove&&s.Instances[t].remove(),delete s.Instances[t])})},s.Prototypes.Error=function(t,e){this.code="Internal",this.message="No discernible data received.",this.chain=[],"string"==typeof t?this.message=t:t&&"object"==typeof t&&n.extend(this,t),this.chain.push(e)},s.Prototypes.Dispatch=function(){return n.extend(this,o.Events)},s.Prototypes.Chronos=o.Model.extend({initialize:function(t){s.Environment.get("production")||console.info("Chronos Invoked!"),this.on("change",this.synchronize,this)},synchronize:function(){n.each(this.changed,function(t,e){"string"==typeof e&&e.indexOf(".")!==-1&&(e=n.first(e.split(".")),t=this.get(e)),!t.code&&t.enabled?t.code=setInterval(function(t){t.func.call(t.scope)},1e3*t.time,t):t.code&&!t.enabled&&(clearInterval(t.code),t.code=0)},this)},add:function(t,e,o){var i=null;return t=n.seconds(t),null!==t&&"function"==typeof e&&(i=n.uniqueId("job_"),o=o||window,this.set(i,{time:t,func:e,scope:o,code:0,enabled:!1})),i},enable:function(t){var e=this.has(t);return e&&this.set(t+".enabled",!0),e},disable:function(t){var e=this.has(t);return e&&this.set(t+".enabled",!1),e},toggle:function(t,e){var n=this.has(t);return n&&this.set(t+".enabled","boolean"==typeof e?e:!this.get(t+".enabled")),n}}),s.Chronos=new s.Prototypes.Chronos,s.Prototypes.Cookies=o.Model.extend({initialize:function(t){s.Environment.get("production")||console.info("Cookie Manager Invoked!"),this.on("change",this.synchronize,this)},synchronize:function(){n.each(this.changed,function(t,e){"string"==typeof e&&e.indexOf(".")!==-1&&(e=n.first(e.split(".")),t=this.get(e)),!t.code&&t.enabled?t.code=setInterval(function(t){t.func.call(t.scope)},1e3*t.time,t):t.code&&!t.enabled&&(clearInterval(t.code),t.code=0)},this)},add:function(t,e,o){var i=null;return t=n.seconds(t),null!==t&&"function"==typeof e&&(i=n.uniqueId("job_"),o=o||window,this.set(i,{time:t,func:e,scope:o,code:0,enabled:!1})),i},enable:function(t){var e=this.has(t);return e&&this.set(t+".enabled",!0),e},disable:function(t){var e=this.has(t);return e&&this.set(t+".enabled",!1),e},toggle:function(t,e){var n=this.has(t);return n&&this.set(t+".enabled","boolean"==typeof e?e:!this.get(t+".enabled")),n},retrieve:function(t){var e="(?:^"+t+"|;s*"+t+")=(.*?)(?:;|$)";console.log("search:",e);var n=new RegExp(e,"gi"),o=n.exec(document.cookie);return null===o?null:o[1]},create:function(t,e,n,o,i){var s=t+"="+escape(e)+";";n&&(n instanceof Date?isNaN(n.getTime())&&(n=new Date):n=new Date((new Date).getTime()+1e3*parseInt(n)*60*60*24),s+="expires="+n.toGMTString()+";"),o&&(s+="path="+o+";"),i&&(s+="domain="+i+";"),document.cookie=s},remove:function(t){this.retrieve(t)&&this.create(t,"",-1)}}),s.Cookies=new s.Prototypes.Cookies,s.Prototypes.Collection=function(t){return this.attributes={},this.temps={},this.toObject=function(t){return n.clone(this.attributes)},this.toJSON=function(t){return n.clone(this.attributes)},this.each=function(t,e){n.each.apply(void 0===e?this:e,n.union([this.attributes],arguments))},this.get=function(t){if("string"==typeof t&&t.indexOf(".")!==-1){var e=this.attributes,o=t.split(".");if(n.find(o,function(n){return"undefined"!=typeof e&&e&&"object"==typeof e?void(e=e[n]):(e=this.attributes[t],!0)},this),!n.isEqual(e,this.attributes))return e}return this.attributes[t]},this.has=function(t){return"undefined"!=typeof this.get(t)},this.size=function(){return n.size(this.attributes)},this.set=function(t,e){t&&"object"==typeof t?n.each(t,function(t,e){this.setAttribute(e,t)},this):this.setAttribute(t,e)},this.setAttribute=function(t,e){if("string"==typeof t&&t.indexOf(".")!==-1){var o=this.attributes,i=t.split(".");if(n.find(n.initial(i),function(t){return n.has(o,t)&&o[t]||(o[t]={}),"undefined"!=typeof o&&o&&"object"==typeof o?void(o=o[t]):(o=this.attributes,!0)},this),!n.isEqual(o,this.attributes)){var s=n.last(i);o&&"object"==typeof o&&(o[s]=e)}}else this.attributes[t]=e},this.temp=function(t,e){this.set(t,e),t&&"object"==typeof t?n.each(t,function(t,e){this.temps[e]=t},this):this.temps[t]=e},this.add=function(t,e){if(this.has(t)||this.set(t,[]),"undefined"!=typeof e&&!n.contains(this.attributes[t],e))return this.attributes[t].push(e),e},this.remove=function(t,e){return void 0===e||(this.attributes[t]=n.without(this.attributes[t],e)),this.attributes[t]},this.iterate=function(t){return this.has(t)||this.set(t,0),++this.attributes[t]},this.clear=function(){for(var t in this.attributes)this.attributes.hasOwnProperty(t)&&delete this.attributes[t]},this.clearTemp=function(){for(var t in this.temps)this.temps.hasOwnProperty(t)&&delete this.temps[t]},this.initialize=function(){return!0},this.initialize.apply(this,arguments),this},s.Internals.Ajax=function(t){this.method="GET",this.url="/Api",this.data={},this.type="",this.success=function(t){return t},this.error=function(t){return t},n.extend(this,t);var e=this;this.xhr=new XMLHttpRequest;var o=new Promise(function(t,o){e.xhr.open(e.method,e.url,!0),"string"==typeof e.type&&e.type.length&&e.xhr.setRequestHeader("Content-Type",e.type),e.xhr.onload=function(){if(e.xhr.status>=200&&e.xhr.status<400){var i=e.xhr.responseText;n.isJSON(i)&&(i=JSON.parse(i)),t(i)}else o(e.xhr)},e.xhr.onerror=function(){o(e.xhr)},Object.keys(e.data).length?e.xhr.send(JSON.stringify(e.data)):e.xhr.send()});return o.then(e.success,e.error),o},s.Internals.LoadCss=function(t){return new Promise(function(e,o){"undefined"!=typeof t&&"function"!=typeof t||o(new s.Prototypes.Error({code:"LoadCSS",message:"CSS Resource URLs must be defined as a String, Array, or Object."},this)),"string"==typeof t&&(t=[t]);var i={total:t.length,iteration:0};i.total>0?n.each(t.reverse(),function(t){i.iteration++;var r=n.uniqueId("css_");i[r]=!1,"undefined"!=typeof t&&t?s.Internals.CssLoader(t).then(function(t){i[r]=!0,i.total===i.iteration&&n.allTrue(i)&&e(i)},o):(i[r]=!0,i.total===i.iteration&&n.allTrue(i)&&e(i))}):o(new s.Prototypes.Error({code:"LoadCSS",message:"No CSS Resource URLs found!"},this))})},s.Internals.OnScroll=function(t){return!(!t||0===t.length)&&(s.Environment.on("change:viewPortChange",function(t){if(t.get("viewPortChange")){t.set("lastScroll",s.Internals.GetScrollDir());var o=s.RegisterGroup.get("OnScroll");n.each(o,function(t){"undefined"!=typeof t&&n.has(t,"method")&&t.method(t)}),t.set("viewPortChange",!1),t.set("windowTop",e(window).scrollTop())}}),e(window).scroll(function(){s.Environment.get("viewPortChange")===!1&&s.Environment.set("viewPortChange",!0)}),e(window).resize(function(){s.Environment.get("viewPortChange")===!1&&s.Environment.set("viewPortChange",!0)}),void s.Environment.set("viewPortChange",!0))},s.Internals.GetScrollDir=function(){var t=e(window).scrollTop(),n=s.Environment.get("windowTop"),o=e(window).height(),i=e(document).height(),r=!!n&&t>n,a=!!n&&(t<n&&t+o<i);return r?"down":!!a&&"up"},s.Internals.IsOnScreen=function(t,n){n=n||0;var o=e(window).scrollTop(),i=o+e(window).height(),s=t.offset().top,r=s+t.height();return r>=o+n&&s<=i-n},s.Internals.Anchor=o.View.extend({el:'a[href*=\\#]:not([href=\\#]):not([data-scroll="false"])',events:{click:"clickAction"},clickAction:function(t){if(location.pathname.replace(/^\//,"")===t.currentTarget.pathname.replace(/^\//,"")&&location.hostname===t.currentTarget.hostname){var i=["new","filter","page","version"],s=n.every(i,function(e){return!n.startsWith(t.currentTarget.hash,"#"+e)},this);if(s){var r=e(t.currentTarget.hash),a=t.currentTarget.hash.slice(1);if(r=r.length?r:e("[name="+a+"]"),r.length)return e("html,body").animate({scrollTop:r.offset().top},1e3,function(){o.history.navigate(a)}),!1}}}}),s.Internals.LazyLoad=o.View.extend({el:"img[data-src]",initialize:function(){if(0===this.$el.length)return!1;var t;n.each(this.$el,function(n){t=e(n),s.RegisterGroup.add("OnScroll",{method:s.Internals.LoadImage,el:t,spy:e(e(n).data("spy")?e(n).data("spy"):n)})})}}),s.Internals.LoadImage=function(t){if(t.el.addClass("placeholder"),s.Internals.IsOnScreen(t.spy)){var o=!0,i=t.el.data("src");"lazy"===i&&(i=t.el.attr("src"));var r=null;if(t.el.data("size")&&r.indexOf(t.el.data("size"))!==!1)r=t.el.data("size");else{var a=null,l=null,u=null;if(t.el.prop("style").width?a=t.el.prop("style").width:t.el.attr("width")&&(a=t.el.attr("width")),a){var c=/([\d]+)(.*)/;a=c.exec(a),l=a[2],a=parseInt(a[1]),u="%"===l?a/100:null}if(!a||"%"===l){var d=t.el.data("ignorevisibility")?null:":visible",f=e(n.first(t.el.parents(d)));a=f.width();var h=e(n.first(f.find('[class*="col-"]')));if(h.length>0){var p=s.Internals.GetColWidth(h);p&&(a=Math.round(a/p))}u&&(a=Math.round(a*u))}if(a<=0)return!1;o&&(a=2*a),r=n.findKey(s.Settings.image.size,function(t){var e=t/a;return.85<e&&e<1.15||t>a}),r=r||"hq"}var g=/^(.+?)(-[A-Z]{2})?\.(?=[^.]*$)(.+)/gi,y=g.exec(i);i=y[1]+"-"+r+"."+y[3],t.el.attr("src",i),t.el.addClass("loading"),t.el.load(function(){e(this).addClass("loaded").removeClass("placeholder loading")}),s.RegisterGroup.remove("OnScroll",t)}},s.Internals.GetColWidth=function(t){var e=t.attr("class"),n=/col-.{2}-([0-9]*)/g,o=n.exec(e);return"undefined"!=typeof o[1]&&o[1]},s.Internals.Location=function(t){return new Promise(function(e,o){"geolocation"in navigator?(t=n.extend({enableHighAccuracy:!0,timeout:2e4,maximumAge:5e4},t||{}),navigator.geolocation.getCurrentPosition(e,o,t)):o(new s.Prototypes.Error({code:"Location",message:"HTML5 Geo-Location isn't supported on this browser."},this))})},s.Internals.CssLoader=function(t){return new Promise(function(n,o){if(t in s.CSS)s.CSS[t]?n():s.Events.once("onload:"+t,n);else{s.CSS[t]=!1;var i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=t,s.Events.once("onload:"+t,function(){s.CSS[t]=!0,n()}),"onload"in i&&!s.Client.android?i.onload=function(){s.Events.trigger("onload:"+t)}:(s.CSS[t]=!0,s.Events.trigger("onload:"+t)),e("head").prepend(i)}})},s.Internals.Convoy=function(t,o){return new Promise(function(i,r){void 0===t&&r(new s.Prototypes.Error({code:"Convoy",message:"No Convoy defined for dispatch."},this)),e.ajax({type:"POST",url:"/Api"+encodeURIComponent(o||""),data:{convoy:JSON.stringify(t)},dataType:n.has(t,"meta")&&n.has(t.meta,"dataType")?t.meta.dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,headers:{"Access-Control-Allow-Origin":"*"},success:function(t){return i(t),t},error:function(t){return r(new s.Prototypes.Error({code:"Convoy",message:t},this)),t}})})},s.Internals.Api=function(t,e,o){return void 0===t&&(t="Default"),void 0!==e&&null!==e||(e={}),void 0===o&&(o={}),"object"!=typeof e&&(e={method:e}),n.has(e,"method")||(e.method="GET"),s.Internals.Convoy({route:{controller:t},meta:e,payload:o})},s.Internals.Resource=function(t,e){return new Promise(function(o,i){if("undefined"==typeof t&&i(new s.Prototypes.Error({code:"Resource",message:"Resource path is not defined."},this)),n.has(s.Resources,t))s.Resources[t].success?o(s.Resources[t].data):s.Events.once("resource:"+t,o);else{s.Resources[t]={success:!1,data:null},s.Events.once("resource:"+t,o);var r={path:t,dataType:"text"};void 0!==e&&(r.elementId=e),s.Internals.Api("Resource",r,{}).then(function(e){s.Resources[t].success=!0,s.Resources[t].data=e,s.Events.trigger("resource:"+t,e)},i)}})},s.Internals.Compatibility=function(){var t=[];s.Client.android?t.push("android"):s.Client.ios?t.push("ios"):s.Client.mac?t.push("mac"):s.Client.windows?t.push("windows"):s.Client.linux?t.push("linux"):t.push("os"),s.Client.chrome?t.push("chrome"):s.Client.firefox?t.push("firefox"):s.Client.safari?t.push("safari"):s.Client.opera?t.push("opera"):s.Client.msie?t.push("msie"):s.Client.iphone?t.push("iphone"):t.push("browser"),s.Client.version&&t.push("version"+s.Client.version.split(".")[0]),s.Client.mobile?t.push("mobile"):s.Client.tablet?t.push("tablet"):t.push("desktop"),e("body").addClass(t.join(" "))},s.Internals.View=o.Model.extend({toObject:function(){return n.clone(this.attributes)},hydrate:function(){var t=this.get("el");if(this.set({uid:n.uniqueId("view_"),guid:"undefined"!=typeof t.dataAttr("guid")?t.dataAttr("guid"):null,entity:"undefined"!=typeof t.dataAttr("entity")?n.ucfirst(t.dataAttr("entity")):null,id:"undefined"!=typeof t.dataAttr("id")?t.dataAttr("id"):null,manifest:"undefined"!=typeof t.dataAttr("manifest")?t.dataAttr("manifest"):null,api:"undefined"!=typeof t.dataAttr("api")?t.dataAttr("api"):null,fetch:"undefined"==typeof t.dataAttr("fetch")||t.dataAttr("fetch"),target:"undefined"!=typeof t.dataAttr("target")?t.dataAttr("target"):null,prototype:"undefined"!=typeof t.dataAttr("prototype")?t.dataAttr("prototype"):null,autoSave:"undefined"!=typeof t.dataAttr("autoSave")?t.dataAttr("autoSave"):null,type:"undefined"!=typeof t.dataAttr("type")?t.dataAttr("type"):null,types:"undefined"!=typeof t.dataAttr("types")?t.dataAttr("types"):null,template:"undefined"!=typeof t.dataAttr("template")?t.dataAttr("template"):null,templates:"undefined"!=typeof t.dataAttr("templates")?t.dataAttr("templates"):null,dialogue:"undefined"!=typeof t.dataAttr("dialogue")?t.dataAttr("dialogue"):null,pagination:"undefined"!=typeof t.dataAttr("pagination")?t.dataAttr("pagination"):null,property:"undefined"!=typeof t.dataAttr("property")?t.dataAttr("property"):null,field:"undefined"!=typeof t.dataAttr("field")?t.dataAttr("field"):null,load:"undefined"!=typeof t.dataAttr("load")?t.dataAttr("load"):null,options:"undefined"!=typeof t.dataAttr("options")?t.dataAttr("options"):null,versionEntity:"undefined"!=typeof t.dataAttr("versionentity")?t.dataAttr("versionentity"):null,versionRouter:"undefined"!=typeof t.dataAttr("versionrouter")?t.dataAttr("versionrouter"):null,versionId:"undefined"!=typeof t.dataAttr("versionid")?t.dataAttr("versionid"):null,plugin:"undefined"!=typeof t.dataAttr("plugin")?t.dataAttr("plugin"):null,plugins:[]}),null!==this.get("plugin")){var e=this.get("plugin").split(" ");null!==this.get("type")?this.set("plugins",e.length>1?e:[this.get("plugin")]):e.length>1&&(this.set("plugin",n.first(e)),this.set("plugins",n.rest(e)))}var o=this.get("id"),i=null!==this.get("type")?this.get("type"):this.get("plugin"),s=null!==this.get("type")?"widgets":"plugins";this.set({scope:null!==o?"model":"collection",alias:null!==i?"stratus.views."+s+"."+i.toLowerCase():null,path:null!==i?i:null}),this.isNew()&&null!==this.get("entity")&&null!==this.get("manifest")&&this.set("scope","model")},clean:function(){this.has("entity")&&"none"!==this.get("entity").toLowerCase()||this.set({entity:null,scope:null})},nest:function(){var t={entity:this.get("entity"),id:this.get("id"),versionEntity:this.get("versionEntity"),versionRouter:this.get("versionRouter"),versionId:this.get("versionId"),scope:this.get("scope"),manifest:this.get("manifest")};return this.has(t.scope)&&(t[t.scope]=this.get(t.scope)),t},modelAttributes:function(){return{id:this.get("id")}}}),s.Internals.Loader=function(t,o,i){if("undefined"==typeof t){var r=e("body");t=r.dataAttr("loaded")?null:"[data-entity],[data-plugin]",t?r.dataAttr("loaded",!0):console.warn("Attempting to load Stratus root repeatedly!")}return t&&(t=o&&t&&"object"==typeof t?e(t).find("[data-type],[data-plugin]"):e(t)),new Promise(function(e,r){var a={total:t&&"object"==typeof t?t.length:0,iteration:0,views:{}};a.total>0?t.each(function(t,l){a.iteration++;var u=n.uniqueId("entry_");a.views[u]=!1,s.Internals.ViewLoader(l,o,i).then(function(t){a.views[u]=t,a.total===a.iteration&&n.allTrue(a.views)&&e(a)},r)}):e(a)})},s.Internals.ViewLoader=function(t,o,i){var r=o?o:null,a=!1,l=e(t);if(o=new s.Internals.View({el:l}),o.hydrate(),r&&(o.has("entity")?a=!0:o.set(r.nest())),o.clean(),!a){"undefined"==typeof i&&(i=["stratus"]);var u=o.get("template"),c=o.get("templates"),d=o.get("dialogue"),f=[];if(null!==o.get("scope")&&i.push("stratus."+o.get("scope")+"s.generic"),o.get("alias")&&n.has(requirejs.s.contexts._.config.paths,o.get("alias")))i.push(o.get("alias"));else if(o.get("path")){i.push(o.get("path"));var h=/(?=[^\/]*$)([a-zA-Z]+)/i,p=h.exec(o.get("path"));o.set("type",n.ucfirst(p[1]))}else o.set({type:null,alias:null,path:null});if(null!==u&&(c=n.extend(null!==c?c:{},{combined:u})),null!==d&&(c=n.extend(null!==c?c:{},{dialogue:d})),null!==c){for(var g in c)if(c.hasOwnProperty(g)&&"function"!=typeof c[g])if(0===c[g].indexOf("#")){var y=e(c[g]);y.length>0&&(c[g]=y.html())}else c[g]in requirejs.s.contexts._.config.paths?(i.push("text!"+c[g]),f.push(g)):(i.push("text!"+c[g]),f.push(g));o.set("templates",c),c=o.get("templates")}}return new Promise(function(t,e){return o.get("guid")?(s.Environment.get("production")||console.warn("View hydration halted on",o.get("guid"),"due to repeat calls on the same element.",o.toObject()),t(!0),!0):a?(t(!0),!0):void require(i,function(s){!s.Environment.get("production")&&s.Environment.get("nestDebug")&&console.group("Stratus View");var r=0;if(c&&f.length>0)for(var a=0;a<arguments.length;a++)"string"==typeof arguments[a]&&(arguments[a].indexOf("<html")===-1?c[f[r]]=arguments[a]:console.error("Template",c[f[r]],"failed to load."),r++);o.set("templates",c),c=o.get("templates");var l=[];if(n.size(c)>0){var u=/<.+?data-type=["|'](.+?)["|'].*>/gi;n.each(c,function(t,e){if("string"==typeof t){if(t.search(u)!==-1)for(var i=u.exec(t);null!==i;){var r="stratus.views."+(o.get("plugin")?"plugins":"widgets")+"."+i[1].toLowerCase();r&&!n.has(requirejs.s.contexts._.config.paths,r)&&(s.Environment.get("production")||console.warn("Sub Type:",r,"not configured in require.js")),l.push(r),i=u.exec(t)}c[e]=n.template(t)}}),o.set("templates",c),c=o.get("templates")}o.get("plugins").length&&n.each(o.get("plugins"),function(t){l.push("stratus.views.plugins."+t.toLowerCase())});var d=[];null!==o.get("plugin")&&d.push("PluginLoader"),null!==o.get("type")&&d.push("WidgetLoader"),d.length||d.push("WidgetLoader"),n.each(d,function(r){0===n.size(l)?s.Internals[r](t,e,o,i):(i=n.union(i,l),new Promise(function(t,e){require(i,function(n){n.Internals[r](t,e,o,i)})}).then(t,e))})})})},s.Internals.WidgetLoader=function(t,e,o,i){if("model"===o.get("scope")){s.Models.has(o.get("entity"))||s.Models.set(o.get("entity"),s.Models.Generic.extend({}));var r,a,l=!1,u=s.Models.has(o.get("entity"))?s.Models.get(o.get("entity")):null;!o.get("id")&&o.get("manifest")?(a=o.get("entity")+"Manifest",r=s.Instances[a],r||(s.Instances[a]=new u,r=s.Instances[a],l=!0)):u&&n.has(u,"findOrCreate")?(r=u.findOrCreate(o.get("id")),r||(r=new u(o.modelAttributes()),l=!0)):(a=o.get("entity")+o.get("id"),r=s.Instances[a],r||(s.Instances[a]=new u(o.modelAttributes()),r=s.Instances[a],l=!0)),l&&r.safeInitialize(o.toObject()),o.set({model:r})}else if("collection"===o.get("scope")){s.Collections.has(o.get("entity"))||s.Collections.set(o.get("entity"),new s.Collections.Generic(o.toObject()));var c=s.Collections.get(o.get("entity"));!c.initialized&&o.get("fetch")&&c.safeInitialize(o.toObject()),o.set({collection:c})}if(null!==o.get("type")){var d=n.ucfirst(o.get("type"));if("undefined"!=typeof s.Views.Widgets[d]){var f=o.toObject();f.view=o,s.Instances[o.get("uid")]=new s.Views.Widgets[d](f),s.Instances[o.get("uid")].$el.attr("data-guid",o.get("uid")),n.has(s.Instances[o.get("uid")],"promise")?s.Instances[o.get("uid")].initializer.then(t,e):t(s.Instances[o.get("uid")])}else s.Environment.get("production")||console.warn("Stratus.Views.Widgets."+d+" is not correctly configured."),e(new s.Prototypes.Error({code:"WidgetLoader",message:"Stratus.Views.Widgets."+d+" is not correctly configured."},o.toObject()));!s.Environment.get("production")&&s.Environment.get("nestDebug")&&console.groupEnd()}else{var h=o.get("el").find("[data-type],[data-plugin]");h.length>0?s.Internals.Loader(o.get("el"),o,i).then(function(e){!s.Environment.get("production")&&s.Environment.get("nestDebug")&&console.groupEnd(),t(e)},function(t){!s.Environment.get("production")&&s.Environment.get("nestDebug")&&console.groupEnd(),e(new s.Prototypes.Error(t,h))}):!s.Environment.get("production")&&s.Environment.get("nestDebug")?(console.warn("No Innate or Nested Type Found:",o.toObject()),t(o.toObject()),console.groupEnd()):t(o.toObject())}},s.Internals.PluginLoader=function(t,e,o,i){var r=n.union([o.get("plugin")],o.get("plugins"));n.each(r,function(i){if(i=n.ucfirst(i),"undefined"!=typeof s.Views.Plugins[i]){var r=o.toObject();r.view=o,s.Instances[o.get("uid")]=new s.Views.Plugins[i](r),s.Instances[o.get("uid")].$el.attr("data-guid",o.get("uid")),n.has(s.Instances[o.get("uid")],"promise")?s.Instances[o.get("uid")].initializer.then(t,e):t(s.Instances[o.get("uid")])}else s.Environment.get("production")||console.warn("Stratus.Views.Plugins."+i+" is not correctly configured."),e(new s.Prototypes.Error({code:"PluginLoader",message:"Stratus.Views.Plugins."+i+" is not correctly configured."},o.toObject()))})},s.Internals.SetUrlParams=function(t,o){"undefined"==typeof o&&(o=window.location.href);var i={},s=o.indexOf("?");return o.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,e,n){i[e]=n}),i=n.extend(i,t),o=s>=0?o.substring(0,s):o,o+="?"+e.param(i)},s.Internals.UpdateEnvironment=function(t){t||(t={}),"object"==typeof t&&Object.keys(t).length&&s.Internals.Ajax({method:"PUT",url:"/Api/Session",data:t,type:"application/json",success:function(t){var e=t.payload||t;"object"==typeof e&&Object.keys(e).forEach(function(t){s.Environment.set(t,e[t])})},error:function(t){console.error("error:",t)}})},s.Internals.TrackLocation=function(){var t={};!s.Environment.has("timezone"),t.timezone=(new Date).toString().match(/\((.*)\)/)[1],s.Environment.get("trackLocation")?s.Environment.get("trackLocationConsent")?s.Internals.Location().then(function(e){t.lat=e.coords.latitude,t.lng=e.coords.longitude,s.Environment.set("lat",e.coords.latitude),s.Environment.set("lng",e.coords.longitude),s.Internals.UpdateEnvironment(t)},function(t){console.error("Stratus Location:",t)}):s.Internals.Ajax({url:"https://ipapi.co/"+s.Environment.get("ip")+"/json/",success:function(e){e||(e={}),"object"==typeof e&&Object.keys(e).length&&e.postal&&(t.postalCode=e.postal,t.lat=e.latitude,t.lng=e.longitude,t.city=e.city,t.region=e.region,t.country=e.country,s.Internals.UpdateEnvironment(t))}}):s.Internals.UpdateEnvironment(t)},s.Internals.TrackLocation(),s.PostMessage.Convoy=function(t){window.addEventListener("message",t,!1)},s.PostMessage.Convoy(function(t){if("https://auth.sitetheory.io"!==t.origin&&"http://admin.sitetheory.io"!==t.origin)return!1;var n=JSON.parse(t.data);n.meta.session&&n.meta.session!==e.cookie("SITETHEORY")&&(e.cookie("SITETHEORY",n.meta.session,{expires:365,path:"/"}),s.Client.safari||location.reload(!0))}),s.DOM.ready=function(t){"loading"!==document.readyState?t():document.addEventListener("DOMContentLoaded",t)},s.DOM.complete=function(t){"complete"===document.readyState?t():window.addEventListener("load",t)},s.DOM.unload=function(t){window.addEventListener("beforeunload",t)},s.Key.Enter=13,s.Key.Escape=27,n.extend(s.Events,o.Events),s.Events.on("initialize",function(){s.Environment.get("production")||(console.groupEnd(),console.group("Stratus Initialize")),s.Internals.LoadEnvironment(),s.Internals.Compatibility(),s.RegisterGroup=new s.Prototypes.Collection,require(["stratus.routers.generic"],function(){s.Routers.set("generic",new s.Routers.Generic),s.Instances[n.uniqueId("router.generic_")]=s.Routers.get("generic")}),(document.querySelectorAll("[ng-controller]").length||document.querySelectorAll("[flex]").length)&&require(["angular","angular-material","stratus.services.model","stratus.services.collection","stratus.services.registry","stratus.controllers.generic","stratus.filters.moment","stratus.filters.truncate","stratus.filters.gravatar","stratus.directives.datetime","stratus.directives.help","stratus.directives.optionValue","stratus.directives.pagination","stratus.directives.trigger","angular-chart","froala","froala-align","angular-froala","codemirror","codemirror/mode/htmlmixed/htmlmixed","codemirror/addon/edit/matchbrackets"],function(){e.FroalaEditor.DEFAULTS.key="KybxhzguB-7j1jC3A-16y==",angular.module("stratusApp",["ngMaterial","ngMessages","moment","truncate","gravatar","froala","stratus-date-time","stratus-help","stratus-option-value","stratus-pagination","stratus-trigger","chart.js"]),angular.module("stratusApp").config(s.Services.Model),angular.module("stratusApp").config(s.Services.Collection),angular.module("stratusApp").config(s.Services.Registry),angular.module("stratusApp").controller.apply(this,s.Controllers.Generic);var t=[];if(document.querySelectorAll("stratus-help").length&&t.push(s.BaseUrl+"sitetheorystratus/stratus/bower_components/font-awesome/css/font-awesome.min.css"),document.querySelectorAll("[froala]").length&&(t.push(s.BaseUrl+"sitetheorystratus/stratus/bower_components/froala-wysiwyg-editor/css/froala_editor.min.css"),t.push(s.BaseUrl+"sitetheorystratus/stratus/bower_components/froala-wysiwyg-editor/css/froala_style.min.css")),t.length){var n=0;angular.forEach(t,function(e){s.Internals.CssLoader(e).then(function(){++n===t.length&&angular.bootstrap(document.querySelector("html"),["stratusApp"])})})}else angular.bootstrap(document.querySelector("html"),["stratusApp"])}),s.Internals.Loader().then(function(t){s.Environment.get("production")||console.info("Views:",t),s.Events.on("finalize",function(t){o.History.started||o.history.start(),s.Events.trigger("finalized",t)}),s.Events.trigger("finalize",t)},function(t){console.error("Stratus Loader:",t)})}),s.Events.on("finalize",function(){s.Environment.get("production")||(console.groupEnd(),console.group("Stratus Finalize")),new s.Internals.Anchor,new s.Internals.LazyLoad,s.RegisterGroup.size&&s.RegisterGroup.each(function(t,e){n.has(s.Internals,e)&&s.Internals[e](t)})}),s.Events.on("terminate",function(){s.Environment.get("production")||(console.groupEnd(),console.group("Stratus Terminate"))}),s.Prototypes.Bootbox=function(t,e){t&&"object"==typeof t?(n.extend(this,t),this.message=this.message||"Message"):this.message=t||"Message",this.handler=this.handler||e,"function"!=typeof this.handler&&(this.handler=function(t){console.info("Client "+(void 0===t?"closed":t?"confirmed":"cancelled")+" dialog.")})},s.Events.on("alert",function(t,e){t instanceof s.Prototypes.Bootbox||(t=new s.Prototypes.Bootbox(t,e)),"undefined"!=typeof bootbox?bootbox.alert(t.message,t.handler):(alert(t.message),t.handler())}),s.Events.on("confirm",function(t,e){t instanceof s.Prototypes.Bootbox||(t=new s.Prototypes.Bootbox(t,e)),"undefined"!=typeof bootbox?bootbox.confirm(t.message,t.handler):e(confirm(t.message))}),s.Prototypes.Toast=function(t,e,o,i){t&&"object"==typeof t?(n.extend(this,t),this.message=this.message||"Message"):this.message=t||"Message",this.title=this.title||e||"Toast",this.priority=this.priority||o||"danger",this.settings=this.settings||i,this.settings&&"object"==typeof this.settings||(this.settings={}),this.settings.timeout=this.settings.timeout||1e4},s.Events.on("toast",function(t,n,o,i){t instanceof s.Prototypes.Toast||(t=new s.Prototypes.Toast(t,n,o,i)),"undefined"!=typeof e&&e.toaster?e.toaster(t):s.Events.trigger("alert",t.message)}),s.DOM.ready(function(){e("body").removeClass("loaded unloaded").addClass("loading"),s.Events.trigger("initialize")}),s.DOM.complete(function(){e("body").removeClass("loading unloaded").addClass("loaded")}),s.DOM.unload(function(t){
e("body").removeClass("loading loaded").addClass("unloaded"),s.Events.trigger("terminate",t)}),s});