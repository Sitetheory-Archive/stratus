!function(root,factory){"function"==typeof define&&define.amd?define(["text","underscore","bowser","jquery","promise","backbone"],function(text,_,bowser,jQuery){return root.Stratus=factory(text,_,bowser,jQuery)}):root.Stratus=factory(root.text,root._,root.bowser,root.jQuery)}(this,function(text,_,bowser,jQuery){let Stratus={Settings:{image:{size:{xs:200,s:400,m:600,l:800,xl:1200,hq:1600}},status:{reset:-2,deleted:-1,inactive:0,active:1},consent:{reject:-1,pending:0,accept:1}},DOM:{},Key:{},PostMessage:{},LocalStorage:{},Selector:{},Select:null,BaseUrl:(requirejs&&_.has(requirejs.s.contexts._,"config")?requirejs.s.contexts._.config.baseUrl:null)||"/",BundlePath:(requirejs&&_.has(requirejs.s.contexts._,"config")?requirejs.s.contexts._.config.bundlePath:"")||"",Collections:null,Models:null,Routers:null,Views:{Plugins:{},Widgets:{}},Events:{},Relations:{},Apps:{},Catalog:{},Compendium:{},Components:{},Controllers:{},Directives:{},Filters:{},Modules:{ngMaterial:!0,ngMessages:!0},Services:{},Client:bowser,CSS:{},Chronos:null,Environment:{ip:null,production:!("string"==typeof document.cookie&&-1!==document.cookie.indexOf("env=")),context:null,contextId:null,contextMasterSiteId:null,siteId:null,masterSiteId:null,language:navigator.language,timezone:null,trackLocation:0,trackLocationConsent:0,lat:null,lng:null,postalCode:null,city:null,region:null,country:null,debugNest:!1,liveEdit:!1,viewPortChange:!1,viewPort:null,lastScroll:!1},History:{},Instances:{},Internals:{},Loaders:{},Prototypes:{},Resources:{},Roster:{controller:{selector:"[ng-controller]",namespace:"stratus.controllers."},components:{namespace:"stratus.components."},directives:{namespace:"stratus.directives.",type:"attribute"},flex:{selector:"[flex]",require:["angular","angular-material"]},chart:{selector:"[chart]",require:["angular","angular-chart"],module:!0,suffix:".js"},sortable:{selector:"[ng-sortable]",require:["angular-sortable"],module:"ng-sortable"},modules:{selector:["[ng-sanitize]","[froala]"],namespace:"angular-",module:!0},countUp:{selector:["[count-up]","[scroll-spy]"],namespace:"angular-",module:!0,suffix:"Module"},uiTree:{selector:"[ui-tree]",require:["angular-ui-tree"],module:"ui.tree"}},PluginMethods:{},RegisterGroup:{},Api:{GoogleMaps:"AIzaSyBatGvzPR7u7NZ3tsCy93xj4gEBfytffyA",Froala:"FB2C2D2B1uB5A2B2D3A5F1D4E1A3B17hfE-13cA-9mrI-7sogE4in=="}};Stratus.Environment.production||console.group("Stratus Warm Up"),_.templateSettings={evaluate:/\{%(.+?)%\}/g,interpolate:/\{\{(.+?)\}\}/g,escape:/\{#(.+?)#\}/g},_.mixin({createClass:function(){function defineProperties(target,props){let i;for(i=0;i<props.length;i++){let descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),possibleConstructorReturn:function(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call},inherits:function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&Object.setPrototypeOf(subClass,superClass)},classCallCheck:function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},inherit:function(superClass,subClass){let blob=function(length){_.classCallCheck(this,blob);let that=_.possibleConstructorReturn(this,Object.getPrototypeOf(blob).call(this,length,length));return _.extend(that,subClass),that};return _.inherits(blob,superClass),blob},functionName:function(code){return _.isEmpty(code)?null:(_.isString(code)||(code=code.toString()),(code=code.substr("function ".length)).substr(0,code.indexOf("(")))},ucfirst:function(string){return"string"==typeof string&&string?string.charAt(0).toUpperCase()+string.substring(1):null},lcfirst:function(string){return"string"==typeof string&&string?string.charAt(0).toLowerCase()+string.substring(1):null},cookie:function(name,value,expires,path,domain){let request={name:name,value:value,expires:expires,path:path||"/",domain:domain};if(name&&"object"==typeof name&&_.extend(request,name),void 0===request.value){let data=new RegExp("(?:^"+request.name+"|;\\s*"+request.name+")=(.*?)(?:;|$)","g").exec(document.cookie);return null===data?null:data[1]}{let cookie=request.name+"="+escape(request.value)+";";request.expires&&(request.expires instanceof Date?isNaN(request.expires.getTime())&&(request.expires=new Date):request.expires=new Date((new Date).getTime()+1e3*_.seconds(request.expires)),cookie+="expires="+request.expires.toUTCString()+";"),request.path&&(cookie+="path="+request.path+";"),request.domain&&(cookie+="domain="+request.domain+";"),document.cookie=cookie}},converge:function(list,method){if("string"!=typeof method&&(method="min"),"min"===method){let lowest=_.min(list);return _.findKey(list,function(element){return element===lowest})}if("radial"===method);else if("gauss"!==method)return list},repeat:function(fn,times){if("function"==typeof fn&&"number"==typeof times){let i;for(i=0;i<times;i++)fn()}else console.warn("Underscore cannot repeat function:",fn,"with number of times:",times)},dehydrate:function(value){return"string"==typeof value?value:JSON.stringify(value)},hydrate:function(string){return _.isJSON(string)?JSON.parse(string):string},hydrateString:function(string){return _.hydrate(string)},cloneDeep:function(obj){if("object"!=typeof obj)return obj;let shallow=_.clone(obj);return _.each(shallow,function(value,key){shallow[key]=_.cloneDeep(value)}),shallow},extendDeep:function(target,merger){let shallow=_.clone(target);return merger&&"object"==typeof merger?_.each(merger,function(value,key){shallow&&"object"==typeof shallow&&(shallow[key]=key in shallow?_.extendDeep(shallow[key],merger[key]):merger[key])}):shallow=merger,shallow},getUrlParams:function(key,href){let lets={};return(href=void 0!==href?href:window.location.href).replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){lets[key]=value}),void 0!==key&&key?lets[key]:lets},allTrue:function(values){return"object"==typeof values&&_.every(values,function(value){return value})},isJSON:function(str){try{JSON.parse(str)}catch(e){return!1}return!0},isAngular:function(element){return"object"==typeof angular&&angular&&angular.element&&element instanceof angular.element},isjQuery:function(element){return"function"==typeof jQuery&&element instanceof jQuery},seconds:function(str){let seconds=0;if("string"==typeof str){let timePairs=str.match(/([\d+.]*[\d+])(?=[sSmMhHdDwWyY]+)([sSmMhHdDwWyY]+)/gi);if(_.size(timePairs)){let time,unit,value,digest=/([\d+.]*[\d+])(?=[sSmMhHdDwWyY]+)([sSmMhHdDwWyY]+)/i;_.each(timePairs,function(timePair){if(time=digest.exec(timePair),value=parseFloat(time[1]),unit=time[2],!isNaN(value)){switch(time[2]){case"s":unit=1;break;case"m":unit=60;break;case"h":unit=3600;break;case"d":unit=86400;break;case"w":unit=604800;break;case"y":unit=31558149.504;break;default:unit=0}seconds+=value*unit}},this)}else seconds=null}else seconds="number"==typeof str?str:null;return seconds},camelToKebab:function(target){return target.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},kebabToCamel:function(target){return target.replace(/(-\w)/g,function(m){return m[1].toUpperCase()})},camelToSnake:function(target){return target.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()},snakeToCamel:function(target){return target.replace(/(_\w)/g,function(m){return m[1].toUpperCase()})},startsWith:function(target,search){return"string"==typeof target&&target.substr(0,search.length).toUpperCase()===search.toUpperCase()},patch:function(newData,priorData){if(!_.isObject(newData)||!_.size(newData))return null;let patch={},processor={eax:void 0,ebx:void 0,ecx:void 0,edx:void 0};if(_.isObject(priorData)&&_.size(priorData)){let detect=function(value,key){processor.eax=processor.ecx?processor.ecx+"."+key:key,_.isObject(value)?(processor.ecx=processor.eax,_.each(value,detect),processor.ecx=processor.ecx===key?void 0:processor.ecx.substring(0,processor.ecx.lastIndexOf("."))):(processor.ebx=_.reduce(processor.eax.split("."),function(data,a){return data&&data[a]},priorData),processor.ebx!==value&&(processor.edx=value)),void 0!==processor.edx&&(patch[processor.eax]=value,processor.edx=void 0)};_.each(newData,detect)}else console.error("bad prior:",priorData);return patch&&_.size(patch)?patch:null},strcmp:function(a,b){let i,n;for(a=a.toString(),b=b.toString(),i=0,n=Math.max(a.length,b.length);i<n&&a.charAt(i)===b.charAt(i);++i);return i===n?0:a.charAt(i)>b.charAt(i)?-1:1},truncate:function(target,limit,suffix){limit=limit||100,suffix=suffix||"...";let row,cut,add,tagMatch,tagName,arr=target.replace(/</g,"\n<").replace(/>/g,">\n").replace(/\n\n/g,"\n").replace(/^\n/g,"").replace(/\n$/g,"").split("\n"),sum=0,tagStack=[];for(let i=0;i<arr.length;i++){let rowCut=(row=arr[i]).replace(/[ ]+/g," ");if(row.length){if("<"!==row[0])if(sum>=limit)row="";else if(sum+rowCut.length>=limit){if(" "===row[(cut=limit-sum)-1])for(;cut&&" "===row[(cut-=1)-1];);else-1!==(add=row.substring(cut).split("").indexOf(" "))?cut+=add:cut=row.length;row=row.substring(0,cut)+suffix,sum=limit}else sum+=rowCut.length;else if(sum>=limit)if(tagName=(tagMatch=row.match(/[a-zA-Z]+/))?tagMatch[0]:"")if("</"!==row.substring(0,2))tagStack.push(tagName),row="";else{for(;tagStack[tagStack.length-1]!==tagName&&tagStack.length;)tagStack.pop();tagStack.length&&(row=""),tagStack.pop()}else row="";arr[i]=row}}return arr.join("\n").replace(/\n/g,"")}}),"function"==typeof jQuery&&jQuery.fn&&(jQuery.fn.notClicked=function(event){return this.selector||this.context||console.error("No Selector or Context:",this),!jQuery(event.target).closest(this.selector||this.context).length&&!jQuery(event.target).parents(this.selector||this.context).length});let eventSplitter=/\s+/,eventsApi=function(iteratee,events,name,callback,opts){let names,i=0;if(name&&"object"==typeof name){void 0!==callback&&"context"in opts&&void 0===opts.context&&(opts.context=callback);for(names=_.keys(name);i<names.length;i++)events=eventsApi(iteratee,events,names[i],name[names[i]],opts)}else if(name&&eventSplitter.test(name))for(names=name.split(eventSplitter);i<names.length;i++)events=iteratee(events,names[i],callback,opts);else events=iteratee(events,name,callback,opts);return events};Stratus.Events.on=function(name,callback,context){return internalOn(this,name,callback,context)};let internalOn=function(obj,name,callback,context,listening){if(obj._events=eventsApi(onApi,obj._events||{},name,callback,{context:context,ctx:obj,listening:listening}),listening){(obj._listeners||(obj._listeners={}))[listening.id]=listening}return obj};Stratus.Events.listenTo=function(obj,name,callback){if(!obj)return this;let id=obj._listenId||(obj._listenId=_.uniqueId("l")),listeningTo=this._listeningTo||(this._listeningTo={}),listening=listeningTo[id];if(!listening){let thisId=this._listenId||(this._listenId=_.uniqueId("l"));listening=listeningTo[id]={obj:obj,objId:id,id:thisId,listeningTo:listeningTo,count:0}}return internalOn(obj,name,callback,this,listening),this};let onApi=function(events,name,callback,options){if(callback){let handlers=events[name]||(events[name]=[]),context=options.context,ctx=options.ctx,listening=options.listening;listening&&listening.count++,handlers.push({callback:callback,context:context,ctx:context||ctx,listening:listening})}return events};Stratus.Events.off=function(name,callback,context){return this._events?(this._events=eventsApi(offApi,this._events,name,callback,{context:context,listeners:this._listeners}),this):this},Stratus.Events.stopListening=function(obj,name,callback){let listeningTo=this._listeningTo;if(!listeningTo)return this;let i,ids=obj?[obj._listenId]:_.keys(listeningTo);for(i=0;i<ids.length;i++){let listening=listeningTo[ids[i]];if(!listening)break;listening.obj.off(name,callback,this)}return this};let offApi=function(events,name,callback,options){if(!events)return;let listening,i=0,context=options.context,listeners=options.listeners;if(!name&&!callback&&!context){let ids=_.keys(listeners);for(;i<ids.length;i++)delete listeners[(listening=listeners[ids[i]]).id],delete listening.listeningTo[listening.objId];return}let names=name?[name]:_.keys(events);for(;i<names.length;i++){let handlers=events[name=names[i]];if(!handlers)break;let remaining=[];for(let j=0;j<handlers.length;j++){let handler=handlers[j];callback&&callback!==handler.callback&&callback!==handler.callback._callback||context&&context!==handler.context?remaining.push(handler):(listening=handler.listening)&&0==--listening.count&&(delete listeners[listening.id],delete listening.listeningTo[listening.objId])}remaining.length?events[name]=remaining:delete events[name]}return events};Stratus.Events.once=function(name,callback,context){let events=eventsApi(onceMap,{},name,callback,_.bind(this.off,this));return"string"==typeof name&&null==context&&(callback=void 0),this.on(events,callback,context)},Stratus.Events.listenToOnce=function(obj,name,callback){let events=eventsApi(onceMap,{},name,callback,_.bind(this.stopListening,this,obj));return this.listenTo(obj,events)};let onceMap=function(map,name,callback,offer){if(callback){let once=map[name]=_.once(function(){offer(name,once),callback.apply(this,arguments)});once._callback=callback}return map};Stratus.Events.trigger=function(name){if(!this._events)return this;let i,length=Math.max(0,arguments.length-1),args=Array(length);for(i=0;i<length;i++)args[i]=arguments[i+1];return eventsApi(triggerApi,this._events,name,void 0,args),this};let triggerApi=function(objEvents,name,callback,args){if(objEvents){let events=objEvents[name],allEvents=objEvents.all;events&&allEvents&&(allEvents=allEvents.slice()),events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,[name].concat(args))}return objEvents},triggerEvents=function(events,args){let ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args)}};return Stratus.Events.bind=Stratus.Events.on,Stratus.Events.unbind=Stratus.Events.off,Stratus.Prototypes.Error=function(error,chain){this.code="Internal",this.message="No discernible data received.",this.chain=[],"string"==typeof error?this.message=error:error&&"object"==typeof error&&_.extend(this,error),this.chain.push(chain)},Stratus.Prototypes.Dispatch=function(){return _.extend(this,Stratus.Events)},Stratus.Prototypes.Job=function(time,method,scope){return this.enabled=!1,time&&"object"==typeof time?_.extend(this,time):(this.time=time,this.method=method,this.scope=scope),this.time=_.seconds(this.time),this.scope=this.scope||window,this},Stratus.Prototypes.Model=function(data){return this.data={},this.attributes=this.data,this.temps={},this.toObject=function(options){return _.clone(this.data)},this.toJSON=function(options){return _.clone(this.data)},this.each=function(callback,scope){_.each.apply(void 0===scope?this:scope,_.union([this.data],arguments))},this.get=function(attr){return _.reduce("string"==typeof attr?attr.split("."):[],function(attrs,a){return attrs&&attrs[a]},this.data)},this.has=function(attr){return void 0!==this.get(attr)},this.size=function(){return _.size(this.data)},this.set=function(attr,value){attr&&"object"==typeof attr?_.each(attr,function(value,attr){this.setAttribute(attr,value)},this):this.setAttribute(attr,value)},this.setAttribute=function(attr,value){if("string"==typeof attr)if(-1!==attr.indexOf(".")){let reference=this.data,chain=attr.split(".");if(_.find(_.initial(chain),function(link){if(_.has(reference,link)&&reference[link]||(reference[link]={}),void 0===reference||!reference||"object"!=typeof reference)return reference=this.data,!0;reference=reference[link]},this),!_.isEqual(reference,this.data)){let link=_.last(chain);!reference||"object"!=typeof reference||_.has(reference,link)&&_.isEqual(reference[link],value)||(reference[link]=value,this.trigger("change:"+attr,this))}}else _.has(this.data,attr)&&_.isEqual(this.data[attr],value)||(this.data[attr]=value,this.trigger("change:"+attr,this))},this.temp=function(attr,value){this.set(attr,value),attr&&"object"==typeof attr?_.each(attr,function(value,attr){this.temps[attr]=value},this):this.temps[attr]=value},this.add=function(attr,value){if(this.has(attr)||this.set(attr,[]),void 0!==value&&!_.contains(this.data[attr],value))return this.data[attr].push(value),value},this.remove=function(attr,value){return void 0===value||(this.data[attr]=_.without(this.data[attr],value)),this.data[attr]},this.iterate=function(attr){return this.has(attr)||this.set(attr,0),++this.data[attr]},this.clear=function(){for(let attribute in this.data)this.data.hasOwnProperty(attribute)&&delete this.data[attribute]},this.clearTemp=function(){for(let attribute in this.temps)this.temps.hasOwnProperty(attribute)&&delete this.temps[attribute]},this.initialize=function(){return!0},data&&_.extend(this.data,data),_.extend(this,Stratus.Events),this.reinitialize=function(){this.initialize.apply(this,arguments)}.bind(this),this.reinitialize(),this},Stratus.Collections=new Stratus.Prototypes.Model,Stratus.Models=new Stratus.Prototypes.Model,Stratus.Routers=new Stratus.Prototypes.Model,Stratus.Environment=new Stratus.Prototypes.Model(Stratus.Environment),Stratus.Prototypes.Sentinel=function(){return this.view=!1,this.create=!1,this.edit=!1,this.delete=!1,this.publish=!1,this.design=!1,this.dev=!1,this.master=!1,this.zero=function(){_.extend(this,{view:!1,create:!1,edit:!1,delete:!1,publish:!1,design:!1,dev:!1,master:!1})},this.permissions=function(value){if(isNaN(value)){let decimal=0;return decimal+=this.view?1:0,decimal+=this.create?2:0,decimal+=this.edit?4:0,decimal+=this.delete?8:0,decimal+=this.publish?16:0,decimal+=this.design?32:0,decimal+=this.dev?64:0,decimal+=this.master?128:0}_.each(value.toString(2).split("").reverse(),function(bit,key){if("1"===bit)switch(key){case 0:this.view=!0;break;case 1:this.create=!0;break;case 2:this.edit=!0;break;case 3:this.delete=!0;break;case 4:this.publish=!0;break;case 5:this.design=!0;break;case 6:this.dev=!0;break;case 7:this.view=!0,this.create=!0,this.edit=!0,this.delete=!0,this.publish=!0,this.design=!0,this.dev=!0,this.master=!0}},this)},this.summary=function(){let output=[];return _.each(this,function(value,key){"boolean"==typeof value&&value&&output.push(_.ucfirst(key))}),output},this},Stratus.Prototypes.Bootbox=function(message,handler){message&&"object"==typeof message?(_.extend(this,message),this.message=this.message||"Message"):this.message=message||"Message",this.handler=this.handler||handler,"function"!=typeof this.handler&&(this.handler=function(result){console.info("Client "+(void 0===result?"closed":result?"confirmed":"cancelled")+" dialog.")})},Stratus.Prototypes.Toast=function(message,title,priority,settings){message&&"object"==typeof message?(_.extend(this,message),this.message=this.message||"Message"):this.message=message||"Message",this.title=this.title||title||"Toast",this.priority=this.priority||priority||"danger",this.settings=this.settings||settings,this.settings&&"object"==typeof this.settings||(this.settings={}),this.settings.timeout=this.settings.timeout||1e4},Stratus.Internals.Ajax=function(request){this.method="GET",this.url="/Api",this.data={},this.type="",this.success=function(response){return response},this.error=function(response){return response},_.extend(this,request);let that=this;this.xhr=new window.XMLHttpRequest;let promise=new Promise(function(resolve,reject){that.xhr.open(that.method,that.url,!0),"string"==typeof that.type&&that.type.length&&that.xhr.setRequestHeader("Content-Type",that.type),that.xhr.onload=function(){if(that.xhr.status>=200&&that.xhr.status<400){let response=that.xhr.responseText;_.isJSON(response)&&(response=JSON.parse(response)),resolve(response)}else reject(that.xhr)},that.xhr.onerror=function(){reject(that.xhr)},Object.keys(that.data).length?that.xhr.send(JSON.stringify(that.data)):that.xhr.send()});return promise.then(that.success,that.error),promise},Stratus.Internals.Anchor=function Anchor(){return Anchor.initialize=!0,"object"!=typeof Backbone?Anchor:Backbone.View.extend({el:'a[href*=\\#]:not([href=\\#]):not([data-scroll="false"])',events:{click:"clickAction"},clickAction:function(event){if(window.location.pathname.replace(/^\//,"")===event.currentTarget.pathname.replace(/^\//,"")&&window.location.hostname===event.currentTarget.hostname){let reserved=["new","filter","page","version"];if(_.every(reserved,function(keyword){return!_.startsWith(event.currentTarget.hash,"#"+keyword)},this)&&"function"==typeof jQuery&&jQuery.fn&&"object"==typeof Backbone){let $target=jQuery(event.currentTarget.hash),anchor=event.currentTarget.hash.slice(1);if(($target=$target.length?$target:jQuery("[name="+anchor+"]")).length)return jQuery("html,body").animate({scrollTop:$target.offset().top},1e3,function(){Backbone.history.navigate(anchor)}),!1}}}})}(),Stratus.Internals.Api=function(route,meta,payload){return void 0===route&&(route="Default"),void 0!==meta&&null!==meta||(meta={}),void 0===payload&&(payload={}),"object"!=typeof meta&&(meta={method:meta}),_.has(meta,"method")||(meta.method="GET"),Stratus.Internals.Convoy({route:{controller:route},meta:meta,payload:payload})},Stratus.Internals.Compatibility=function(){let profile=[];Stratus.Client.android?profile.push("android"):Stratus.Client.ios?profile.push("ios"):Stratus.Client.mac?profile.push("mac"):Stratus.Client.windows?profile.push("windows"):Stratus.Client.linux?profile.push("linux"):profile.push("os"),Stratus.Client.chrome?profile.push("chrome"):Stratus.Client.firefox?profile.push("firefox"):Stratus.Client.safari?profile.push("safari"):Stratus.Client.opera?profile.push("opera"):Stratus.Client.msie?profile.push("msie"):Stratus.Client.iphone?profile.push("iphone"):profile.push("browser"),Stratus.Client.version&&profile.push("version"+Stratus.Client.version.split(".")[0]),Stratus.Client.mobile?profile.push("mobile"):Stratus.Client.tablet?profile.push("tablet"):profile.push("desktop"),Stratus("body").addClass(profile.join(" "))},Stratus.Internals.Convoy=function(convoy,query){return new Promise(function(resolve,reject){void 0===convoy&&reject(new Stratus.Prototypes.Error({code:"Convoy",message:"No Convoy defined for dispatch."},this)),"function"==typeof jQuery&&jQuery.ajax?jQuery.ajax({type:"POST",url:"/Api"+encodeURIComponent(query||""),data:{convoy:JSON.stringify(convoy)},dataType:_.has(convoy,"meta")&&_.has(convoy.meta,"dataType")?convoy.meta.dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,headers:{"Access-Control-Allow-Origin":"*"},success:function(response){return resolve(response),response},error:function(response){return reject(new Stratus.Prototypes.Error({code:"Convoy",message:response},this)),response}}):Stratus.Internals.Ajax({method:"POST",url:"/Api"+encodeURIComponent(query||""),data:{convoy:JSON.stringify(convoy)},type:_.has(convoy,"meta")&&_.has(convoy.meta,"dataType")?convoy.meta.dataType:"application/json",success:function(response){return response=response.payload||response,resolve(response),response},error:function(response){return reject(new Stratus.Prototypes.Error({code:"Convoy",message:response},this)),response}})})},Stratus.Internals.CssLoader=function(url){return new Promise(function(resolve,reject){if(url in Stratus.CSS)Stratus.CSS[url]?resolve():Stratus.Events.once("onload:"+url,resolve);else{Stratus.CSS[url]=!1;let link=document.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=url,Stratus.Events.once("onload:"+url,function(){Stratus.CSS[url]=!0,resolve()}),"onload"in link&&!Stratus.Client.android?link.onload=function(){Stratus.Events.trigger("onload:"+url)}:(Stratus.CSS[url]=!0,Stratus.Events.trigger("onload:"+url)),Stratus("head").append(link)}})},Stratus.Internals.GetColWidth=function(el){if(void 0===el||!el)return!1;let classes=el.attr("class");if(void 0===classes||!classes)return!1;let match=/col-.{2}-([0-9]*)/g.exec(classes);return!(void 0===match||!match)&&(void 0!==match[1]&&match[1])},Stratus.Internals.GetScrollDir=function(){let windowTop=jQuery(Stratus.Environment.get("viewPort")||window).scrollTop(),lastWindowTop=Stratus.Environment.get("windowTop");return!!lastWindowTop&&windowTop>lastWindowTop?"down":!!(!!lastWindowTop&&windowTop<lastWindowTop)&&"up"},Stratus.Internals.IsOnScreen=function(el,offset,partial){if(!el)return!1;if(el instanceof jQuery||(el=jQuery(el)),!el.length)return!1;offset=offset||0,"boolean"!=typeof partial&&(partial=!0);let viewPort=Stratus.Environment.get("viewPort")||window,pageTop=jQuery(viewPort).scrollTop(),pageBottom=pageTop+jQuery(viewPort).height(),elementTop=el.offset().top;viewPort!==window&&(elementTop+=pageTop);let elementBottom=elementTop+el.height();return pageTop+=offset,pageBottom-=offset,partial?elementTop<=pageBottom&&elementBottom>=pageTop:pageTop<elementTop&&pageBottom>elementBottom},Stratus.Internals.LoadCss=function(urls){return new Promise(function(resolve,reject){void 0!==urls&&"function"!=typeof urls||reject(new Stratus.Prototypes.Error({code:"LoadCSS",message:"CSS Resource URLs must be defined as a String, Array, or Object."},this)),"string"==typeof urls&&(urls=[urls]);let cssEntries={total:urls.length,iteration:0};cssEntries.total>0?_.each(urls.reverse(),function(url){cssEntries.iteration++;let cssEntry=_.uniqueId("css_");cssEntries[cssEntry]=!1,void 0!==url&&url?Stratus.Internals.CssLoader(url).then(function(entry){cssEntries[cssEntry]=!0,cssEntries.total===cssEntries.iteration&&_.allTrue(cssEntries)&&resolve(cssEntries)},reject):(cssEntries[cssEntry]=!0,cssEntries.total===cssEntries.iteration&&_.allTrue(cssEntries)&&resolve(cssEntries))}):reject(new Stratus.Prototypes.Error({code:"LoadCSS",message:"No CSS Resource URLs found!"},this))})},Stratus.Internals.LoadEnvironment=function(){let initialLoad=Stratus("body").attr("data-environment");initialLoad&&"object"==typeof initialLoad&&_.size(initialLoad)&&Stratus.Environment.set(initialLoad)},Stratus.Internals.LoadImage=function(obj){if(!obj.el)return setTimeout(function(){Stratus.Internals.LoadImage(obj)},500),!1;let el=obj.el instanceof jQuery?obj.el:jQuery(obj.el);if(!el.length)return setTimeout(function(){Stratus.Internals.LoadImage(obj)},500),!1;el.hasClass("placeholder")||(el.addClass("placeholder"),el.on("load",function(){el.removeClass("placeholder")})),Stratus.Internals.IsOnScreen(obj.spy||el)&&!_.hydrate(el.attr("data-loading"))&&(el.attr("data-loading",_.dehydrate(!0)),Stratus.DOM.complete(function(){let hd=_.hydrate(el.attr("data-hd"));void 0===hd&&(hd=!0);let src=_.hydrate(el.attr("data-src"))||el.attr("src")||null;("lazy"===src||_.isEmpty(src))&&(src=el.attr("src"));let size=_.hydrate(el.attr("data-size"))||obj.size||null;if(!size){let width=null,unit=null,percentage=null;if(el.width()?width=el.width():el.attr("width")&&(width=el.attr("width")),width){unit=(width=/([\d]+)(.*)/.exec(width))[2],width=parseInt(width[1]),percentage="%"===unit?width/100:null}if(!width||"%"===unit){let visibilitySelector=_.hydrate(el.attr("data-ignore-visibility"))?null:":visible",$visibleParent=jQuery(_.first(jQuery(obj.el).parents(visibilitySelector)));width=$visibleParent?$visibleParent.width():0;let $col=$visibleParent.find('[class*="col-"]');if($col.length>0){let colWidth=Stratus.Internals.GetColWidth($col);colWidth&&(width=Math.round(width/colWidth))}percentage&&(width=Math.round(width*percentage))}if(width<=0)return setTimeout(function(){el.attr("data-loading",_.dehydrate(!1)),Stratus.Internals.LoadImage(obj)},500),!1;hd&&(width*=2),"xs"===(size=(size=_.findKey(Stratus.Settings.image.size,function(s){let ratio=s/width;return ratio>.85&&ratio<1.15||s>width}))||"hq")&&setTimeout(function(){el.attr("data-loading",_.dehydrate(!1)),Stratus.Internals.LoadImage(obj)},1500)}const srcOrigin=src,srcMatch=/^(.+?)(-[A-Z]{2})?\.(?=[^.]*$)(.+)/gi.exec(src);null!==srcMatch?src=srcMatch[1]+"-"+size+"."+srcMatch[3]:console.error("Unable to find src for image:",el),el.addClass("loading"),el.on("load",function(){el.addClass("loaded").removeClass("loading")}),el.on("error",function(){el.attr("data-loading",_.dehydrate(!1)),el.attr("src",srcOrigin.startsWith("//")?window.location.protocol+srcOrigin:srcOrigin),console.log("Unable to load",size.toUpperCase(),"size.","Restored:",el.attr("src"))}),_.isEmpty(src)||(el.attr("data-loading",_.dehydrate(!1)),el.attr("data-size",_.dehydrate(size)),el.attr("src",src.startsWith("//")?window.location.protocol+src:src)),Stratus.RegisterGroup.remove("OnScroll",obj)}))},Stratus.Internals.Location=function(options){return new Promise(function(resolve,reject){"geolocation"in navigator?(options=_.extend({enableHighAccuracy:!0,timeout:2e4,maximumAge:5e4},options||{}),navigator.geolocation.getCurrentPosition(resolve,reject,options)):reject(new Stratus.Prototypes.Error({code:"Location",message:"HTML5 Geo-Location isn't supported on this browser."},this))})},Stratus.Internals.OnScroll=_.once(function(elements){Stratus.Environment.on("change:viewPortChange",function(model){if(model.get("viewPortChange")){model.set("lastScroll",Stratus.Internals.GetScrollDir());let elements=Stratus.RegisterGroup.get("OnScroll");_.each(elements,function(obj){void 0!==obj&&_.has(obj,"method")&&obj.method(obj)}),model.set("viewPortChange",!1),model.set("windowTop",jQuery(Stratus.Environment.get("viewPort")||window).scrollTop())}}),"function"==typeof jQuery&&jQuery.fn&&(jQuery(Stratus.Environment.get("viewPort")||window).scroll(function(){!1===Stratus.Environment.get("viewPortChange")&&Stratus.Environment.set("viewPortChange",!0)}),jQuery(Stratus.Environment.get("viewPort")||window).resize(function(){!1===Stratus.Environment.get("viewPortChange")&&Stratus.Environment.set("viewPortChange",!0)})),Stratus.Environment.set("viewPortChange",!0)}),Stratus.Internals.Resource=function(path,elementId){return new Promise(function(resolve,reject){if(void 0===path&&reject(new Stratus.Prototypes.Error({code:"Resource",message:"Resource path is not defined."},this)),_.has(Stratus.Resources,path))Stratus.Resources[path].success?resolve(Stratus.Resources[path].data):Stratus.Events.once("resource:"+path,resolve);else{Stratus.Resources[path]={success:!1,data:null},Stratus.Events.once("resource:"+path,resolve);let meta={path:path,dataType:"text"};void 0!==elementId&&(meta.elementId=elementId),Stratus.Internals.Api("Resource",meta,{}).then(function(data){Stratus.Resources[path].success=!0,Stratus.Resources[path].data=data,Stratus.Events.trigger("resource:"+path,data)},reject)}})},Stratus.Internals.SetUrlParams=function(params,url){if(void 0===url&&(url=window.location.href),void 0===params)return url;let lets={},glue=url.indexOf("?"),anchor=url.indexOf("#"),tail="";return anchor>=0&&(tail=url.substring(anchor,url.length),url=url.substring(0,anchor)),url.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){lets[key]=value}),lets=_.extend(lets,params),(glue>=0?url.substring(0,glue):url)+"?"+_.reduce(_.map(lets,function(value,key){return key+"="+value}),function(memo,value){return memo+"&"+value})+tail},Stratus.Internals.TrackLocation=function(){let envData={};envData.timezone=(new Date).toString().match(/\((.*)\)/)[1],Stratus.Environment.get("trackLocation")?Stratus.Environment.get("trackLocationConsent")?Stratus.Internals.Location().then(function(pos){envData.lat=pos.coords.latitude,envData.lng=pos.coords.longitude,Stratus.Environment.set("lat",pos.coords.latitude),Stratus.Environment.set("lng",pos.coords.longitude),Stratus.Internals.UpdateEnvironment(envData)},function(error){console.error("Stratus Location:",error)}):Stratus.Internals.Ajax({url:"https://ipapi.co/"+Stratus.Environment.get("ip")+"/json/",success:function(data){data||(data={}),"object"==typeof data&&Object.keys(data).length&&data.postal&&(envData.postalCode=data.postal,envData.lat=data.latitude,envData.lng=data.longitude,envData.city=data.city,envData.region=data.region,envData.country=data.country,Stratus.Internals.UpdateEnvironment(envData))}}):Stratus.Internals.UpdateEnvironment(envData)},Stratus.Internals.UpdateEnvironment=function(request){if(request||(request={}),"string"!=typeof document.cookie||!_.cookie("SITETHEORY"))return!1;"object"==typeof request&&Object.keys(request).length&&Stratus.Internals.Ajax({method:"PUT",url:"/Api/Session",data:request,type:"application/json",success:function(response){let settings=response.payload||response;"object"==typeof settings&&_.each(Object.keys(settings),function(key){Stratus.Environment.set(key,settings[key])})},error:function(error){console.error("error:",error)}})},Stratus.Select=function(selector,context){context||(context=document);let selection=selector;if("string"==typeof selector){let target;selection=context[target=_.startsWith(selector,".")||_.contains(selector,"[")?"querySelectorAll":_.contains(["html","head","body"],selector)||_.startsWith(selector,"#")?"querySelector":"querySelectorAll"](selector)}return selection&&"object"==typeof selection&&((_.isAngular(selection)||_.isjQuery(selection))&&(selection=selection.length?_.first(selection):{}),selection=_.extend({},Stratus.Selector,{context:this,length:_.size(selection),selection:selection,selector:selector})),selection},(Stratus=_.extend(function(selector,context){return Stratus.Select(selector,context)},Stratus)).Selector.attr=function(attr,value){let that=this;if(that.selection instanceof window.NodeList)return console.warn('Unable to find "'+attr+'" for list:',that.selection),null;if(attr){if(void 0===value)return value=that.selection.getAttribute(attr),_.hydrate(value);that.selection.setAttribute(attr,_.dehydrate(value))}return that},Stratus.Selector.each=function(callable){let that=this;return"function"!=typeof callable&&(callable=function(element){console.warn("each running on element:",element)}),that.selection instanceof window.NodeList&&_.each(that.selection,callable),that},Stratus.Selector.find=function(selector){let that=this;if(that.selection instanceof window.NodeList)console.warn('Unable to find "'+selector+'" for list:',that.selection);else if(selector)return Stratus(selector,that.selection);return null},Stratus.Selector.map=function(callable){let that=this;return"function"!=typeof callable&&(callable=function(element){console.warn("map running on element:",element)}),that.selection instanceof window.NodeList?_.map(that.selection,callable):that},Stratus.Selector.append=function(child){let that=this;return that.selection instanceof window.NodeList?console.warn("Unable to append child:",child,"to list:",that.selection):child&&that.selection.insertBefore(child,that.selection.lastChild),that},Stratus.Selector.prepend=function(child){let that=this;return that.selection instanceof window.NodeList?console.warn("Unable to prepend child:",child,"to list:",that.selection):child&&that.selection.insertBefore(child,that.selection.firstChild),that},Stratus.Selector.addClass=function(className){let that=this;return that.selection instanceof window.NodeList?console.warn('Unable to add class "'+className+'" to list:',that.selection):_.each(className.split(" "),function(name){that.selection.classList?that.selection.classList.add(name):that.selection.className+=" "+name}),that},Stratus.Selector.removeClass=function(className){let that=this;return that.selection instanceof window.NodeList?console.warn('Unable to remove class "'+className+'" from list:',that.selection):that.selection.classList?_.each(className.split(" "),function(name){that.selection.classList.remove(name)}):that.selection.className=that.selection.className.replace(new RegExp("(^|\\b)"+className.split(" ").join("|")+"(\\b|$)","gi")," "),that},Stratus.Selector.style=function(){let that=this;if(that.selection instanceof window.NodeList)console.warn("Unable to find style for list:",that.selection);else if(that.selection instanceof window.Node)return window.getComputedStyle(that.selection);return null},Stratus.Selector.height=function(){let that=this;return that.selection instanceof window.NodeList?(console.warn("Unable to find height for list:",that.selection),null):that.selection.offsetHeight||0},Stratus.Selector.width=function(){let that=this;return that.selection instanceof window.NodeList?(console.warn("Unable to find width for list:",that.selection),null):that.selection.offsetWidth||0},Stratus.Selector.offset=function(){let that=this;if(that.selection instanceof window.NodeList)console.warn("Unable to find offset for list:",that.selection);else if(that.selection.getBoundingClientRect){let rect=that.selection.getBoundingClientRect();return{top:rect.top+document.body.scrollTop,left:rect.left+document.body.scrollLeft}}return{top:null,left:null}},Stratus.Selector.parent=function(){let that=this;return that.selection instanceof window.NodeList?(console.warn("Unable to find offset for list:",that.selection),null):Stratus(that.selection.parentNode)},Stratus.Internals.Loader=function(selector,view,requirements){if(void 0===selector){let body=Stratus("body");(selector=body.attr("data-loaded")?null:"[data-entity],[data-plugin]")?body.attr("data-loaded",!0):console.warn("Attempting to load Stratus root repeatedly!")}return selector&&(selector=view&&selector&&"object"==typeof selector?Stratus(selector).find("[data-type],[data-plugin]"):Stratus(selector)),new Promise(function(resolve,reject){let entries={total:selector&&"object"==typeof selector?selector.length:0,iteration:0,views:{}};entries.total>0?selector.each(function(el,index,list){entries.iteration++;let entry=_.uniqueId("entry_");entries.views[entry]=!1,Stratus.Internals.ViewLoader(el,view,requirements).then(function(view){entries.views[entry]=view,entries.total===entries.iteration&&_.allTrue(entries.views)&&resolve(entries)},reject)}):resolve(entries)})},Stratus.Internals.View=_.inherit(Stratus.Prototypes.Model,{toObject:function(){let sanitized=_.clone(this.data);return sanitized.el&&sanitized.el.selection&&(sanitized.el=sanitized.el.selection,"function"==typeof jQuery&&jQuery.fn&&(sanitized.$el=jQuery(sanitized.el))),sanitized},hydrate:function(){let nel=this.get("el");if(this.set({uid:_.uniqueId("view_"),guid:void 0!==nel.attr("data-guid")?nel.attr("data-guid"):null,entity:void 0!==nel.attr("data-entity")?_.ucfirst(nel.attr("data-entity")):null,id:void 0!==nel.attr("data-id")?nel.attr("data-id"):null,manifest:void 0!==nel.attr("data-manifest")?nel.attr("data-manifest"):null,api:void 0!==nel.attr("data-api")?nel.attr("data-api"):null,fetch:void 0===nel.attr("data-fetch")||nel.attr("data-fetch"),target:void 0!==nel.attr("data-target")?nel.attr("data-target"):null,prototype:void 0!==nel.attr("data-prototype")?nel.attr("data-prototype"):null,autoSave:void 0!==nel.attr("data-autoSave")?nel.attr("data-autoSave"):null,type:void 0!==nel.attr("data-type")?nel.attr("data-type"):null,types:void 0!==nel.attr("data-types")?nel.attr("data-types"):null,template:void 0!==nel.attr("data-template")?nel.attr("data-template"):null,templates:void 0!==nel.attr("data-templates")?nel.attr("data-templates"):null,dialogue:void 0!==nel.attr("data-dialogue")?nel.attr("data-dialogue"):null,pagination:void 0!==nel.attr("data-pagination")?nel.attr("data-pagination"):null,property:void 0!==nel.attr("data-property")?nel.attr("data-property"):null,field:void 0!==nel.attr("data-field")?nel.attr("data-field"):null,load:void 0!==nel.attr("data-load")?nel.attr("data-load"):null,options:void 0!==nel.attr("data-options")?nel.attr("data-options"):null,versionEntity:void 0!==nel.attr("data-versionentity")?nel.attr("data-versionentity"):null,versionRouter:void 0!==nel.attr("data-versionrouter")?nel.attr("data-versionrouter"):null,versionId:void 0!==nel.attr("data-versionid")?nel.attr("data-versionid"):null,plugin:void 0!==nel.attr("data-plugin")?nel.attr("data-plugin"):null,plugins:[]}),null!==this.get("plugin")){let plugins=this.get("plugin").split(" ");null!==this.get("type")?this.set("plugins",plugins.length>1?plugins:[this.get("plugin")]):plugins.length>1&&(this.set("plugin",_.first(plugins)),this.set("plugins",_.rest(plugins)))}let id=this.get("id"),type=null!==this.get("type")?this.get("type"):this.get("plugin"),loaderType=null!==this.get("type")?"widgets":"plugins";this.set({scope:null!==id?"model":"collection",alias:null!==type?"stratus.views."+loaderType+"."+type.toLowerCase():null,path:null!==type?type:null}),id||null===this.get("entity")||null===this.get("manifest")||this.set("scope","model")},clean:function(){this.get("entity")&&"none"!==this.get("entity").toLowerCase()||this.set({entity:null,scope:null})},nest:function(){let nest={entity:this.get("entity"),id:this.get("id"),versionEntity:this.get("versionEntity"),versionRouter:this.get("versionRouter"),versionId:this.get("versionId"),scope:this.get("scope"),manifest:this.get("manifest")};return this.has(nest.scope)&&(nest[nest.scope]=this.get(nest.scope)),nest},modelAttributes:function(){return{id:this.get("id")}}}),Stratus.Internals.ViewLoader=function(el,view,requirements){let templates,templateMap,parentView=view||null,parentChild=!1,element=Stratus(el);if((view=new Stratus.Internals.View).set("el",element),view.hydrate(),parentView&&(view.has("entity")?parentChild=!0:view.set(parentView.nest())),view.clean(),!parentChild){void 0===requirements&&(requirements=["stratus"]),templates=view.get("templates"),templateMap=[];let template=view.get("template"),dialogue=view.get("dialogue");if(null!==view.get("scope")&&requirements.push("stratus."+view.get("scope")+"s.generic"),view.get("alias")&&_.has(requirejs.s.contexts._.config.paths,view.get("alias")))requirements.push(view.get("alias"));else if(view.get("path")){requirements.push(view.get("path"));let srcMatch=/(?=[^/]*$)([a-zA-Z]+)/i.exec(view.get("path"));view.set("type",_.ucfirst(srcMatch[1]))}else view.set({type:null,alias:null,path:null});if(null!==template&&(templates=_.extend(null!==templates?templates:{},{combined:template})),null!==dialogue&&(templates=_.extend(null!==templates?templates:{},{dialogue:dialogue})),null!==templates){let key;for(key in templates)if(templates.hasOwnProperty(key)&&"function"!=typeof templates[key])if(0===templates[key].indexOf("#")){let $domTemplate=jQuery(templates[key]);$domTemplate.length>0&&(templates[key]=$domTemplate.html())}else templates[key],requirejs.s.contexts._.config.paths,requirements.push("text!"+templates[key]),templateMap.push(key);view.set("templates",templates),templates=view.get("templates")}}return new Promise(function(resolve,reject){return view.get("guid")?(Stratus.Environment.get("production")||console.warn("View hydration halted on",view.get("guid"),"due to repeat calls on the same element.",view.toObject()),resolve(!0),!0):parentChild?(resolve(!0),!0):void require(requirements,function(Stratus){!Stratus.Environment.get("production")&&Stratus.Environment.get("nestDebug")&&console.group("Stratus View");let hydrationKey=0;if(templates&&templateMap.length>0){let i;for(i=0;i<arguments.length;i++)"string"==typeof arguments[i]&&(-1===arguments[i].indexOf("<html")?templates[templateMap[hydrationKey]]=arguments[i]:console.error("Template",templates[templateMap[hydrationKey]],"failed to load."),hydrationKey++)}view.set("templates",templates),templates=view.get("templates");let subRequirements=[];if(_.size(templates)>0){let re=/<.+?data-type=["|'](.+?)["|'].*>/gi;_.each(templates,function(value,key){if("string"==typeof value){if(-1!==value.search(re)){let match=re.exec(value);for(;null!==match;){let subRequirement="stratus.views."+(view.get("plugin")?"plugins":"widgets")+"."+match[1].toLowerCase();subRequirement&&!_.has(requirejs.s.contexts._.config.paths,subRequirement)&&(Stratus.Environment.get("production")||console.warn("Sub Type:",subRequirement,"not configured in require.js")),subRequirements.push(subRequirement),match=re.exec(value)}}templates[key]=_.template(value)}}),view.set("templates",templates),templates=view.get("templates")}view.get("plugins").length&&_.each(view.get("plugins"),function(plugin){subRequirements.push("stratus.views.plugins."+plugin.toLowerCase())});let loaderTypes=[];null!==view.get("plugin")&&loaderTypes.push("PluginLoader"),null!==view.get("type")&&loaderTypes.push("WidgetLoader"),loaderTypes.length||loaderTypes.push("WidgetLoader"),_.each(loaderTypes,function(loaderType){0===_.size(subRequirements)?Stratus.Internals[loaderType](resolve,reject,view,requirements):(requirements=_.union(requirements,subRequirements),new Promise(function(resolve,reject){require(requirements,function(Stratus){Stratus.Internals[loaderType](resolve,reject,view,requirements)})}).then(resolve,reject))})})})},Stratus.Internals.WidgetLoader=function(resolve,reject,view,requirements){if("model"===view.get("scope")){let modelReference,modelInstance;Stratus.Models.has(view.get("entity"))||Stratus.Models.set(view.get("entity"),Stratus.Models.Generic.extend({}));let modelInit=!1,ModelType=Stratus.Models.has(view.get("entity"))?Stratus.Models.get(view.get("entity")):null;!view.get("id")&&view.get("manifest")?(modelInstance=view.get("entity")+"Manifest",(modelReference=Stratus.Instances[modelInstance])||(Stratus.Instances[modelInstance]=new ModelType,modelReference=Stratus.Instances[modelInstance],modelInit=!0)):ModelType&&_.has(ModelType,"findOrCreate")?(modelReference=ModelType.findOrCreate(view.get("id")))||(modelReference=new ModelType(view.modelAttributes()),modelInit=!0):(modelInstance=view.get("entity")+view.get("id"),(modelReference=Stratus.Instances[modelInstance])||(Stratus.Instances[modelInstance]=new ModelType(view.modelAttributes()),modelReference=Stratus.Instances[modelInstance],modelInit=!0)),modelInit&&modelReference.safeInitialize(view.toObject()),view.set({model:modelReference})}else if("collection"===view.get("scope")){Stratus.Collections.has(view.get("entity"))||Stratus.Collections.set(view.get("entity"),new Stratus.Collections.Generic(view.toObject()));let collectionReference=Stratus.Collections.get(view.get("entity"));!collectionReference.initialized&&view.get("fetch")&&collectionReference.safeInitialize(view.toObject()),view.set({collection:collectionReference})}if(null!==view.get("type")){let type=_.ucfirst(view.get("type"));if(void 0!==Stratus.Views.Widgets[type]){let options=view.toObject();options.view=view,Stratus.Instances[view.get("uid")]=new Stratus.Views.Widgets[type](options),Stratus.Instances[view.get("uid")].$el.attr("data-guid",view.get("uid")),_.has(Stratus.Instances[view.get("uid")],"promise")?Stratus.Instances[view.get("uid")].initializer.then(resolve,reject):resolve(Stratus.Instances[view.get("uid")])}else Stratus.Environment.get("production")||console.warn("Stratus.Views.Widgets."+type+" is not correctly configured."),reject(new Stratus.Prototypes.Error({code:"WidgetLoader",message:"Stratus.Views.Widgets."+type+" is not correctly configured."},view.toObject()));!Stratus.Environment.get("production")&&Stratus.Environment.get("nestDebug")&&console.groupEnd()}else{let nest=view.get("el").find("[data-type],[data-plugin]");nest.length>0?Stratus.Internals.Loader(view.get("el"),view,requirements).then(function(resolution){!Stratus.Environment.get("production")&&Stratus.Environment.get("nestDebug")&&console.groupEnd(),resolve(resolution)},function(rejection){!Stratus.Environment.get("production")&&Stratus.Environment.get("nestDebug")&&console.groupEnd(),reject(new Stratus.Prototypes.Error(rejection,nest))}):!Stratus.Environment.get("production")&&Stratus.Environment.get("nestDebug")?(console.warn("No Innate or Nested Type Found:",view.toObject()),resolve(view.toObject()),console.groupEnd()):resolve(view.toObject())}},Stratus.Internals.PluginLoader=function(resolve,reject,view,requirements){let types=_.union([view.get("plugin")],view.get("plugins"));_.each(types,function(type){if(type=_.ucfirst(type),void 0!==Stratus.Views.Plugins[type]){let options=view.toObject();options.view=view,Stratus.Instances[view.get("uid")]=new Stratus.Views.Plugins[type](options),Stratus.Instances[view.get("uid")].$el.attr("data-guid",view.get("uid")),_.has(Stratus.Instances[view.get("uid")],"promise")?Stratus.Instances[view.get("uid")].initializer.then(resolve,reject):resolve(Stratus.Instances[view.get("uid")])}else Stratus.Environment.get("production")||console.warn("Stratus.Views.Plugins."+type+" is not correctly configured."),reject(new Stratus.Prototypes.Error({code:"PluginLoader",message:"Stratus.Views.Plugins."+type+" is not correctly configured."},view.toObject()))})},Stratus.Loaders.Angular=function(){let requirement,nodes,injection,container={requirement:[],module:[],stylesheet:[]},injector=function(injection){injection=injection||{},_.each(injection,function(element,attribute){container[attribute]=container[attribute]||[],_.isArray(element)?_.each(element,function(value){container[attribute].push(value)}):container[attribute].push(element)})};_.each(Stratus.Roster,function(element,key){if("object"==typeof element&&element)if(_.isUndefined(element.selector)&&element.namespace&&(element.selector=_.filter(_.map(requirejs.s.contexts._.config.paths,function(path,key){return _.startsWith(key,element.namespace)?("attribute"===element.type?"[":"")+_.camelToKebab(key.replace(element.namespace,"stratus-"))+("attribute"===element.type?"]":""):null}))),_.isArray(element.selector))element.length=0,_.each(element.selector,function(selector){if(nodes=document.querySelectorAll(selector),element.length+=nodes.length,nodes.length){let name=selector.replace(/^\[/,"").replace(/]$/,"");requirement=element.namespace+_.lcfirst(_.kebabToCamel(name.replace(/^stratus/,"").replace(/^ng/,""))),_.has(requirejs.s.contexts._.config.paths,requirement)&&(injection={requirement:requirement},element.module&&(injection.module=_.isString(element.module)?element.module:_.lcfirst(_.kebabToCamel(name+(element.suffix||"")))),injector(injection))}});else if(_.isString(element.selector)&&(nodes=document.querySelectorAll(element.selector),element.length=nodes.length,nodes.length)){let attribute=element.selector.replace(/^\[/,"").replace(/]$/,"");element.namespace?_.each(nodes,function(node){let name=node.getAttribute(attribute);name&&(requirement=element.namespace+_.lcfirst(_.kebabToCamel(name.replace("Stratus",""))),_.has(requirejs.s.contexts._.config.paths,requirement)&&injector({requirement:requirement}))}):element.require&&(container.requirement=_.union(container.requirement,element.require),injection={},element.module&&(injection.module=_.isString(element.module)?element.module:_.lcfirst(_.kebabToCamel(attribute+(element.suffix||"")))),element.stylesheet&&(injection.stylesheet=element.stylesheet),injector(injection))}}),container.requirement.push("angular-material"),_.each(container,function(element,key){container[key]=_.uniq(element)}),window.container=container,container.requirement.length&&(Object.keys(requirejs.s.contexts._.config.paths).filter(function(path){return _.startsWith(path,"stratus.filters.")}).forEach(function(requirement){container.requirement.push(requirement)}),require(container.requirement,function(){if(angular.module("stratusApp",_.union(Object.keys(Stratus.Modules),container.module)).config(["$sceDelegateProvider",function($sceDelegateProvider){let whitelist=["self","http://*.sitetheory.io/**","https://*.sitetheory.io/**"];boot.host&&(_.startsWith(boot.host,"//")?_.each(["https:","http:"],function(proto){whitelist.push(proto+boot.host+"/**")}):whitelist.push(boot.host+"/**")),$sceDelegateProvider.resourceUrlWhitelist(whitelist)}]),"function"==typeof jQuery&&jQuery.fn&&jQuery.FroalaEditor){jQuery.FroalaEditor.DEFAULTS.key=Stratus.Api.Froala;let buttons=["bold","italic","underline","strikeThrough","subscript","superscript","|","formatBlock","blockStyle","inlineStyle","paragraphStyle","paragraphFormat","align","formatOL","formatUL","outdent","indent","|","insertLink","insertImage","insertVideo","insertFile","insertTable","|","undo","redo","removeFormat","wordPaste","help","html","fullscreen"];angular.module("stratusApp").value("froalaConfig",{codeBeautifierOptions:{end_with_newline:!0,indent_inner_html:!0,extra_liners:"['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'blockquote', 'pre', 'ul', 'ol', 'table', 'dl']",brace_style:"expand",indent_char:" ",indent_size:4,wrap_line_length:0},codeMirror:!0,codeMirrorOptions:{indentWithTabs:!1,lineNumbers:!0,lineWrapping:!0,mode:"text/html",tabMode:"space",tabSize:4},fileUploadURL:"https://app002.sitetheory.io:3000/?session="+_.cookie("SITETHEORY"),htmlAllowedAttrs:[".*"],htmlAllowedEmptyTags:["textarea","a",".fa","iframe","object","video","style","script","div"],htmlAllowedTags:[".*"],htmlRemoveTags:[""],htmlUntouched:!0,imageManagerPageSize:20,imageManagerScrollOffset:10,imageManagerLoadURL:"/Api/Media?payload-only=true",imageManagerLoadMethod:"GET",imageManagerDeleteMethod:"DELETE",multiLine:!0,pasteDeniedAttrs:[""],pasteDeniedTags:[""],pastePlain:!1,toolbarSticky:!1,toolbarButtons:buttons,toolbarButtonsMD:buttons,toolbarButtonsSM:buttons,toolbarButtonsXS:buttons})}_.each(Stratus.Services,function(service){angular.module("stratusApp").config(service)}),_.each(Stratus.Components,function(component,name){angular.module("stratusApp").component("stratus"+_.ucfirst(name),component)}),_.each(Stratus.Directives,function(directive,name){angular.module("stratusApp").directive("stratus"+_.ucfirst(name),directive)}),_.each(Stratus.Filters,function(filter,name){angular.module("stratusApp").filter(_.lcfirst(name),filter)}),_.each(Stratus.Controllers,function(controller,name){angular.module("stratusApp").controller(name,controller)});let css=container.stylesheet,cssLoaded=Stratus("link[satisfies]").map(function(node){return node.getAttribute("satisfies")});if(_.contains(cssLoaded,"angular-material.css")||css.push(Stratus.BaseUrl+Stratus.BundlePath+"bower_components/angular-material/angular-material"+(Stratus.Environment.get("production")?".min":"")+".css"),(Stratus("[froala]").length||Stratus.Directives.Froala)&&[Stratus.BaseUrl+"sitetheorycore/css/sitetheory.codemirror.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/codemirror/lib/codemirror.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/froala_editor.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/froala_style.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/code_view.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/draggable.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/file.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/fullscreen.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/help.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/image.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/image_manager.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/quick_insert.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/special_characters.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/table.min.css",Stratus.BaseUrl+Stratus.BundlePath+"bower_components/froala-wysiwyg-editor/css/plugins/video.min.css"].forEach(function(stylesheet){css.push(stylesheet)}),css.length){let counter=0;_.each(css,function(url){Stratus.Internals.CssLoader(url).then(function(){++counter===css.length&&angular.bootstrap(document.querySelector("html"),["stratusApp"])})})}else angular.bootstrap(document.querySelector("html"),["stratusApp"])}))},Stratus.Instances.Clean=function(instances){if(void 0===instances?console.error("Stratus.Instances.Clean() requires a string or array containing Unique ID(s)."):"string"==typeof instances&&(instances=[instances]),"object"!=typeof instances||!Array.isArray(instances))return!1;_.each(instances,function(value){_.has(Stratus.Instances,value)&&("function"==typeof Stratus.Instances[value].remove&&Stratus.Instances[value].remove(),delete Stratus.Instances[value])})},Stratus.Chronos=_.extend(new Stratus.Prototypes.Model,{initialize:function(options){Stratus.Environment.get("production")||console.info("Chronos Invoked!"),this.on("change",this.synchronize,this)},synchronize:function(){_.each(this.changed,function(job,key){"string"==typeof key&&-1!==key.indexOf(".")&&(key=_.first(key.split(".")),job=this.get(key)),!job.code&&job.enabled?job.code=setInterval(function(job){job.method.call(job.scope)},1e3*job.time,job):job.code&&!job.enabled&&(clearInterval(job.code),job.code=0)},this)},add:function(time,method,scope){let uid=null,job=new Stratus.Prototypes.Job(time,method,scope);return null!==job.time&&"function"==typeof job.method&&(uid=_.uniqueId("job_"),this.set(uid,job),Stratus.Instances[uid]=job),uid},enable:function(uid){let success=this.has(uid);return success&&this.set(uid+".enabled",!0),success},disable:function(uid){let success=this.has(uid);return success&&this.set(uid+".enabled",!1),success},toggle:function(uid,value){let success=this.has(uid);return success&&this.set(uid+".enabled","boolean"==typeof value?value:!this.get(uid+".enabled")),success}}),Stratus.Chronos.reinitialize(),Stratus.PostMessage.Convoy=function(fn){window.addEventListener("message",function(event){if("https://auth.sitetheory.io"!==event.origin)return!1;fn(_.isJSON(event.data)?JSON.parse(event.data):{})},!1)},Stratus.PostMessage.Convoy(function(convoy){let ssoEnabled=_.cookie("sso");(ssoEnabled=null===ssoEnabled||!!_.isJSON(ssoEnabled)&&JSON.parse(ssoEnabled))&&convoy&&convoy.meta&&convoy.meta.session&&convoy.meta.session!==_.cookie("SITETHEORY")&&(_.cookie({name:"SITETHEORY",value:convoy.meta.session,expires:"1w"}),Stratus.Client.safari||window.location.reload(!0))}),Stratus.LocalStorage.Listen=function(key,fn){window.addEventListener("storage",function(event){event.key===key&&fn(event)},!1)},Stratus.LocalStorage.Listen("stratus-core",function(data){console.log("LocalStorage:",data)}),Stratus.DOM.ready=function(fn){"loading"!==document.readyState?fn():document.addEventListener("DOMContentLoaded",fn)},Stratus.DOM.complete=function(fn){"complete"===document.readyState?fn():window.addEventListener("load",fn)},Stratus.DOM.unload=function(fn){window.addEventListener("beforeunload",fn)},Stratus.Key.Enter=13,Stratus.Key.Escape=27,Stratus.Events.on("initialize",function(){Stratus.Environment.get("production")||(console.groupEnd(),console.group("Stratus Initialize")),Stratus.Internals.LoadEnvironment(),Stratus.Internals.Compatibility(),Stratus.RegisterGroup=new Stratus.Prototypes.Model,Stratus.Internals.TrackLocation(),Stratus.Loaders.Angular(),Stratus.Internals.Loader().then(function(views){Stratus.Environment.get("production")||console.info("Views:",views),window.views=views,Stratus.Events.on("finalize",function(views){"undefined"==typeof Backbone||Backbone.History.started||Backbone.history.start(),Stratus.Events.trigger("finalized",views)}),Stratus.Events.trigger("finalize",views)},function(error){console.error("Stratus Loader:",error)})}),Stratus.Events.on("finalize",function(){if(Stratus.Environment.get("production")||(console.groupEnd(),console.group("Stratus Finalize")),"object"==typeof Backbone){Stratus.Internals.Anchor.initialize&&(Stratus.Internals.Anchor=Stratus.Internals.Anchor());let anchor=new Stratus.Internals.Anchor;Stratus.Environment.get("production")||console.log("Anchor:",anchor)}Stratus.RegisterGroup.size()&&Stratus.RegisterGroup.each(function(objs,key){_.has(Stratus.Internals,key)&&Stratus.Internals[key](objs)})}),Stratus.Events.on("terminate",function(){Stratus.Environment.get("production")||(console.groupEnd(),console.group("Stratus Terminate"))}),Stratus.Events.on("alert",function(message,handler){message instanceof Stratus.Prototypes.Bootbox||(message=new Stratus.Prototypes.Bootbox(message,handler)),"undefined"!=typeof bootbox?bootbox.alert(message.message,message.handler):(window.alert(message.message),message.handler())}),Stratus.Events.on("confirm",function(message,handler){message instanceof Stratus.Prototypes.Bootbox||(message=new Stratus.Prototypes.Bootbox(message,handler)),"undefined"!=typeof bootbox?bootbox.confirm(message.message,message.handler):handler(window.confirm(message.message))}),Stratus.Events.on("notification",function(message,title){let notification,options={};message&&"object"==typeof message?(_.extend(options,message),options.message=options.message||"Message"):options.message=message||"Message",options.title=options.title||title||"Stratus",options.icon=options.icon||"https://avatars0.githubusercontent.com/u/15791995?v=3&s=200","Notification"in window?"granted"===window.Notification.permission?(notification=new window.Notification(options.title,{body:options.message,icon:options.icon}),Stratus.Environment.get("production")||console.log(notification)):"denied"!==window.Notification.permission&&window.Notification.requestPermission(function(permission){"granted"===permission&&(notification=new window.Notification(options.title,{body:options.message,icon:options.icon}),Stratus.Environment.get("production")||console.log(notification))}):console.info("This browser does not support desktop notifications.  You should switch to a modern browser.")}),Stratus.Events.on("toast",function(message,title,priority,settings){message instanceof Stratus.Prototypes.Toast||(message=new Stratus.Prototypes.Toast(message,title,priority,settings)),Stratus.Environment.get("production")||console.log("Toast:",message),void 0!==jQuery&&jQuery.toaster?jQuery.toaster(message):Stratus.Events.trigger("alert",message.message)}),Stratus.DOM.ready(function(){Stratus("body").removeClass("loaded unloaded").addClass("loading"),Stratus.Events.trigger("initialize")}),Stratus.DOM.complete(function(){Stratus("body").removeClass("loading unloaded").addClass("loaded")}),Stratus.DOM.unload(function(event){Stratus("body").removeClass("loading loaded").addClass("unloaded"),Stratus.Events.trigger("terminate",event)}),Stratus});