//     Stratus.Collections.Provider.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,e){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.models.provider"],e):e(t.Stratus,t._)}(this,function(t,e){t.Collections.Provider=["$provide",function(n){n.factory("collection",function(n,i,o,s){return function(o){this.entity=null,this.infinite=!1,this.threshold=.5,this.qualifier="",this.decay=0,o&&"object"==typeof o&&angular.extend(this,o),this.url="/Api",this.models=[],this.meta=new t.Prototypes.Collection,this.model=s,this.pending=!0,this.error=!1,this.completed=!1,this.entity&&(this.url+="/"+e.ucfirst(this.entity));var r=this;this.sync=function(t,e){return this.pending=!0,n(function(n,o){t=t||"GET";var s={method:t,url:r.url,headers:{action:t}};if(angular.isDefined(e))if("GET"===t){if(angular.isObject(e)){var a=[];angular.forEach(e,function(t,e){a.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),a.length&&(s.url+="?"+a.join("&"))}}else s.headers["Content-Type"]="application/json",s.data=JSON.stringify(e);i(s).then(function(t){if("200"==t.status){r.meta.set(t.data.meta),r.models=[];var e=t.data.payload||t.data;angular.isArray(e)&&e.forEach(function(t){r.models.push(new r.model({entity:r.entity},t))}),r.pending=!1,r.completed=!0,n(r.models)}else r.pending=!1,r.error=!0,o(t)},o)})},this.fetch=function(t,e){return r.sync(t,e||r.meta.get("api"))},this.filter=function(t){return r.meta.set("api.q",t),r.fetch()},this.toJSON=function(){var t=[];return r.models.forEach(function(e){"function"==typeof e.toJSON&&t.push(e.toJSON())}),t}}})}]});