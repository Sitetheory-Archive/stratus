//     Stratus.Collections.Provider.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,e){"function"==typeof define&&define.amd?define(["stratus","angular","promise"],e):e(t.Stratus)}(this,function(t){t.Collections.Provider=["$provide",function(e){e.factory("collection",function(e){return function(n){this.entity=null,n&&"object"==typeof n&&angular.extend(this,n),this.url="/Api",this.models=[],this.meta=new t.Prototypes.Collection,this.pending=!0,this.error=!1,this.completed=!1,this.entity&&(this.url+="/"+t.Tools.UpperFirst(this.entity));var i=this;this.sync=function(t,n){t=t||"GET";var o={method:t,url:i.url,headers:{action:t}};if(angular.isDefined(n))if("GET"===t){if(angular.isObject(n)){var s=[];angular.forEach(n,function(t,e){s.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}),s.length&&(o.url+="?"+s.join("&"))}}else o.headers["Content-Type"]="application/json",o.data=JSON.stringify(n);return e(o)},this.fetch=function(t,e){return this.pending=!0,new Promise(function(n,o){i.sync(t,e||i.meta.get("api")).then(function(t){"200"==t.status?(i.meta.set(t.data.meta),i.models=t.data.payload||t.data,i.pending=!1,i.completed=!0,n(t)):(i.pending=!1,i.error=!0,o(t))},o)})},this.filter=function(t){return this.meta.set("api.q",t),console.log("query:",t),this.fetch()}}})}]});