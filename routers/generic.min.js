!function(e,t){"function"==typeof define&&define.amd?define(["stratus","underscore","backbone"],t):t(e.Stratus,e._,e.Backbone)}(this,function(o,i,e){o.Routers.Generic=e.Router.extend({routes:{"new/:entity":"new","filter/:entity":"filter","filter/:entity/:filter":"filter","page/:entity":"paginate","page/:entity/:page":"paginate"},initialize:function(e){o.Environment.get("production")||console.info("Generic Router Invoked!")},change:function(e){o.Environment.get("production")||console.log("Model(s):",arguments)},new:function(e){o.Environment.get("production")||console.log("Route New:",arguments);var t=o.Collections.get(i.ucfirst(e));"object"==typeof t&&(this.navigate("#"),t.create(i.has(t,"prototype")?t.prototype:{},{wait:!0}))},filter:function(e,t){void 0===t&&(t="");var n=o.Collections.get(i.ucfirst(e));"object"==typeof n&&(t.startsWith("[]")&&(t=(t=t.substring(2)).split(",[]")),o.Environment.get("production")||console.info("Route Filter:",t),n.meta.set("api.q",t),n.meta.has("api.p")&&n.meta.set("api.p",1),n.refresh({reset:!0}))},paginate:function(e,t){void 0===t&&(t="1"),o.Environment.get("production")||console.log("Entity:",e,"Page:",t);var n=o.Collections.get(i.ucfirst(e));"object"==typeof n?n.isHydrated()?n.meta.has("pageCurrent")&&n.meta.get("pageCurrent")!==parseInt(t)&&(n.meta.get("pageTotal")>=parseInt(t)&&1<=parseInt(t)?(n.meta.set("api.p",t),n.refresh({reset:!0})):o.Environment.get("production")||console.log("Page",t,"of entity",e,"does not exist.")):n.once("reset",function(){this.paginate(e,t)},this):o.Collections.once("change:"+i.ucfirst(e),function(){this.paginate(e,t)},this)}})});