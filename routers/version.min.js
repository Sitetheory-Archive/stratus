//     Stratus.Routers.Version.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(e,i){"function"==typeof define&&define.amd?define(["stratus","underscore","backbone"],i):i(e.Stratus,e._,e.Backbone)}(this,function(e,i,t){e.Routers.Version=t.Router.extend({model:e.Models.Generic,routes:{"version/:id":"version"},initialize:function(t){return i.has(t,"model")?(this.model=t.model,this.modelId=this.model.get("id"),this.versionEntityId=this.model.versionEntity+".id",void(this.model.isHydrated()?this.register():(this.model.once("success",function(){this.model.once("change",function(){this.register()},this)},this),e.Events.once("finalized",function(){this.model.isEvaluated()||(this.model._isEvaluated=!0,this.model.trigger("refresh"))},this)))):(console.error("A Model must be defined for a Version Router"),!1)},register:function(){this.model.on("change:"+this.model.versionEntity,this.change,this),this.change()},change:function(){t.History.started?this.model.has(this.versionEntityId)&&this.versionId!==this.model.get(this.versionEntityId)&&(this.versionId=this.model.get(this.versionEntityId),e.Environment.get("production")||console.info("Navigate:","version/"+this.versionId),this.navigate("version/"+this.versionId,{replace:!0})):e.Events.once("finalized",function(){this.change()},this)},version:function(e){(!this.model.isHydrated()||this.model.has(this.versionEntityId)&&this.versionId!==parseInt(e))&&(this.model.versionId=e,this.model._isEvaluated=!0,this.model.trigger("refresh"))}})});