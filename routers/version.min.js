!function(e,i){"function"==typeof define&&define.amd?define(["stratus","underscore","backbone"],i):i(e.Stratus,e._,e.Backbone)}(this,function(i,t,e){i.Routers.Version=e.Router.extend({model:i.Models.Generic,routes:{"version/:id":"version"},initialize:function(e){if(!t.has(e,"model"))return console.error("A Model must be defined for a Version Router"),!1;this.model=e.model,this.modelId=this.model.get("id"),this.versionEntityId=this.model.versionEntity+".id",this.model.isHydrated()?this.register():(this.model.once("success",function(){this.model.once("change",function(){this.register()},this)},this),i.Events.once("finalized",function(){this.model.isEvaluated()||(this.model._isEvaluated=!0,this.model.trigger("refresh"))},this))},register:function(){this.model.on("change:"+this.model.versionEntity,this.change,this),this.change()},change:function(){e.History.started?this.model.has(this.versionEntityId)&&this.versionId!==this.model.get(this.versionEntityId)&&(this.versionId=this.model.get(this.versionEntityId),i.Environment.get("production")||console.info("Navigate:","version/"+this.versionId),this.navigate("version/"+this.versionId,{replace:!0})):i.Events.once("finalized",function(){this.change()},this)},version:function(e){(!this.model.isHydrated()||this.model.has(this.versionEntityId)&&this.versionId!==parseInt(e))&&(this.model.versionId=e,this.model._isEvaluated=!0,this.model.trigger("refresh"))}})});