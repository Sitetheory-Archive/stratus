!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular"],factory):factory(root.Stratus,root._,root.$,root.angular)}(this,function(Stratus,_,$,angular){Stratus.Directives.OnScreen=function($parse,$interpolate){return{restrict:"A",scope:{onScreen:"@onScreen",stratusOnScreen:"@stratusOnScreen",offScreen:"@offScreen",spy:"@spy",target:"@target",scrollChange:"@scrollChange",event:"@event",offset:"@offset",reset:"@reset"},link:function(scope,element,attrs){element.uid=_.uniqueId("on_screen_"),Stratus.Instances[element.uid]=scope,scope.elementId=attrs.elementId||element.uid;const event=attrs.event?attrs.event.split(" "):[],target=attrs.target?$(attrs.target):element;let spy=attrs.spy?$(attrs.spy):element;spy.length||(spy=element);const offset=_.hydrate(attrs.offset||0),reset=attrs.reset||0;Stratus.Internals.OnScroll();const isOnScreen=function(){Stratus.Internals.IsOnScreen(spy,offset)?(target.hasClass("onScreen")||target.addClass("onScreen onScreenInit"),target.hasClass("offScreen")&&target.removeClass("offScreen"),!attrs.onScreen||"function"!=typeof attrs.onScreen||attrs.onScreen()):(target.hasClass("onScreen")&&target.removeClass("onScreen"),target.hasClass("offScreen")||target.addClass("offScreen"),!attrs.offScreen||"function"!=typeof attrs.offScreen||attrs.offScreen())};Stratus.Environment.on("change:viewPortChange",function(model){let isReset=!1;-1!==event.indexOf("reset")&&(reset>0&&$(element).offset().top<=reset||$(window).scrollTop()<=0)&&(isReset=!0,target.removeClass("onScreen offScreen scrollUp scrollDown ascend descend")),isReset||_.hydrate(attrs.scrollChange)||isOnScreen()}),Stratus.Environment.on("change:lastScroll",function(model){let lastScroll=Stratus.Environment.get("lastScroll");"down"===lastScroll&&(target.hasClass("scrollDown")||target.addClass("scrollDown"),target.hasClass("scrollUp")&&target.removeClass("scrollUp")),"up"===lastScroll&&(target.hasClass("scrollUp")||target.addClass("scrollUp"),target.hasClass("scrollDown")&&target.removeClass("scrollDown")),_.hydrate(attrs.scrollChange)&&isOnScreen()})}}}});