!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],factory):factory(root.Stratus,root._)}(this,function(Stratus,_){Stratus.Directives.Src=function($parse,$interpolate){return{restrict:"A",scope:{stratusSrc:"@stratusSrc"},link:function($scope,$element,$attrs){Stratus.Instances[_.uniqueId("src_")]=$scope,$scope.registered=!1,$scope.register=function(){return!!$scope.registered||($scope.registered=!0,$element.attr("data-src","lazy"),Stratus.RegisterGroup.add("OnScroll",{method:Stratus.Internals.LoadImage,el:$element,spy:$element.data("spy")?Stratus($element.data("spy")):$element}),void Stratus.Internals.OnScroll())},$scope.src=$attrs.stratusSrc||$element.attr("src"),$scope.interpreter=$interpolate($scope.src,!1,null,!0),$scope.initial=$scope.interpreter($scope.$parent),angular.isDefined($scope.initial)?($element.attr("src",$scope.initial),$scope.register()):$scope.$watch(function(){return $scope.interpreter($scope.$parent)},function(value){angular.isDefined(value)&&($element.attr("src",value),$scope.register())})}}}});