!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular"],factory):factory(root.Stratus,root._,root.$,root.angular)}(this,function(Stratus,_,$,angular){Stratus.Directives.Src=function($parse,$interpolate){return{restrict:"A",scope:{src:"@src",stratusSrc:"@stratusSrc"},link:function($scope,$element,$attr){Stratus.Instances[_.uniqueId("src_")]=$scope,$scope.whitelist=["jpg","jpeg","png"],$scope.filter=null,$scope.$watch(function(){return $attr.stratusSrc||$attr.src},function(newVal,oldVal,scope){newVal&&$element.attr("data-size")&&($scope.registered=!1),$scope.register()}),$scope.registered=!1,$scope.register=function(){const src=$attr.stratusSrc||$attr.src||null;let ext=src?src.match(/\.([0-9a-z]+)(\?.*)?$/i):null;return ext&&(ext=ext[1]?ext[1].toLowerCase():null),$scope.filter=_.filter($scope.whitelist,function(value){return ext===value}),!_.size($scope.filter)||(!!$scope.registered||($scope.registered=!0,$element.attr("data-src",src),$scope.group={method:Stratus.Internals.LoadImage,el:$element,spy:$element.data("spy")?$($element.data("spy")):$element},Stratus.Internals.OnScroll(),Stratus.RegisterGroup.add("OnScroll",$scope.group),void Stratus.Internals.LoadImage($scope.group)))}}}}});