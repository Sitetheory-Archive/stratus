!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","angular","angular-material"],factory):factory(root.Stratus,root.$,root._)}(this,function(Stratus,$,_){Stratus.Components.Permissions={bindings:{permissionId:"="},controller:function($scope,$timeout,$attrs,$http){var $ctrl=this;Stratus.Internals.CssLoader(Stratus.BaseUrl+"sitetheorystratus/stratus/components/permissions"+(Stratus.Environment.get("production")?".min":"")+".css"),$scope.permissions=[],$scope.permissionSelected=[],$scope.userRoleSelected=null,$scope.contentSelected=null,$scope.loadPermissions=function(){return $timeout(function(){$scope.permissions=[{value:1,name:"View"},{value:2,name:"Create"},{value:4,name:"Edit"},{value:8,name:"Delete"},{value:16,name:"Publish"},{value:32,name:"Design"},{value:64,name:"Dev"},{value:128,name:"Master"}]},400)},$scope.processSelectAction=function(){-1==$scope.permissionSelected.indexOf(128)&&$scope.permissionSelected.length!=$scope.permissions.length-1||($scope.permissionSelected=[$scope.permissions[$scope.permissions.length-1].value])},$scope.identityQuery=function(collection,query){var results=collection.filter(query);return Promise.resolve(results).then(function(value){var response=[];return value.User&&(response=response.concat(value.User)),value.Role&&(response=response.concat(value.Role)),value.User||value.Role||(response=response.concat(value)),response})},$scope.contentQuery=function(collection,query){var results=collection.filter(query);return Promise.resolve(results).then(function(value){var response=[];return value.Bundle&&(angular.forEach(value.Bundle,function(bundle,index){value.Bundle[index].assetType="SitetheoryContentBundle:Bundle"}),response=response.concat(value.Bundle)),value.Content&&(angular.forEach(value.Content,function(content,index){value.Content[index].assetType="Sitetheory"+content.contentType.bundle.name+"Bundle:"+content.contentType.entity}),response=response.concat(value.Content)),value.ContentType&&(angular.forEach(value.ContentType,function(contentType,index){value.ContentType[index].assetType="SitetheoryContentBundle:ContentType"}),response=response.concat(value.ContentType)),value.Bundle||value.Content||value.ContentType||(response=response.concat(value)),response})},$scope.selectedUserRoleChange=function(item){$scope.userRoleSelected=item},$scope.selectedContentChange=function(content){$scope.contentSelected=content},$scope.processDataSubmit=function(){return $scope.userRoleSelected&&$scope.userRoleSelected.name?{identity:{role:$scope.userRoleSelected.id},asset:{asset:"SitetheoryUserBundle:User",id:$scope.contentSelected.id},permissions:$scope.permissionSelected}:{identity:{user:$scope.userRoleSelected.id},asset:{asset:$scope.contentSelected.assetType,id:$scope.contentSelected.id},permissions:$scope.permissionSelected}},$scope.submit=function(){return $http({method:$ctrl.permissionId?"PUT":"POST",url:"/Api/Permission",data:$scope.processDataSubmit(),headers:{"Content-Type":"application/json"}}).then(function(response){console.log("response",response)},function(response){console.log("response error",response)})}},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/permissions"+(Stratus.Environment.get("production")?".min":"")+".html"}});