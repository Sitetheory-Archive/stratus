!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","zxcvbn"],factory):factory(root.Stratus,root._,root.angular,root.zxcvbn)}("undefined"!=typeof self?self:this,function(Stratus,_,angular,zxcvbn){Stratus.Components.UserAuthentication={controller:function($scope,$window,$attrs,$log,$http,$mdDialog){function showForgotPassForm(isShow){$ctrl.errorMsg=null,$ctrl.forgotPassText=isShow?"Back to login":"Forgot Password?",$ctrl.enabledForgotPassForm=isShow,isShow||onTabSelected($ctrl.signInIndex)}function backToLogin(){$ctrl.errorMsg=null,$ctrl.isHandlingUrl=!1}function verifyAccount(){var data={type:"verify",email:getUrlParams().email,token:getUrlParams().token};$http({method:"POST",url:url,data:data}).then(function(response){var message=(getStatus(response).code,getStatus(response).message);$ctrl.errorMsg=message,$ctrl.enabledVerifyForm=!1,$ctrl.enabledResetPassForm=!0,$ctrl.resetPassHeaderText="Please set your password",$ctrl.changePassBtnText="Update password"},function(error){console.log(error)})}function onTabSelected(index){$ctrl.selectedIndex=index,$ctrl.errorMsg=null}function doSignIn(signinData){$ctrl.errorMsg=null;var data={email:signinData.email,password:signinData.password};$http({method:"POST",url:loginUrl,data:data}).then(function(response){var code=getStatus(response).code,message=getStatus(response).message;return"SUCCESS"==code?$window.location.href="/":void($ctrl.errorMsg=message)},function(error){console.log(error)})}function doSignUp(signupData){$ctrl.errorMsg=null;var data={email:signupData.email,phone:cleanedPhoneNumber(signupData.phone)};$http({method:"POST",url:url,data:data}).then(function(response){var code=getStatus(response).code,message=getStatus(response).message;return"SUCCESS"==code?$window.location.href="/":void($ctrl.errorMsg=message)},function(error){console.log(error)})}function doRequestResetPass(resetPassData){$ctrl.errorMsg=null;var data={type:"reset-password-request",email:resetPassData.email,phone:cleanedPhoneNumber(resetPassData.phone)};$http({method:"POST",url:url,data:data}).then(function(response){$ctrl.errorMsg=getStatus(response).message},function(error){console.log(error)})}function doResetPass(resetPassData){if($ctrl.errorMsg=null,resetPassData.password!==resetPassData.confirm_password)return void($ctrl.errorMsg="Password and Confirm password must be identical");var requestType="verify"===getUrlParams().type?"update-password":getUrlParams().type,data={type:requestType,email:getUrlParams().email,token:getUrlParams().token,password:resetPassData.password};$http({method:"POST",url:url,data:data}).then(function(response){var code=getStatus(response).code,message=getStatus(response).message;return"SUCCESS"==code?($ctrl.isHandlingUrl=!1,$window.location.href="/Member/Sign-In"):void($ctrl.errorMsg=message)},function(error){console.log(error)})}function validPassword(password){var passwordRegex=/^(?:(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*)$/;return password.length>=8&&passwordRegex.test(password)}function cleanedPhoneNumber(phone){var keepNumberOnlyRegex=/\D+/g;return phone.replace(keepNumberOnlyRegex,"")}function getUrlParams(){var url=new URL($window.location.href);return{type:url.searchParams.get("type"),email:url.searchParams.get("email"),token:url.searchParams.get("token")}}function getStatus(response){return response.data.meta.status[0]}function generateProgressBar(password){switch(zxcvbn(password).score){case 0:$ctrl.progressBarClass="risky",$ctrl.progressBarValue=20;break;case 1:$ctrl.progressBarClass="guessable",$ctrl.progressBarValue=40;break;case 2:$ctrl.progressBarClass="safely",$ctrl.progressBarValue=60;break;case 3:$ctrl.progressBarClass="moderate",$ctrl.progressBarValue=80;break;case 4:$ctrl.progressBarClass="strong",$ctrl.progressBarValue=100}}this.uid=_.uniqueId("user_authentication_"),Stratus.Internals.CssLoader(Stratus.BaseUrl+"sitetheorystratus/stratus/components/userAuthentication"+(Stratus.Environment.get("production")?".min":"")+".css"),Stratus.Instances[this.uid]=$scope,$scope.elementId=$attrs.elementId||this.uid;var $ctrl=this,url="/Api/User",loginUrl="/Api/Login";$ctrl.signinData={},$ctrl.resetPassData={},$ctrl.allowSubmit=!1,$ctrl.signInIndex=0,$ctrl.signUpIndex=1,$ctrl.emailRegex=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/i,$ctrl.phoneRegex=/^[\d+\-()]+$/,$ctrl.enabledForgotPassForm=!1,$ctrl.isHandlingUrl=null!==getUrlParams().type,$ctrl.enabledResetPassForm="reset-password"===getUrlParams().type,$ctrl.resetPassHeaderEmail="reset-password"===getUrlParams().type?getUrlParams().email:null,$ctrl.enabledVerifyForm="verify"===getUrlParams().type,$ctrl.forgotPassText="Forgot Password?",$ctrl.resetPassHeaderText="Reset your account password",$ctrl.changePassBtnText="Reset Password",$ctrl.selectedIndex=$ctrl.signInIndex,$ctrl.errorMsg=null,$ctrl.showForgotPassForm=showForgotPassForm,$ctrl.doSignIn=doSignIn,$ctrl.doSignUp=doSignUp,$ctrl.doRequestResetPass=doRequestResetPass,$ctrl.doResetPass=doResetPass,$ctrl.onTabSelected=onTabSelected,$ctrl.backToLogin=backToLogin,$ctrl.verifyAccount=verifyAccount,$scope.$watch(angular.bind(this,function(){return _.isEmpty(this.signinData)?_.isEmpty(this.resetPassData)?void 0:this.resetPassData.password:this.signinData.password}),function(newValue,oldValue){void 0!==newValue&&newValue!==oldValue&&($ctrl.progressBarClass=null,$ctrl.progressBarValue=null,generateProgressBar(newValue),validPassword(newValue)?$ctrl.progressBarValue<=40?($ctrl.errorMsg="Your password is not strong.",$ctrl.allowSubmit=!0):($ctrl.errorMsg="",$ctrl.allowSubmit=!0):$ctrl.errorMsg="Password must contain at least 8 characters, 1 lower and uppercase letter and 1 number.")})},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/userAuthentication"+(Stratus.Environment.get("production")?".min":"")+".html"}});