!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","zxcvbn","stratus.services.userAuthentication","stratus.components.singleSignOn","stratus.directives.passwordCheck"],factory):factory(root.Stratus,root._,root.angular,root.zxcvbn)}("undefined"!=typeof self?self:this,function(Stratus,_,angular,zxcvbn){Stratus.Components.UserAuthentication={controller:function($scope,$window,$attrs,userAuthentication){function verifyAccount(){$ctrl.loading=!0;var data={type:"verify",email:getUrlParams().email,token:getUrlParams().token};userAuthentication.verifyAccount(data).then(function(response){$ctrl.loading=!1,getStatus(response).code==RESPONSE_CODE.verify?($ctrl.message=getStatus(response).message,$ctrl.isRequestSuccess=!0,$ctrl.enabledVerifyForm=!1,$ctrl.enabledResetPassForm=!0,$ctrl.resetPassHeaderText="Please set your password",$ctrl.changePassBtnText="Update password"):($ctrl.isRequestSuccess=!1,$ctrl.message=getStatus(response).message)})}function doSignIn(signinData){$ctrl.loading=!0,$ctrl.message=null;var data={email:signinData.email,password:signinData.password};userAuthentication.signIn(data).then(function(response){return $ctrl.loading=!1,getStatus(response).code==RESPONSE_CODE.success?$window.location.href="/":($ctrl.isRequestSuccess=!1,void($ctrl.message=getStatus(response).message))})}function doSignUp(signupData){$ctrl.loading=!0,$ctrl.message=null;var data={email:signupData.email,phone:cleanedPhoneNumber(signupData.phone)};userAuthentication.signUp(data).then(function(response){return $ctrl.loading=!1,getStatus(response).code==RESPONSE_CODE.success?$window.location.href="/":($ctrl.isRequestSuccess=!1,void($ctrl.message=getStatus(response).message))})}function doRequestResetPass(resetPassData){$ctrl.loading=!0,$ctrl.message=null;var data={type:"reset-password-request",email:resetPassData.email,phone:cleanedPhoneNumber(resetPassData.phone)};userAuthentication.requestResetPass(data).then(function(response){$ctrl.loading=!1,getStatus(response).code==RESPONSE_CODE.success?$ctrl.isRequestSuccess=!0:$ctrl.isRequestSuccess=!1,$ctrl.message=getStatus(response).message})}function doResetPass(resetPassData){$ctrl.loading=!0,$ctrl.message=null;var requestType="verify"===getUrlParams().type?"update-password":getUrlParams().type,data={type:requestType,email:getUrlParams().email,token:getUrlParams().token,password:resetPassData.password};userAuthentication.resetPass(data).then(function(response){$ctrl.loading=!1,getStatus(response).code==RESPONSE_CODE.success?$window.location.href=$window.location.origin+"/Member/Sign-In":($ctrl.isRequestSuccess=!1,$ctrl.message=getStatus(response).message)})}function showForgotPassForm(isShow){$ctrl.message=null,$ctrl.forgotPassText=isShow?"Back to login":"Forgot Password?",$ctrl.enabledForgotPassForm=isShow,isShow||onTabSelected($ctrl.signInIndex)}function backToLogin(){$ctrl.message=null,$ctrl.isHandlingUrl=!1}function onTabSelected(index){$ctrl.selectedIndex=index,$ctrl.message=null}function validPassword(password){var passwordRegex=/^(?:(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*)$/;return password.length>=8&&passwordRegex.test(password)}function cleanedPhoneNumber(phone){var keepNumberOnlyRegex=/\D+/g;return phone.replace(keepNumberOnlyRegex,"")}function getUrlParams(){var url=new URL($window.location.href);return{type:url.searchParams.get("type"),email:url.searchParams.get("email"),token:url.searchParams.get("token")}}function getStatus(response){return response.data.meta.status[0]}function generateProgressBar(password){switch(zxcvbn(password).score){case 0:$ctrl.progressBarClass="risky",$ctrl.progressBarValue=20;break;case 1:$ctrl.progressBarClass="guessable",$ctrl.progressBarValue=40;break;case 2:$ctrl.progressBarClass="safely",$ctrl.progressBarValue=60;break;case 3:$ctrl.progressBarClass="moderate",$ctrl.progressBarValue=80;break;case 4:$ctrl.progressBarClass="strong",$ctrl.progressBarValue=100}}this.uid=_.uniqueId("user_authentication_"),Stratus.Internals.CssLoader(Stratus.BaseUrl+"sitetheorystratus/stratus/components/userAuthentication"+(Stratus.Environment.get("production")?".min":"")+".css"),Stratus.Instances[this.uid]=$scope,$scope.elementId=$attrs.elementId||this.uid;var $ctrl=this;$ctrl.signinData={},$ctrl.resetPassData={},$ctrl.allowSubmit=!1,$ctrl.loading=!1,$ctrl.signInIndex=0,$ctrl.signUpIndex=1,$ctrl.emailRegex=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/i,$ctrl.phoneRegex=/^[\d+\-().]+$/,$ctrl.enabledForgotPassForm=!1,$ctrl.isHandlingUrl=null!==getUrlParams().type,$ctrl.enabledResetPassForm="reset-password"===getUrlParams().type,$ctrl.resetPassHeaderEmail="reset-password"===getUrlParams().type?getUrlParams().email:null,$ctrl.enabledVerifyForm="verify"===getUrlParams().type,$ctrl.forgotPassText="Forgot Password?",$ctrl.resetPassHeaderText="Reset your account password",$ctrl.changePassBtnText="Reset Password",$ctrl.selectedIndex=$ctrl.signInIndex,$ctrl.message=null,$ctrl.isRequestSuccess=!1;var RESPONSE_CODE={verify:"VERIFY",success:"SUCCESS"};$ctrl.showForgotPassForm=showForgotPassForm,$ctrl.doSignIn=doSignIn,$ctrl.doSignUp=doSignUp,$ctrl.doRequestResetPass=doRequestResetPass,$ctrl.doResetPass=doResetPass,$ctrl.onTabSelected=onTabSelected,$ctrl.backToLogin=backToLogin,$ctrl.verifyAccount=verifyAccount,$scope.$watch(angular.bind(this,function(){return _.isEmpty(this.signinData)?_.isEmpty(this.resetPassData)?void 0:($ctrl.isRequestSuccess=!1,this.resetPassData.password):this.signinData.password}),function(newValue,oldValue){void 0!==newValue&&newValue!==oldValue&&($ctrl.progressBarClass=null,$ctrl.progressBarValue=null,generateProgressBar(newValue),newValue.length>=8&&!validPassword(newValue)?$ctrl.message="Your password must be at 8 or more characters and contain at least one lower and uppercase letter and one number.":($ctrl.message=null,$ctrl.allowSubmit=!0))})},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/userAuthentication"+(Stratus.Environment.get("production")?".min":"")+".html"}});