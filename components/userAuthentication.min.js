!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","angular-material","zxcvbn"],factory):factory(root.Stratus,root._)}(this,function(Stratus,_){Stratus.Components.UserAuthentication={controller:function($scope,$window,$attrs,$log,$http,$mdDialog){function showForgotPassForm(isShow){$ctrl.errorMsg=null,$ctrl.forgotPassText=isShow?"Back to login":"Forgot Password?",$ctrl.enabledForgotPassForm=isShow,isShow||onTabSelected($ctrl.signInIndex)}function backToLogin(){$ctrl.errorMsg=null,$ctrl.isHandlingUrl=!1}function verifyAccount(){var data={type:"verify",email:getUrlParams().email,token:getUrlParams().token};$http({method:"POST",url:url,data:data}).then(function(response){var message=(getStatus(response).code,getStatus(response).message);$ctrl.errorMsg=message,$ctrl.enabledVerifyForm=!1,$ctrl.enabledResetPassForm=!0,$ctrl.resetPassHeaderText="Please set your password",$ctrl.changePassBtnText="Update password"},function(error){console.log(error)})}function onTabSelected(index){$ctrl.selectedIndex=index,$ctrl.errorMsg=null}function doSignIn(signinData){return void console.log(signinData)}function doSignUp(signupData){$ctrl.errorMsg=null;var data={email:signupData.email,phone:cleanedPhoneNumber(signupData.phone)};$http({method:"POST",url:url,data:data}).then(function(response){var code=getStatus(response).code,message=getStatus(response).message;return"SUCCESS"==code?$window.location.href="/":void($ctrl.errorMsg=message)},function(error){console.log(error)})}function doRequestResetPass(resetPassData){$ctrl.errorMsg=null;var data={type:"reset-password-request",email:resetPassData.email,phone:cleanedPhoneNumber(resetPassData.phone)};$http({method:"POST",url:url,data:data}).then(function(response){$ctrl.errorMsg=getStatus(response).message},function(error){console.log(error)})}function doResetPass(resetPassData){if($ctrl.errorMsg=null,resetPassData.password!==resetPassData.confirm_password)return void($ctrl.errorMsg="Password and Confirm password must be identical");var requestType="verify"===getUrlParams().type?"update-password":getUrlParams().type,data={type:requestType,email:getUrlParams().email,token:getUrlParams().token,password:resetPassData.password};$http({method:"POST",url:url,data:data}).then(function(response){var code=getStatus(response).code,message=getStatus(response).message;return"SUCCESS"==code?($ctrl.isHandlingUrl=!1,$window.location.href="/"):void($ctrl.errorMsg=message)},function(error){console.log(error)})}function cleanedPhoneNumber(phone){var keepNumberOnlyRegex=/\D+/g;return phone.replace(keepNumberOnlyRegex,"")}function getUrlParams(){var url=new URL($window.location.href);return{type:url.searchParams.get("type"),email:url.searchParams.get("email"),token:url.searchParams.get("token")}}function getStatus(response){return response.data.meta.status[0]}var x=zxcvbn("kh2k3jrehwkkj3jwkresd");console.log(x),this.uid=_.uniqueId("user_authentication_"),Stratus.Internals.CssLoader(Stratus.BaseUrl+"sitetheorystratus/stratus/components/userAuthentication"+(Stratus.Environment.get("production")?".min":"")+".css"),Stratus.Instances[this.uid]=$scope,$scope.elementId=$attrs.elementId||this.uid;var $ctrl=this,url="/Api/User";$ctrl.passwordStrength=null,$ctrl.signInIndex=0,$ctrl.signUpIndex=1,$ctrl.emailRegex=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/i,$ctrl.passwordRegex=/^(?:(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*)$/,$ctrl.phoneRegex=/^[\d+\-()]+$/,$ctrl.enabledForgotPassForm=!1,$ctrl.isHandlingUrl=null!==getUrlParams().type,$ctrl.enabledResetPassForm="reset-password"===getUrlParams().type,$ctrl.enabledVerifyForm="verify"===getUrlParams().type,$ctrl.forgotPassText="Forgot Password?",$ctrl.resetPassHeaderText="Reset your account password",$ctrl.changePassBtnText="Reset Password",$ctrl.selectedIndex=$ctrl.signInIndex,$ctrl.errorMsg=null,$ctrl.showForgotPassForm=showForgotPassForm,$ctrl.doSignIn=doSignIn,$ctrl.doSignUp=doSignUp,$ctrl.doRequestResetPass=doRequestResetPass,$ctrl.doResetPass=doResetPass,$ctrl.onTabSelected=onTabSelected,$ctrl.backToLogin=backToLogin,$ctrl.verifyAccount=verifyAccount},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/userAuthentication"+(Stratus.Environment.get("production")?".min":"")+".html"}});
