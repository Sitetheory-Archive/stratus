!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","zxcvbn","stratus.services.userAuthentication"],factory):factory(root.Stratus,root._,root.angular,root.zxcvbn)}("undefined"!=typeof self?self:this,function(Stratus,_,angular,zxcvbn){Stratus.Components.PasswordReset={binding:{userEmail:"@"},controller:function($scope,$window,$attrs,userAuthentication){function doResetPass(resetPassData){$ctrl.loading=!0,isRequested=!0;var requestType=getUrlParams().token?"reset-pasword":"change-password",data={type:requestType,email:$attrs.userEmail,token:getUrlParams().token,password:resetPassData.password};userAuthentication.resetPass(data).then(function(response){$ctrl.loading=!1,getStatus(response).code==RESPONSE_CODE.success?$ctrl.isRequestSuccess=!0:$ctrl.isRequestSuccess=!1,$ctrl.message=getStatus(response).message})}function validPassword(password){var passwordRegex=/^(?:(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).*)$/;return password.length>=8&&passwordRegex.test(password)}function getUrlParams(){var url=new URL($window.location.href);return{type:url.searchParams.get("type"),email:url.searchParams.get("email"),token:url.searchParams.get("token")}}function getStatus(response){return response.data.meta.status[0]}function generateProgressBar(password){switch(zxcvbn(password).score){case 0:$ctrl.progressBarClass="risky",$ctrl.progressBarValue=20;break;case 1:$ctrl.progressBarClass="guessable",$ctrl.progressBarValue=40;break;case 2:$ctrl.progressBarClass="safely",$ctrl.progressBarValue=60;break;case 3:$ctrl.progressBarClass="moderate",$ctrl.progressBarValue=80;break;case 4:$ctrl.progressBarClass="strong",$ctrl.progressBarValue=100}}this.uid=_.uniqueId("password_reset_"),Stratus.Internals.CssLoader(Stratus.BaseUrl+"sitetheorystratus/stratus/components/passwordReset"+(Stratus.Environment.get("production")?".min":"")+".css"),Stratus.Instances[this.uid]=$scope,$scope.elementId=$attrs.elementId||this.uid;var $ctrl=this;$ctrl.resetPassData={},$ctrl.loading=!1,$ctrl.isRequestSuccess=!1;var isRequested=!1,RESPONSE_CODE={verify:"VERIFY",success:"SUCCESS"};$ctrl.doResetPass=doResetPass,$scope.$watch(angular.bind(this,function(){if(!isRequested){$ctrl.isRequestSuccess=!1;var password=this.resetPassData.password,confirmPassword=this.resetPassData.confirm_password;return password&&validPassword(password)&&$ctrl.progressBarValue>=40&&(password!==confirmPassword?$ctrl.message="Your password did not match.":$ctrl.message=null),password}}),function(newValue,oldValue){void 0!==newValue&&newValue!==oldValue&&($ctrl.progressBarClass=null,$ctrl.progressBarValue=null,generateProgressBar(newValue),validPassword(newValue)?($ctrl.message=null,$ctrl.allowSubmit=!0):$ctrl.message="Your password must be at 8 or more characters and contain at least one lower and uppercase letter and one number.")})},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/passwordReset"+(Stratus.Environment.get("production")?".min":"")+".html"}});