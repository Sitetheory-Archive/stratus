<div id="media-library">

    <!-- Media Selector -->
    <div ng-if="$ctrl.isSelector"
         class="media-selector sectionContainer selectedContainer borderDefault borderDefaultAll borderRadiusDefault">
        <p ng-if="!$ctrl.isSelector" class="instructions fontBody clearfix">
            <a href="#" ng-click="$ctrl.toggleLibrary()" class="nothingSelectedTextLink">Open library to select
                media.</a>
        </p>
        <p class="smallLabel selectedMediaLabel">Media</p>
        <div id="selectedDropArea"
             ng-class="{'dragBorder':dragClass}"
             ng-model="files"
             name="files"
             ngf-multiple="true"
             ngf-before-model-change="beforeChange($files,$event)"
             ngf-drop="$ctrl.openUploader(true, $files, $invalidFiles)"
             ngf-max-files="10"
             ngf-model-invalid="invalidFiles"
             ngf-validate="{size: {max: '10MB'}}"
             ngf-drag-over-class="dragover"
             ngf-model-options="{updateOn: 'select drop', allowInvalid: false, debounce: 0}">
            <ul class="listInline" stratus-sortable ng-sortable="$ctrl.draggedFiles"
                ng-sortable-item-selector=".draggableImg">
                <li class="draggableImg libraryItem" ng-if="$ctrl.draggedFiles.length"
                    ng-repeat="df in $ctrl.draggedFiles">
                    <a href="#">
                        <div ng-if="df.mime.indexOf('image') > -1" class="imageDraggable" id="libb_{{media.data.id}}">
                            <img id="{{df.id}}" class="selectImgDrag" ng-src="{{df.url || df.file}}">
                        </div>
                        <div ng-if="df.mime == 'video'" class="positionCenter">
                            <i class="fas fa-5x fa-file-video document" aria-hidden="true"></i>
                        </div>
                        <div ng-if="df.mime == 'application/pdf'" class="positionCenter">
                            <i class="fas fa-5x fa-file-pdf document" aria-hidden="true"></i>
                        </div>
                        <div ng-if="df.mime == 'application/msword'" class="positionCenter">
                            <i class="fas fa-5x fa-file-word document" aria-hidden="true"></i>
                        </div>
                    </a>
                    <div class="imageInfoContainer">
                        <div class="imageHoverInfo borderRadiusDefault">
                            <div class="format-size">
                                <div class="smallLabel fileDetails">
                                    <span class="fileType">{{ df.extension | uppercase }}</span><span
                                        class="delimiter"></span><span
                                        class="fileSize">{{media.data.bytesHuman}}</span>
                                </div>
                            </div>
                            <p class="fontBody imgTitle">{{ df.name || 'No title' }}</p>
                            <div class="positionActionArea">
                                <div class="clearfix actionBtns">
                                    <a href="#" ng-click="$ctrl.showDetails(df)" class="infoIcon">
                                        <md-tooltip>Image details</md-tooltip>
                                        <md-icon
                                                md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/info.svg"></md-icon>
                                    </a>
                                    <a href="#" class="deleteIcon">
                                        <md-tooltip>Remove selection</md-tooltip>
                                        <md-icon aria-hidden="true" ng-click="$ctrl.removeFromSelected(df.id);"
                                                 md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/clear.svg"></md-icon>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="libraryToggle">
                    <a class="positionAnchor accentBackgroundHover borderDefault borderDefaultAll colorAccent1" href="#"
                       ng-click="$ctrl.toggleLibrary()">
                        <md-tooltip>Open Media Library</md-tooltip>
                        <div ng-class="dragDropClass" aria-hidden="true">
                            <md-icon class="positionCenter"
                                     md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/add.svg"></md-icon>
                            <img class="shapeholder"
                                 src="/assets/1/0/bundles/sitetheorycore/images/shapeholderSquare.png">
                        </div>
                    </a>
                </li>
            </ul>
        </div>
        <!-- Gl Content Ends -->
    </div>

    <!-- Media Library -->
    <div ng-if="$ctrl.showLibrary" id="openLibrary" class="media-library-content">
        <div class="sectionContainer mediaLibrary backgroundDark borderRadiusDefault">

            <div class="library-content">
                <div class="clearfix">
                    <div class="stGrid stGridTablet column15">
                        <md-button class="btn md-ink-ripple open-uploader"
                                ng-click="$ctrl.openUploader(true)">Add +
                        </md-button>
                    </div>
                    <stratus-search class="mediaSearch stGrid stGridTablet column55"></stratus-search>
                    <div class="stGrid stGridTablet column10">&nbsp;</div>
                    <div class="stGrid stGridTablet column20 positionAnchor">
                        <div class="thumb-slider">
                            <div class="thumb-icon-large">
                                <md-icon
                                        md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/layoutTypeIcon/gridXLarge.svg"></md-icon>
                            </div>
                            <div class="thumb-icon-small">
                                <md-icon
                                        md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/layoutTypeIcon/gridsmall.svg"></md-icon>
                            </div>
                            <h4 class="smallLabel">Thumb size</h4>

                            <!-- TODO: Give the slider a default value and then set the high and low end further apart. The angular example set random colors but we just need one set default of 120. Here is the angular example:

                            $scope.color = {
                              red: Math.floor(Math.random() * 255),
                              green: Math.floor(Math.random() * 255),
                              blue: Math.floor(Math.random() * 255)
                            }; -->

                            <md-slider min="100" max="165" ng-model="thumbColumn.changeSize" aria-label="thumb size" id="thumb-slider"></md-slider>
                        </div>
                    </div>
                </div>
                <ul class="listInline medias"
                     ngf-drop="$ctrl.openUploader(true, $files, $invalidFiles)"
                     ngf-multiple="true"
                     ngf-max-files="10"
                     ngf-model-invalid="invalidFiles"
                     ngf-validate="{size: {max: '10MB'}, pattern: '.jpg,.png,.pdf,.doc'}">
                    <li ng-repeat="media in collection.models" class="media-item" ng-if="media.data.url || media.data.file"
                         ng-class="{selected: $ctrl.isSelector && media.data.selectedClass}" style="width: {{thumbColumn.changeSize/10}}%;">
                        <div class="libraryItem positionAnchor">

                            <!-- Video Thumb -->
                            <div ng-if="media.data.mime == 'video'" class="imageDraggable" style="background: url('{{$ctrl.getThumbnailImgOfVideo(media.data)}}') no-repeat center center; background-size: cover;">
                                <img class="shapeholder" src="/assets/1/0/bundles/sitetheorycore/images/shapeholderSquare.png">
                            </div>

                            <i ng-if="media.data.mime == 'application/pdf'" class="fas fa-5x fa-file-pdf document"
                               aria-hidden="true"></i>
                            <i ng-if="media.data.mime == 'application/msword'" class="fas fa-5x fa-file-word document"
                               aria-hidden="true"></i>

                            <!-- Image Thumb -->
                            <div ng-if="media.data.mime.indexOf('image') > -1" class="imageDraggable" style="background: url('{{media.data.url}}') no-repeat center center; background-size: cover;">
                                <img class="shapeholder" src="/assets/1/0/bundles/sitetheorycore/images/shapeholderSquare.png">
                            </div>

                            <!--
                            TODO: Discuss merits of lazy loading vs. background image
                            <img ng-if="media.data.mime.indexOf('image') > -1" data-plugin="lazy"
                                 src="{{media.data.url || media.data.file}}"
                                 stratus-src="{{media.data.url || media.data.file}}">-->

                            <!-- Info mini pop-up -->
                            <div class="imageInfoContainer" ng-mouseenter="hovering = true" ng-mouseleave="hovering = false">
                                <div class="imageHoverInfo borderRadiusDefault">
                                    <div class="format-size">
                                        <div class="smallLabel fileDetails">
                                            <span class="fileType">{{media.data.extension|uppercase}}</span><span
                                                class="delimiter"></span><span class="fileSize">{{media.data.bytesHuman}}</span>
                                        </div>
                                    </div>
                                    <p class="fontBody imgTitle">{{media.data.name || 'No title'}}</p>
                                    <!-- <div class="time"><p>{{media.data.time *1000 | date: 'MMM dd, yyyy h:mma'}}</p></div> -->
                                    <div class="positionActionArea">
                                        <div class="clearfix actionBtns">
                                            <i aria-hidden="true"
                                               ng-click="$ctrl.showDetails(media.data)" class="infoIcon">
                                                <md-tooltip>Image details</md-tooltip>
                                                <md-icon
                                                        md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/info.svg"></md-icon>
                                            </i>
                                            <i  aria-hidden="true"
                                                ng-click="$ctrl.deleteMedia(media.data.id)" class="deleteIcon">
                                                <md-tooltip>Permanently delete from libary</md-tooltip>
                                                <md-icon class="deleteIcon" aria-hidden="true" ng-click="deleteFromMedia(media.data.id);"
                                                         md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/delete.svg"></md-icon>
                                            </i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Info mini pop-up ends -->

                            <!-- Controls -->
                            <div class="addIcon positionCenter">
                                <md-icon md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/add.svg" aria-hidden="true"
                                         ng-click="$ctrl.addOrRemoveFile(media.data.selectedClass, media.data.id)"></md-icon>
                            </div>
                            <div class="minusIcon positionCenter">
                                <md-icon md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/minus.svg"  aria-hidden="true"
                                         ng-click="$ctrl.addOrRemoveFile(media.data.selectedClass, media.data.id)"></md-icon>
                            </div>
                            <div class="checkIcon positionCenter">
                                <md-icon md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/check.svg" aria-hidden="true"
                                         ng-click="$ctrl.showDetails(media.data)"></md-icon>
                            </div>
                            <!-- Controls End -->

                        </div>

                    </li>
                </ul>
                <div ng-if="collection.completed && !collection.models.length">
                    <span ng-if="!collection.meta.attributes.api.q && !collection.meta.attributes.api.options "
                          class="info">Welcome, looks like you are new here. Click the add button above to upload your first files.</span>
                    <span ng-if="collection.meta.attributes.api.q || collection.meta.attributes.api.options" class="info">Looks like your search didn't match any media items. Try again?</span>
                </div>
            </div>
            <div class="library-footer nav-button">
                <stratus-pagination scroll-top-element="media-library"></stratus-pagination>
            </div>
        </div>
    </div>
</div>
