!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","angular-material","stratus.services.socialLibraries","stratus.services.commonMethods"],factory):factory(root.Stratus,root._)}(this,function(Stratus,_){Stratus.Components.SingleSignOn={bindings:{},controller:function($rootScope,$scope,$window,$attrs,$log,$http,$mdDialog,socialLibraries,commonMethods){function FbGetBasicProfile(){FB.api("/me?fields=name,email,gender,locale,link,picture",function(response){doSignIn(response,"facebook",!0)},{scope:["email","name","gender","locale","phone","picture"]})}function emitParrent(socialName,response){data=response,$scope.$parent.requireEmail(socialName,data)}function doSignIn(data,service,truthData){$http({method:"POST",url:loginUrl,data:{service:service,data:data,truthData:truthData},headers:{"Content-Type":"application/json"}}).then(function(response){switch(console.log("response",response),response.data.meta.status[0].code){case"CREDENTIALS":data.message=response.data.meta.status[0].message,emitParrent(service,data);break;default:$window.location.href="/"}},function(error){console.log(error)})}commonMethods.componentInitializer(this,$scope,$attrs,"single_sign_on",!0),socialLibraries.loadFacebookSDK(),socialLibraries.loadGGLibrary();var data,loginUrl="/Api/Login";window.checkLoginState=function(){FB.getLoginStatus(function(response){switch(response.status){case"connected":case"not_authorized":FbGetBasicProfile();break;default:FB.login(function(response){null!=response.authResponse?FbGetBasicProfile():FB.login()},{scope:["email","name","gender","locale","phone","picture"]})}})},$scope.$on("doSocialSignup",function(event,email){data.email=email,doSignIn(data,"facebook",!1)}),window.onbeforeunload=function(e){gapi.auth2.getAuthInstance().signOut()},window.onSignIn=function(googleUser){var profile=googleUser.getBasicProfile();doSignIn({email:profile.getEmail(),name:profile.getName(),id:profile.getId(),picture:profile.getImageUrl()},"google",!0)}},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/singleSignOn"+(Stratus.Environment.get("production")?".min":"")+".html"}});