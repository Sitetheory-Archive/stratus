!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","angular-material","masonry","angular-file-upload","angular-drag-and-drop-lists","stratus.components.mediaLibrary","stratus.components.mediaDetails","stratus.components.mediaShortDetails","stratus.components.mediaUploader","stratus.directives.singleClick","stratus.directives.src","stratus.services.registry","stratus.services.media"],factory):factory(root.Stratus,root._,root.jQuery,root.angular)}(this,function(Stratus,_,jQuery,angular){const min=Stratus.Environment.get("production")?".min":"",name="mediaSelector";Stratus.Modules.ngFileUpload=!0,Stratus.Modules.dndLists=!0,Stratus.Components.MediaSelector={bindings:{ngModel:"="},controller:function($scope,$attrs,$mdDialog,Upload,media){const $ctrl=this;function toggleLibrary(){$ctrl.loadLibrary||($ctrl.loadLibrary=!0),$ctrl.showLibrary=!$ctrl.showLibrary}function openUploader(ngfMultiple,files,invalidFiles){$mdDialog.show({attachTo:angular.element(document.querySelector("#listContainer")),controller:function(scope,collection,ngfMultiple,draggedFiles,invalidFiles){scope.collection=collection,scope.ngfMultiple=ngfMultiple,scope.draggedFiles=draggedFiles,scope.invalidFiles=invalidFiles},template:'<stratus-media-uploader collection="collection" ngf-multiple="ngfMultiple" dragged-files="draggedFiles" invalid-files="invalidFiles"></stratus-media-uploader>',clickOutsideToClose:!1,focusOnOpen:!0,autoWrap:!0,multiple:!0,locals:{collection:$scope.collection,ngfMultiple:ngfMultiple,draggedFiles:files,invalidFiles:invalidFiles}})}function updateDraggedFilesPriorities(){var priority=0;$ctrl.draggedFiles.forEach(function(draggedFile){draggedFile.priority=priority++})}$ctrl.uid=_.uniqueId(_.camelToSnake(name)+"_"),Stratus.Instances[$ctrl.uid]=$scope,$scope.elementId=$attrs.elementId||$ctrl.uid,Stratus.Internals.CssLoader(Stratus.BaseUrl+Stratus.BundlePath+"components/"+name+min+".css"),$scope.initialized=!1,Stratus.Internals.CssLoader(Stratus.BaseUrl+Stratus.BundlePath+"components/mediaLibrary"+min+".css"),$ctrl.$onInit=function(){$ctrl.loadLibrary=!1,$ctrl.showLibrary=!1,$ctrl.draggedFiles=[],$ctrl.selectedFileToDrag=null,$ctrl.openUploader=openUploader,$ctrl.toggleLibrary=toggleLibrary,$ctrl.updateDraggedFilesPriorities=updateDraggedFilesPriorities},$scope.getThumbnailImgOfVideo=function(mediaData){return media.getThumbnailImgOfVideo(mediaData)},$scope.showDetails=function(media){$mdDialog.show({attachTo:angular.element(document.querySelector("#listContainer")),controller:function($scope,media,collection){$scope.media=media,$scope.collection=collection},template:'<stratus-media-details media="media" collection="collection"></stratus-media-details>',clickOutsideToClose:!1,focusOnOpen:!0,autoWrap:!0,locals:{media:media,collection:$scope.collection}})},$scope.removeFromSelected=function(fileId){$ctrl.draggedFiles.splice(_.findIndex($ctrl.draggedFiles,function(draggedFile){return draggedFile.id===fileId}),1),$ctrl.loadLibrary&&$scope.$broadcast("mediaSelectorRemoveSelectedFile",fileId)},$scope.$watch("$ctrl.ngModel",function(data){_.isUndefined(data)||_.isEqual($scope.draggedFiles,data)||($ctrl.draggedFiles=data||[])})},templateUrl:Stratus.BaseUrl+Stratus.BundlePath+"components/"+name+min+".html"}});
