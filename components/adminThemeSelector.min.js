!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","angular-material","stratus.services.registry","stratus.services.collection","stratus.services.model","stratus.services.details","stratus.components.search","stratus.components.pagination","stratus.services.commonMethods","stratus.services.adminThemeSelector"],factory):factory(root.Stratus,root._,root.$,root.angular)}("undefined"!=typeof self?self:this,function(Stratus,_,$,angular){Stratus.Components.AdminThemeSelector={bindings:{elementId:"@",ngModel:"=",property:"@",type:"@",limit:"@",multiple:"<",details:"<",search:"<"},controller:function($scope,$mdPanel,$attrs,registry,details,model,$sce,collection,$window,$log,$http,$mdDialog,commonMethods,adminThemeSelector){commonMethods.componentInitializer(this,$scope,$attrs,"admin_theme_selector",!0),$scope.api=!!_.isJSON($attrs.api)&&JSON.parse($attrs.api);var $ctrl=this;if($ctrl.errorMsg=null,$ctrl.heartCollor=[],$ctrl.themes=[],$ctrl.currentThemes=$ctrl.themes,$ctrl.zoomView=function(themeDetail,$event){$scope.themeDetail=themeDetail.data;var position=$mdPanel.newPanelPosition().absolute().center(),config={attachTo:angular.element(document.body),scope:$scope,controllerAs:"ctrl",parent:angular.element(document.body),fullscreen:!1,controller:ZoomController,templateUrl:"themeDetail.html",hasBackdrop:!0,panelClass:"media-dialog",position:position,trapFocus:!0,clickOutsideToClose:!0,escapeToClose:!1,focusOnOpen:!0,zIndex:2};$mdPanel.open(config)},$ctrl.selectedTheme=null,$ctrl.categories=["Lorem ipsum","Lorem ipsum","Lorem ipsum","Lorem ipsum","Lorem ipsum","Lorem ipsum"],$ctrl.sortBy=function(type){$ctrl.currentThemes=function(type){switch(type){case"latest":return $ctrl.currentThemes.sort(function(a,b){return parseFloat(a.data.timeEdit)-parseFloat(b.data.timeEdit)});case"populate":return $ctrl.currentThemes.sort(function(a,b){return parseFloat(b.populate)-parseFloat(a.populate)});case"favorite":return $ctrl.currentThemes.sort(function(a){return $ctrl.favorites.includes(a.id)?-1:1});default:return $ctrl.currentThemes}}(type)},$ctrl.setFavorite=function(id){var index=$ctrl.themes.findIndex(function(x){return x.data.id===id});return $ctrl.themes[index].preferred=!$ctrl.themes[index].preferred},$ctrl.getFavoriteStatus=function(id){var index=$ctrl.themes.findIndex(function(x){return x.data.id===id});return $ctrl.themes[index].preferred?"fa fa-heart favorite":"fa fa-heart-o"},$ctrl.showCategory=function(index){$ctrl.currentThemes=$ctrl.themes.filter(function(theme){return theme.category===$ctrl.categories[index]}),index<0&&($ctrl.currentThemes=$ctrl.themes)},$ctrl.chooseTheme=function(themeData){$ctrl.selectedTheme=themeData},$ctrl.finishChoosingTheme=function(themeData){var data={templateId:themeData.data.id};adminThemeSelector.selectTheme(data).then(function(res){commonMethods.getStatus(res).code===commonMethods.RESPONSE_CODE().success?$window.location.href="/Site/Edit/Success":$ctrl.errorMsg=commonMethods.getStatus(res).message})},$scope.api=!!_.isJSON($attrs.api)&&JSON.parse($attrs.api),$attrs.type){$scope.registry=new registry;var request={target:$attrs.type||"Template",id:null,manifest:!1,decouple:!0,selectedid:$attrs.selectedid,property:$attrs.property,api:{options:{},limit:_.isJSON($attrs.limit)?JSON.parse($attrs.limit):3}};$scope.api&&angular.isObject($scope.api)&&(request.api=_.extendDeep(request.api,$scope.api)),$scope.registry.fetch(request,$scope),$scope.selectedDetails=new details,$scope.selectedDetails.fetch(request,$scope)}$scope.property=$attrs.property||null,$scope.toggleOptions={multiple:!!_.isJSON($attrs.multiple)&&JSON.parse($attrs.multiple)},$scope.$watch("collection.models",function(models){models.length>0&&($ctrl.themes=models,$ctrl.currentThemes=models)}),$scope.themeRawDesc=function(plainText){return $sce.trustAsHtml(plainText)};function ZoomController(mdPanelRef){$scope.closeDialog=function(){mdPanelRef.close()}}},templateUrl:Stratus.BaseUrl+"sitetheorystratus/stratus/components/adminThemeSelector"+(Stratus.Environment.get("production")?".min":"")+".html"}});