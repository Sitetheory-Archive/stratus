//     Stratus.Components.Publish.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
-function(root,factory){"function"==typeof define&&define.amd?define(["stratus","moment","zepto","angular","stratus.components.dateTime"],factory):factory(root.Stratus,root.moment,root.$)}(this,function(Stratus,moment,$){Stratus.Components.Publish={bindings:{ngModel:"=",elementId:"@",versionEntity:"@",action:"@",showDateTime:"@",showUnpublish:"@",showVersionHistory:"@",redirect:"@"},controller:function($scope,$element,$parse,$attrs,$log){var propertyTimePublish="timePublish",uid=_.uniqueId("publish_");if(Stratus.Instances[uid]=$scope,$scope.model=$scope.$parent.model,$scope.versionEntity=$attrs.versionEntity||null,$scope.versionEntity&&$scope.model.has($scope.versionEntity)&&$scope.model.get($scope.versionEntity).has(propertyTimePublish))$scope.version=$scope.model.get($scope.versionEntity);else{if(!$scope.model.has(propertyTimePublish))return console.warn("This entity is either not versionable or a valid data-version-entity was not set"),!1;$scope.version=$scope.model}$log.log("version",$scope.version),$scope.elementId=$attrs.elementId||uid,$scope.action="unpublish"==$attrs.action?"unpublish":"publish",$scope.showDateTime=$attrs.showDateTime||!1,$scope.showUnpublish=$attrs.showUnpublish||!1,$scope.showVersionHistory=$attrs.showVersionHistory||!1,$scope.showMore=!!($scope.showDateTime||$scope.showUnpublish||$scope.showVersionHistory),$scope.timePublish=null;var $dateTimeComponent=null;$scope.showDateTime&&($dateTimeComponent=$("#"+$scope.elementId+" stratus-date-time")),"unpublish"===$scope.action||$dateTimeComponent&&"object"==typeof $dateTimeComponent&&$dateTimeComponent.length&&(3===this.isPublished&&timePublish&&timePublish.unix()===this.timePublish||($scope.timePublish=$scope.version.get(propertyTimePublish))),$scope.redirect=$attrs.redirect||!1,$scope.setTimePublish=function(time){return $log.log("set time publish",time,$scope.version),!!$scope.version&&(time=time||"API::NOW",$scope.version.timePublish=time,void $scope.model.save())},$scope.$watch("timePublish",$scope.setTimePublish(value))},template:'<div ng-if="model.has(versionEntity)" class="customFontPrimary btn-group">                <md-button aria-label="Publish" id="{{ elementId }}" class="btn btnPublish btnPublishNow"                    ng-click="setTimePublish()"                    ng-class="{published: version.isPublished == 1, unpublished: version.isPublished != 1}">                    <div class="btnGradientLight"></div>                    <md-icon class="publishIcon" md-svg-src="/Api/Resource?path=@SitetheoryCoreBundle:images/icons/actionButtons/publish.svg"></md-icon>                    <span class="publishText">Publish</span>                </md-button>                <md-menu ng-if="showMore">                    <div id="dropdownBtn-{{ elementId }}" class="btn btnPublish btnPublishMore">                        <div class="btnGradientLight"></div>                        <span class="caret"></span>                    </div>                    <md-menu-content class="btnPublishDropdown" aria-labelledby="dropdownBtn-{{ elementId }}">                        <!-- TODO: after converting to dateTime component make sure these options are not needed anymore-->                        <stratus-date-time ng-if="showDateTime"                         ng-model="timePublish"                        data-usecurrent="false"                        data-defaultTimestamp="{{ timePublish || null }}"                         data-style="widget"></stratus-date-time>                        <div ng-if="showUnpublish">                            <md-button class="action btnUnpublish" ng-click="setUnpublish()">Unpublish this Version</md-button>                        </div>                        <a ng-if="showRevisionHistory && version" class="btnVersionHistory" href="/Content/Versions/Edit?id={{ model.data.id }}&versionId={{ version.id }}">Revision History</a>                    </md-menu-content>                </md-menu>            </div>'}});