!function(root,factory){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.collection","stratus.services.model"],factory):factory(root.Stratus,root._)}(this,function(Stratus,_){Stratus.Services.Registry=["$provide",function($provide){$provide.factory("registry",function(collection,model,$parse,$interpolate){return function(){this.fetch=function($element,$scope){angular.isString($element)&&($element={target:$element});var data,options={target:$element.attr?$element.attr("data-target"):$element.target,id:$element.attr?$element.attr("data-id"):$element.id,manifest:$element.attr?$element.attr("data-manifest"):$element.manifest,decouple:$element.attr?$element.attr("data-decouple"):$element.decouple,api:$element.attr?$element.attr("data-api"):$element.api};if(_.each(options,function(element,key){element&&(options[key]=$interpolate(element)($scope))}),options.target){if(options.target=_.ucfirst(options.target),options.manifest||options.id){Stratus.Catalog[options.target]||(Stratus.Catalog[options.target]={});var id=options.id||"manifest";options.decouple||!Stratus.Catalog[options.target][id]?(data=new model({target:options.target,manifest:options.manifest},{id:options.id}),options.decouple||(Stratus.Catalog[options.target][id]=data)):Stratus.Catalog[options.target][id]&&(data=Stratus.Catalog[options.target][id])}else Stratus.Catalog[options.target]||(Stratus.Catalog[options.target]={}),options.decouple||!Stratus.Catalog[options.target].collection?(data=new collection({target:options.target}),options.decouple||(Stratus.Catalog[options.target].collection=data)):Stratus.Catalog[options.target].collection&&(data=Stratus.Catalog[options.target].collection);options.api&&data.meta.set("api",_.isJSON(options.api)?JSON.parse(options.api):options.api)}return angular.isObject(data)&&("undefined"!=typeof $scope&&($scope.data=data,data instanceof model?$scope.model=data:data instanceof collection&&($scope.collection=data)),data.pending||data.completed||data.fetch()),data}}})}]});