//     Stratus.Services.Registry.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,a){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.collection","stratus.services.model"],a):a(t.Stratus,t._)}(this,function(t,a){t.Services.Registry=["$provide",function(e){e.factory("registry",function(e,i){return function(){this.fetch=function(r,o){angular.isString(r)&&(r={target:r});var n,g={target:r.attr?r.attr("data-target"):r.target,id:r.attr?r.attr("data-id"):r.id,manifest:r.attr?r.attr("data-manifest"):r.manifest,decouple:r.attr?r.attr("data-decouple"):r.decouple,api:r.attr?r.attr("data-api"):r.api};if(g.target){if(g.manifest||g.id){t.Catalog[g.target]||(t.Catalog[g.target]={});var l=g.id||"manifest";g.decouple||!t.Catalog[g.target][l]?(n=new i({target:g.target,manifest:g.manifest},{id:g.id}),g.decouple||(t.Catalog[g.target][l]=n)):t.Catalog[g.target][l]&&(n=t.Catalog[g.target][l])}else t.Catalog[g.target]||(t.Catalog[g.target]={}),g.decouple||!t.Catalog[g.target].collection?(n=new e({target:g.target}),g.decouple||(t.Catalog[g.target].collection=n)):t.Catalog[g.target].collection&&(n=t.Catalog[g.target].collection);g.api&&n.meta.set("api",a.isJSON(g.api)?JSON.parse(g.api):g.api)}return angular.isObject(n)&&("undefined"!=typeof o&&(o.data=n,n instanceof i?o.model=n:n instanceof e&&(o.collection=n)),n.pending||n.completed||n.fetch()),n}}})}]});