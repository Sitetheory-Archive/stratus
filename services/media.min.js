!function(e,n){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],n):n(e.Stratus,e._)}(this,function(e,n){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload",function(e,r,t,i){function a(n,t,i){return r({url:i,method:t,data:n}).then(function(n){return e.resolve(n)},function(n){return e.reject(n)})}function o(e,r){var t="//app.sitetheory.io:3000/?session="+n.cookie("SITETHEORY")+(r?"&id="+r:"");return i.upload({url:t,method:"POST",data:{AWSAccessKeyId:"AKIAIX32Y3S7HCX4BSQA",key:e.name,acl:"private",policy:"ewogICJleHBpcmF0aW9uIjogIjIwMjAtMDEtMDFUMDA6MDA6MDBaIiwKICAiY29uZGl0aW9ucyI6IFsKICAgIHsiYnVja2V0IjogInNpdGV0aGVvcnljb3JlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAiIl0sCiAgICB7ImFjbCI6ICJwcml2YXRlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRDb250ZW50LVR5cGUiLCAiIl0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRmaWxlbmFtZSIsICIiXSwKICAgIFsiY29udGVudC1sZW5ndGgtcmFuZ2UiLCAwLCA1MjQyODgwMDBdCiAgXQp9",signature:"5bz7ETqEC0Gxj1vJP/a6t3DRMJc=","Content-Type":""!=e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}var u="/Api/Tag",l="/Api/Media";return{dragenter:function(e){$("#main").addClass("blurred")},dragleave:function(e){$("#main").removeClass("blurred")},createTag:function(e){return a(e,"POST",u)},uploadToS3:o,deleteMedia:function(e){return a(null,"DELETE",l+"/"+e)},updateMedia:function(e,n){return a(n,"PUT",l+"/"+e)},getMedia:function(e){return e.collection.fetch()},fileUploader:function(e,n){return e.errorMsg=null,e.errorUpload=!1,e.progress=0,e.upload=o(e,n),e.upload.then(function(n){e.result=n.data,e.errorUpload=!1},function(n){e.errorUpload=!0,!0===n.config.data.file.upload.aborted?e.errorMsg="Aborted":e.errorMsg="Server Error! Please try again"}),e.upload.progress(function(n){e.progress=0===n.total?0:Math.min(100,parseInt(100*n.loaded/n.total))}),e},saveMediaUrl:function(e){return a(e,"POST",l)},fetchOneMedia:function(e){return a(null,"GET",l+"/"+e)}}}])}]});