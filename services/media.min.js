!function(e,t){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],t):t(e.Stratus,e._)}(this,function(e,t){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload",function(e,n,o,i){function r(t,o,i){return n({url:i,method:o,data:t}).then(function(t){return e.resolve(t)},function(t){return e.reject(t)})}function a(e,n){var o="//app.sitetheory.io:3000/?session="+t.cookie("SITETHEORY")+(n?"&id="+n:"");return i.upload({url:o,method:"POST",data:{AWSAccessKeyId:"AKIAIX32Y3S7HCX4BSQA",key:e.name,acl:"private",policy:"ewogICJleHBpcmF0aW9uIjogIjIwMjAtMDEtMDFUMDA6MDA6MDBaIiwKICAiY29uZGl0aW9ucyI6IFsKICAgIHsiYnVja2V0IjogInNpdGV0aGVvcnljb3JlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAiIl0sCiAgICB7ImFjbCI6ICJwcml2YXRlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRDb250ZW50LVR5cGUiLCAiIl0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRmaWxlbmFtZSIsICIiXSwKICAgIFsiY29udGVudC1sZW5ndGgtcmFuZ2UiLCAwLCA1MjQyODgwMDBdCiAgXQp9",signature:"5bz7ETqEC0Gxj1vJP/a6t3DRMJc=","Content-Type":""!=e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}var l="/Api/Tag",u="/Api/Media";return{dragenter:function(e){$("#main").addClass("blurred")},dragleave:function(e){$("#main").removeClass("blurred")},createTag:function(e){return r(e,"POST",l)},uploadToS3:a,deleteMedia:function(e){return r(null,"DELETE",u+"/"+e)},updateMedia:function(e,t){return r(t,"PUT",u+"/"+e)},getMedia:function(e){return e.collection.fetch()},fileUploader:function(e,t){return e.errorMsg=null,e.errorUpload=!1,e.progress=0,e.upload=a(e,t),e.upload.then(function(t){e.result=t.data,e.errorUpload=!1},function(t){e.errorUpload=!0,!0===t.config.data.file.upload.aborted?e.errorMsg="Aborted":e.errorMsg="Server Error! Please try again"}),e.upload.progress(function(t){e.progress=0===t.total?0:Math.min(100,parseInt(100*t.loaded/t.total))}),e},openUploader:function(e,n,i,r){o.show({attachTo:angular.element(document.querySelector("#listContainer")),controller:function(e,t,n,o){e.collection=t,e.ngfMultiple=n,e.fileId=o},template:'<stratus-media-uploader collection="collection" ngf-multiple="ngfMultiple" file-id="fileId"></stratus-media-uploader>',clickOutsideToClose:!1,focusOnOpen:!0,autoWrap:!0,multiple:!0,locals:{collection:e.collection,ngfMultiple:n,fileId:i}}).then(function(e){i&&!t.isEmpty(e)&&r.$emit("uploadSuccess",e)})},saveMediaUrl:function(e){return r(e,"POST",u)}}}])}]});