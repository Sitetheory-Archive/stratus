!function(e,n){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","stratus.services.utility"],n):n(e.Stratus,e._,e.jQuery,e.angular)}(this,function(e,n,t,o){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload","utility",function(e,o,a,r,i){let u="/Api/Tag",l="/Api/Media";return{dragenter:function(e){t("#main").addClass("blurred")},dragleave:function(e){t("#main").removeClass("blurred")},createTag:function(e){return console.warn("Using a non-model API call!"),i.sendRequest(e,"POST",u)},uploadToS3:d,deleteMedia:function(e){return console.warn("Using a non-model API call!"),i.sendRequest(null,"DELETE",l+"/"+e)},updateMedia:function(e,n){return console.warn("Using a non-model API call!"),i.sendRequest(n,"PUT",l+"/"+e)},getMedia:function(e){let n=e.collection.meta.data.pagination.pageCurrent;if(null==n)return e.collection.fetch();return e.collection.page(n)},fileUploader:function(e,n){return e.errorMsg=null,e.errorUpload=!1,e.progress=0,e.upload=d(e,n),e.upload.then(function(n){e.result=n.data,e.errorUpload=!1},function(n){e.errorUpload=!0,e.errorMsg=n.config.data.file.upload.aborted?"Aborted":"Server Error! Please try again"}),e.upload.progress(function(n){e.progress=0===n.total?0:Math.min(100,parseInt(100*n.loaded/n.total))}),e},saveMediaUrl:function(e){return console.warn("Using a non-model API call!"),i.sendRequest(e,"POST",l)},fetchOneMedia:function(e){return console.warn("Using a non-model API call!"),i.sendRequest(null,"GET",l+"/"+e)},getThumbnailImgOfVideo:function(e){return"youtube"===e.service?"https://img.youtube.com/vi/"+s(e.url)+"/0.jpg":"vimeo"===e.service&&e.meta.thumbnail_medium?e.meta.thumbnail_medium:"https://img.youtube.com/vi/default.jpg"},getYouTubeID:s};function d(e,t){let o="//app.sitetheory.io:3000/?session="+n.cookie("SITETHEORY")+(t?"&id="+t:"");return r.upload({url:o,method:"POST",data:{key:e.name,acl:"private","Content-Type":""!==e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}function s(e){let n=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);return n&&11===n[7].length?n[7]:""}}])}]});