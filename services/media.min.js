!function(e,n){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.commonMethods"],n):n(e.Stratus,e._)}(this,function(e,n){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload","commonMethods",function(e,t,r,a,i){var o="/Api/Tag",u="/Api/Media";return{dragenter:function(e){$("#main").addClass("blurred")},dragleave:function(e){$("#main").removeClass("blurred")},createTag:function(e){return i.sendRequest(e,"POST",o)},uploadToS3:d,deleteMedia:function(e){return i.sendRequest(null,"DELETE",u+"/"+e)},updateMedia:function(e,n){return i.sendRequest(n,"PUT",u+"/"+e)},getMedia:function(e){return e.collection.fetch()},fileUploader:function(e,n){return e.errorMsg=null,e.errorUpload=!1,e.progress=0,e.upload=d(e,n),e.upload.then(function(n){e.result=n.data,e.errorUpload=!1},function(n){e.errorUpload=!0,!0===n.config.data.file.upload.aborted?e.errorMsg="Aborted":e.errorMsg="Server Error! Please try again"}),e.upload.progress(function(n){e.progress=0===n.total?0:Math.min(100,parseInt(100*n.loaded/n.total))}),e},saveMediaUrl:function(e){return i.sendRequest(e,"POST",u)},fetchOneMedia:function(e){return i.sendRequest(null,"GET",u+"/"+e)}};function d(e,t){var r="//app.sitetheory.io:3000/?session="+n.cookie("SITETHEORY")+(t?"&id="+t:"");return a.upload({url:r,method:"POST",data:{AWSAccessKeyId:"AKIAIX32Y3S7HCX4BSQA",key:e.name,acl:"private",policy:"ewogICJleHBpcmF0aW9uIjogIjIwMjAtMDEtMDFUMDA6MDA6MDBaIiwKICAiY29uZGl0aW9ucyI6IFsKICAgIHsiYnVja2V0IjogInNpdGV0aGVvcnljb3JlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAiIl0sCiAgICB7ImFjbCI6ICJwcml2YXRlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRDb250ZW50LVR5cGUiLCAiIl0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRmaWxlbmFtZSIsICIiXSwKICAgIFsiY29udGVudC1sZW5ndGgtcmFuZ2UiLCAwLCA1MjQyODgwMDBdCiAgXQp9",signature:"5bz7ETqEC0Gxj1vJP/a6t3DRMJc=","Content-Type":""!=e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}}])}]});