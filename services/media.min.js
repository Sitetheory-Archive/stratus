!function(e,n){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],n):n(e.Stratus,e._)}(this,function(e,n){e.Services.Media=["$provide",function(o){o.factory("media",["$q","$http","$mdDialog","Upload",function(o,t,a,r){var l="/Api/Tag";return{dragenter:function(e){$("#main").addClass("blurred")},dragleave:function(e){$("#main").removeClass("blurred")},createTag:function(e){return t({url:l,method:"POST",data:e}).then(function(e){return o.resolve(e)},function(e){return o.reject(e)})},uploadToS3:x,DialogController:function(e,t){e.files=t,e.done=function(){a.hide(),media.dragleave()},e.cancel=function(){a.cancel(),media.dragleave()},e.addFiles=function(n){n.length>0&&(e.files=Array.from(e.files).concat(n))},e.removeFiles=function(o){e.files=n.without(e.files,o)},e.$watch("files",function(e,n){if(null!==e&&e!=n){for(var t=[],a=0;a<e.length;a++)t.push(i(e[a]));t.length>0&&o.all(t).then(function(e){$scope.collection.fetch().then(function(e){console.log(e)})},function(e){console.log(e)})}})}};function x(e){return r.upload({url:"https://xxxxxxxxxxxxxxxxxx.s3.amazonaws.com/",method:"POST",data:{key:e.name,AWSAccessKeyId:"AKIAIX32Y3S7HCX4BSQA",acl:"private",policy:"xxxxxxxxxxxxxxxxxxxxxxxxxx",signature:"xxxxxxxxxxxxxxxxxxxxxxxxxxxx","Content-Type":""!=e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}function i(n){return e.Environment.get("production")||console.log(["savemedia"],n),n.errorMsg=null,n.uploadStatus=!1,n.errorUpload=!1,n.upload=x(n),n.upload.then(function(e){n.result=e.data,n.uploadStatus=!0,n.errorUpload=!1,$scope.infoId=null,$scope.imageSrc=n.result.url},function(e){!0===e.config.data.file.upload.aborted?(n.uploadStatus=!1,n.errorUpload=!0,n.errorMsg="Aborted"):(n.uploadStatus=!1,n.errorUpload=!0,n.errorMsg="Server Error! Please try again")}),n.upload.progress(function(e){n.progress=Math.min(100,parseInt(100*e.loaded/e.total))}),n.upload}}])}]});