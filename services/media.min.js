!function(e,t){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","stratus.services.utility"],t):t(e.Stratus,e._,e.jQuery,e.angular)}(this,function(e,u,d,t){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload","utility",function(e,t,r,n,a){var o="/Api/Media";return{dragenter:function(e){d("#main").addClass("blurred")},dragleave:function(e){d("#main").removeClass("blurred")},createTag:function(e){return a.sendRequest(e,"POST","/Api/Tag")},uploadToS3:i,deleteMedia:function(e){return a.sendRequest(null,"DELETE",o+"/"+e)},updateMedia:function(e,t){return a.sendRequest(t,"PUT",o+"/"+e)},getMedia:function(e){var t=e.collection.meta.data.pagination.pageCurrent;return null==t?e.collection.fetch():e.collection.page(t)},fileUploader:function(t,e){return t.errorMsg=null,t.errorUpload=!1,t.progress=0,t.upload=i(t,e),t.upload.then(function(e){t.result=e.data,t.errorUpload=!1},function(e){(t.errorUpload=!0)===e.config.data.file.upload.aborted?t.errorMsg="Aborted":t.errorMsg="Server Error! Please try again"}),t.upload.progress(function(e){t.progress=0===e.total?0:Math.min(100,parseInt(100*e.loaded/e.total))}),t},saveMediaUrl:function(e){return a.sendRequest(e,"POST",o)},fetchOneMedia:function(e){return a.sendRequest(null,"GET",o+"/"+e)}};function i(e,t){var r="//app.sitetheory.io:3000/?session="+u.cookie("SITETHEORY")+(t?"&id="+t:"");return n.upload({url:r,method:"POST",data:{key:e.name,acl:"private","Content-Type":""!==e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}}])}]});