!function(e,r){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],r):r(e.Stratus,e._)}(this,function(e,r){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload",function(e,n,t,a){function i(r,t,a){return n({url:a,method:t,data:r}).then(function(r){return e.resolve(r)},function(r){return e.reject(r)})}function o(e,n){var t="//app.sitetheory.io:3000/?session="+r.cookie("SITETHEORY")+(n?"&id="+n:"");return a.upload({url:t,method:"POST",data:{AWSAccessKeyId:"AKIAIX32Y3S7HCX4BSQA",key:e.name,acl:"private",policy:"ewogICJleHBpcmF0aW9uIjogIjIwMjAtMDEtMDFUMDA6MDA6MDBaIiwKICAiY29uZGl0aW9ucyI6IFsKICAgIHsiYnVja2V0IjogInNpdGV0aGVvcnljb3JlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAiIl0sCiAgICB7ImFjbCI6ICJwcml2YXRlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRDb250ZW50LVR5cGUiLCAiIl0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRmaWxlbmFtZSIsICIiXSwKICAgIFsiY29udGVudC1sZW5ndGgtcmFuZ2UiLCAwLCA1MjQyODgwMDBdCiAgXQp9",signature:"5bz7ETqEC0Gxj1vJP/a6t3DRMJc=","Content-Type":""!=e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}var u="/Api/Tag",d="/Api/Media";return{dragenter:function(e){$("#main").addClass("blurred")},dragleave:function(e){$("#main").removeClass("blurred")},createTag:function(e){return i(e,"POST",u)},uploadToS3:o,deleteMedia:function(e){return i(null,"DELETE",d+"/"+e)},updateMedia:function(e,r){return i(r,"PUT",d+"/"+e)},getMedia:function(e){return e.collection.fetch()},fileUploader:function(e,r){return e.errorMsg=null,e.errorUpload=!1,e.progress=0,e.upload=o(e,r),e.upload.then(function(r){e.result=r.data,e.errorUpload=!1},function(r){e.errorUpload=!0,!0===r.config.data.file.upload.aborted?e.errorMsg="Aborted":e.errorMsg="Server Error! Please try again"}),e.upload.progress(function(r){e.progress=0===r.total?0:Math.min(100,parseInt(100*r.loaded/r.total))}),e},saveMediaUrl:function(e){return i(e,"POST",d)}}}])}]});