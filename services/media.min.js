!function(e,n){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.commonMethods"],n):n(e.Stratus,e._)}(this,function(e,d){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload","commonMethods",function(e,n,t,r,a){var i="/Api/Tag",o="/Api/Media";return{dragenter:function(e){$("#main").addClass("blurred")},dragleave:function(e){$("#main").removeClass("blurred")},createTag:function(e){return a.sendRequest(e,"POST",i)},uploadToS3:u,deleteMedia:function(e){return a.sendRequest(null,"DELETE",o+"/"+e)},updateMedia:function(e,n){return a.sendRequest(n,"PUT",o+"/"+e)},getMedia:function(e){return e.collection.fetch()},fileUploader:function(n,e){return n.errorMsg=null,n.errorUpload=!1,n.progress=0,n.upload=u(n,e),n.upload.then(function(e){n.result=e.data,n.errorUpload=!1},function(e){(n.errorUpload=!0)===e.config.data.file.upload.aborted?n.errorMsg="Aborted":n.errorMsg="Server Error! Please try again"}),n.upload.progress(function(e){n.progress=0===e.total?0:Math.min(100,parseInt(100*e.loaded/e.total))}),n},saveMediaUrl:function(e){return a.sendRequest(e,"POST",o)},fetchOneMedia:function(e){return a.sendRequest(null,"GET",o+"/"+e)}};function u(e,n){var t="//app.sitetheory.io:3000/?session="+d.cookie("SITETHEORY")+(n?"&id="+n:"");return r.upload({url:t,method:"POST",data:{AWSAccessKeyId:"AKIAIX32Y3S7HCX4BSQA",key:e.name,acl:"private",policy:"ewogICJleHBpcmF0aW9uIjogIjIwMjAtMDEtMDFUMDA6MDA6MDBaIiwKICAiY29uZGl0aW9ucyI6IFsKICAgIHsiYnVja2V0IjogInNpdGV0aGVvcnljb3JlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRrZXkiLCAiIl0sCiAgICB7ImFjbCI6ICJwcml2YXRlIn0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRDb250ZW50LVR5cGUiLCAiIl0sCiAgICBbInN0YXJ0cy13aXRoIiwgIiRmaWxlbmFtZSIsICIiXSwKICAgIFsiY29udGVudC1sZW5ndGgtcmFuZ2UiLCAwLCA1MjQyODgwMDBdCiAgXQp9",signature:"5bz7ETqEC0Gxj1vJP/a6t3DRMJc=","Content-Type":""!=e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}}])}]});