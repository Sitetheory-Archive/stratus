!function(e,n){"function"==typeof define&&define.amd?define(["stratus","underscore","angular"],n):n(e.Stratus,e._)}(this,function(e,n){e.Services.Media=["$provide",function(o){o.factory("media",["$q","$http","$mdDialog","Upload",function(o,t,a,r){function l(e){return r.upload({url:"https://xxxxxxxxxxxxxxxxxx.s3.amazonaws.com/",method:"POST",data:{key:e.name,AWSAccessKeyId:"AKIAIX32Y3S7HCX4BSQA",acl:"private",policy:"xxxxxxxxxxxxxxxxxxxxxxxxxx",signature:"xxxxxxxxxxxxxxxxxxxxxxxxxxxx","Content-Type":""!=e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}var x="/Api/Tag";return{dragenter:function(e){$("#main").addClass("blurred")},dragleave:function(e){$("#main").removeClass("blurred")},createTag:function(e){return t({url:x,method:"POST",data:e}).then(function(e){return o.resolve(e)},function(e){return o.reject(e)})},uploadToS3:l,DialogController:function(t,r){t.files=r,t.done=function(){a.hide(),media.dragleave()},t.cancel=function(){a.cancel(),media.dragleave()},t.addFiles=function(e){e.length>0&&(t.files=Array.from(t.files).concat(e))},t.removeFiles=function(e){t.files=n.without(t.files,e)},t.$watch("files",function(n,t){if(null!==n&&n!=t){for(var a=[],r=0;r<n.length;r++)a.push(function(n){return e.Environment.get("production")||console.log(["savemedia"],n),n.errorMsg=null,n.uploadStatus=!1,n.errorUpload=!1,n.upload=l(n),n.upload.then(function(e){n.result=e.data,n.uploadStatus=!0,n.errorUpload=!1,$scope.infoId=null,$scope.imageSrc=n.result.url},function(e){!0===e.config.data.file.upload.aborted?(n.uploadStatus=!1,n.errorUpload=!0,n.errorMsg="Aborted"):(n.uploadStatus=!1,n.errorUpload=!0,n.errorMsg="Server Error! Please try again")}),n.upload.progress(function(e){n.progress=Math.min(100,parseInt(100*e.loaded/e.total))}),n.upload}(n[r]));a.length>0&&o.all(a).then(function(e){$scope.collection.fetch().then(function(e){console.log(e)})},function(e){console.log(e)})}})}}}])}]});