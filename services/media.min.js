!function(e,r){"function"==typeof define&&define.amd?define(["stratus","underscore","jquery","angular","stratus.services.commonMethods"],r):r(e.Stratus,e._,e.jQuery,e.angular)}(this,function(e,u,d,r){e.Services.Media=["$provide",function(e){e.factory("media",["$q","$http","$mdDialog","Upload","commonMethods",function(e,r,t,n,a){var o="/Api/Media";return{dragenter:function(e){d("#main").addClass("blurred")},dragleave:function(e){d("#main").removeClass("blurred")},createTag:function(e){return a.sendRequest(e,"POST","/Api/Tag")},uploadToS3:i,deleteMedia:function(e){return a.sendRequest(null,"DELETE",o+"/"+e)},updateMedia:function(e,r){return a.sendRequest(r,"PUT",o+"/"+e)},getMedia:function(e){var r=e.collection.meta.data.pagination.pageCurrent;return null==r?e.collection.fetch():e.collection.page(r)},fileUploader:function(r,e){return r.errorMsg=null,r.errorUpload=!1,r.progress=0,r.upload=i(r,e),r.upload.then(function(e){r.result=e.data,r.errorUpload=!1},function(e){(r.errorUpload=!0)===e.config.data.file.upload.aborted?r.errorMsg="Aborted":r.errorMsg="Server Error! Please try again"}),r.upload.progress(function(e){r.progress=0===e.total?0:Math.min(100,parseInt(100*e.loaded/e.total))}),r},saveMediaUrl:function(e){return a.sendRequest(e,"POST",o)},fetchOneMedia:function(e){return a.sendRequest(null,"GET",o+"/"+e)}};function i(e,r){var t="//app.sitetheory.io:3000/?session="+u.cookie("SITETHEORY")+(r?"&id="+r:"");return n.upload({url:t,method:"POST",data:{key:e.name,acl:"private","Content-Type":""!==e.type?e.type:"application/octet-stream",filename:e.name,file:e}})}}])}]});