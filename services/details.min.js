!function(t,e){"function"==typeof define&&define.amd?define(["stratus","underscore","angular","stratus.services.model"],e):e(t.Stratus,t._)}(this,function(t,c){t.Services.Details=["$provide",function(t){t.factory("details",["$http","Model","$interpolate","$q",function(a,t,o,e){return function(){this.fetch=function(n,s){var a=this;return new e(function(e,t){angular.isString(n)&&(n={target:n});var r={selectedId:n.attr?n.attr("data-selectedId"):n.selectedId,property:n.attr?n.attr("data-property"):n.property},i=0;s.$watch(function(){return i},function(t){c.isNumber(t)&&parseInt(t)===c.size(r)&&e(a.build(r,s))}),c.each(r,function(t,e){if(t&&angular.isString(t)){var n=o(t,!1,null,!0),a=n(s.$parent);angular.isDefined(a)?(r[e]=a,i++):s.$watch(function(){return n(s.$parent)},function(t){t&&(r[e]=t,i++)})}else i++})})},this.build=function(t,e){if(t.selectedId){var n;"version.layout"===t.property&&(n="/Api/Layout/"+t.selectedId),"version.template"===t.property&&(n="/Api/Template/"+t.selectedId);a({method:"GET",url:n,headers:{}}).then(function(t){200===t.status&&angular.isObject(t.data)&&(e.convoyDetails=t.data.payload||t.data,e.selectedName=e.convoyDetails.name,e.selectedDesc=e.convoyDetails.description)})}}}}])}]});