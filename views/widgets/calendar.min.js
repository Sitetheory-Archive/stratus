//     Stratus.Views.Widgets.Calendar.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(e,t){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","moment","stratus.views.widgets.base","fullcalendar"],t):t(e.Stratus,e.$,e._,e.moment)}(this,function(e,t,n,i){e.Views.Widgets.Calendar=e.Views.Widgets.Base.extend({model:e.Models.Generic,template:n.template(""),url:"/Api/",options:{"private":{requiredCssFile:[e.BaseUrl+"sitetheorystratus/stratus/bower_components/fullcalendar/dist/fullcalendar.min.css"]},"public":{customButtons:null,buttonIcons:{prev:"left-single-arrow",next:"right-single-arrow",prevYear:"left-double-arrow",nextYear:"right-double-arrow"},header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},defaultDate:null,nowIndicator:!1,timezone:!1,eventForceAllDay:!1,eventLimit:!1,eventLimitClick:"popover",fixedWeekCount:!1,firstDay:0,weekends:!0,hiddenDays:[],weekNumbers:!1,weekNumberCalculation:"local",businessHours:!1,RTLmode:!1,height:null,contentHeight:null,aspectRatio:1.35,handleWindowResize:!0,windowResizeDelay:100}},initialRequest:!0,startRange:i(),endRange:i(),onRender:function(e){var t=this;return t.$el.fullCalendar({customButtons:t.options.customButtons,buttonIcons:t.options.buttonIcons,header:t.options.header,defaultDate:t.options.defaultDate,nowIndicator:t.options.nowIndicator,timezone:t.options.timezone,eventLimit:t.options.eventLimit,eventLimitClick:t.options.eventLimitClick,fixedWeekCount:t.options.fixedWeekCount,firstDay:t.options.firstDay,weekends:t.options.weekends,hiddenDays:t.options.hiddenDays,weekNumbers:t.options.weekNumbers,weekNumberCalculation:t.options.weekNumberCalculation,businessHours:t.options.businessHours,isRTL:t.options.RTLmode,height:t.options.height,contentHeight:t.options.contentHeight,aspectRatio:t.options.aspectRatio,handleWindowResize:t.options.handleWindowResize,windowResizeDelay:t.options.windowResizeDelay,events:function(e,n,i,o){t.startRange<=e&&(e=null),t.endRange>=n&&(n=null),null!=e&&null!=n?(t.startRange=e,t.endRange=n):null==e&&null!=n?(e=t.endRange,t.endRange=n):null==n&&null!=e&&(n=t.startRange,t.startRange=e),t.initialRequest||null==e||null==n?(o(t.parseEvents()),t.initialRequest=!1):(t.collection.once("success",function(){console.log("Calendar fetch data: ",e.format(),n.format()),o(t.parseEvents())}),t.collection.meta.set("api.startRange",e.format("X")),t.collection.meta.set("api.endRange",n.format("X")),t.collection.refresh())}}),!0},parseEvents:function(e){var t=this,o=[];return n.each(t.collection.toJSON().payload,function(e){e.viewVersion?o.push({id:e.id,title:e.viewVersion.title,start:i.unix(e.viewVersion.timeCustom||e.viewVersion.timePublish||e.time).format(),end:t.options.eventForceAllDay&&e.viewVersion.meta.allDay||!e.viewVersion.meta.timeEnd?null:i.unix(e.viewVersion.meta.timeEnd).format(),url:e.routingPrimary.url,allDay:t.options.eventForceAllDay||e.viewVersion.meta.allDay}):o.push({id:e.id,title:e.name,start:i.unix(e.time).format(),url:"//"+e.url+(e.extension?"."+e.extension:null),allDay:t.options.eventForceAllDay})}),e&&e(o),o}})});