//     Stratus.Views.Widgets.Autocomplete.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(i,e){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","stratus.views.widgets.base","selectize"],e):e(i.Stratus,i.$,i._)}(this,function(i,e,t){i.Views.Widgets.Autocomplete=i.Views.Widgets.Base.extend({model:i.Models.Generic,template:t.template('<div><span class="title"><span class="name">{{ model.id }}</span></span></div>'),url:"/Api/",options:{"private":{requiredCssFile:[i.BaseUrl+"sitetheorycore/css/sitetheory.selectize.css"],selectize:{preload:!0,delimiter:null,plugins:null,items:null,valueField:"id",labelField:"id",searchField:["id"],maxItems:1,create:!0,persist:!1},api:{limit:null}},"public":{target:null}},promise:function(e,s,n){this.$el.dataAttr("entity")&&this.$el.dataAttr("id")&&(this.options.forceType="model"),t.contains(this.options.selectize.plugins,"drag_drop")?require(["jquery-ui"],function(){i.Views.Widgets.Base.prototype.promise.call(this,e,s,n)}.bind(this)):i.Views.Widgets.Base.prototype.promise.call(this,e,s,n)},render:function(i){this.$el.selectize(this.options.selectize),this.initial=this.initial||{request:!0,load:!0};var e=this;return this.$el[0].selectize.on("load",function(){e.initial.load&&null!==e.options.selectize.items&&e.options.selectize.items.length>0&&(e.initial.load=!1,t.each(e.options.selectize.items,function(i){if(!t.has(this.options,i)){var s={};s[e.options.selectize.valueField]=i,s[e.options.selectize.labelField]=i,this.addOption(s)}this.setValue([i])},this))}),this},postOptions:function(i){null!==this.options.target&&(this.url="/Api/"+this.options.target+"/"),this.options.selectize.render={option:function(i,e){return this.template({model:i,options:this.options})}.bind(this)},this.options.selectize.load=function(i,t){return i.length||this.initial.request?(this.initial.request=!1,void e.ajax({url:this.url+"?query="+i+"&"+e.param({options:this.options.api}),type:"GET",error:function(){t()},success:function(i){t(i.payload)}})):t()}.bind(this)}})});