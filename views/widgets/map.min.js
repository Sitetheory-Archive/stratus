//     Stratus.Views.Widgets.Map.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,o){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","stratus.views.widgets.base","//maps.googleapis.com/maps/api/js?key="+Stratus.Api.GoogleMaps],o):o(t.Stratus,t.$,t._)}(this,function(t,o,i){t.Views.Widgets.Map=t.Views.Widgets.Base.extend({location:null,map:null,tile:256,project:function(t){var o=Math.sin(t.lat()*Math.PI/180);return o=Math.min(Math.max(o,-.9999),.9999),new google.maps.Point(this.tile*(.5+t.lng()/360),this.tile*(.5-Math.log((1+o)/(1-o))/(4*Math.PI)))},createInfoWindowContent:function(t,o){var i=1<<o,n=this.project(t),e=new google.maps.Point(Math.floor(n.x*i),Math.floor(n.y*i)),a=new google.maps.Point(Math.floor(n.x*i/this.tile),Math.floor(n.y*i/this.tile)),s=[];return this.error?s.push("Error: "+this.error):s=["Lat/Lng: "+t,"Zoom level: "+o,"World Coordinate: "+n,"Pixel Coordinate: "+e,"Tile Coordinate: "+a],s.join("<br>")},onRender:function(o){t.Internals.Location().done(function(t){this.location=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),this.displayMap()}.bind(this),function(t){this.error=t.message,this.location=new google.maps.LatLng(37.8988771,(-122.0591649)),this.displayMap()}.bind(this))},displayMap:function(){if(!this.location)return!1;this.map=new google.maps.Map(this.$el[0],{center:this.location,zoom:13});var t=new google.maps.InfoWindow;return t.setContent(this.createInfoWindowContent(this.location,this.map.getZoom())),t.setPosition(this.location),t.open(this.map),this.map.addListener("zoom_changed",function(){t.setContent(this.createInfoWindowContent(this.location,this.map.getZoom())),t.open(this.map)}.bind(this)),!0}})});