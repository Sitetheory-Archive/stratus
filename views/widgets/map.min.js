//     Stratus.Views.Widgets.Map.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,o){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","stratus.views.widgets.base"],o):o(t.Stratus,t.$,t._)}(this,function(t,o,i){t.Views.Widgets.Map=t.Views.Widgets.Base.extend({location:null,map:null,options:{"private":{},"public":{apiKey:t.Api.GoogleMaps,tile:256,zoom:13}},project:function(t){var o=Math.sin(t.lat()*Math.PI/180);return o=Math.min(Math.max(o,-.9999),.9999),new google.maps.Point(this.options.tile*(.5+t.lng()/360),this.options.tile*(.5-Math.log((1+o)/(1-o))/(4*Math.PI)))},onRender:function(o){require(["//maps.googleapis.com/maps/api/js?key="+this.options.apiKey],function(){t.Internals.Location().done(function(t){this.location=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),this.displayMap()}.bind(this),function(t){this.error=t.message,this.location=new google.maps.LatLng(37.8988771,(-122.0591649)),this.displayMap()}.bind(this))}.bind(this))},createInfoWindowContent:function(){var t=1<<(this.map?this.map.getZoom():this.options.zoom),o=this.project(this.location),i=new google.maps.Point(Math.floor(o.x*t),Math.floor(o.y*t)),n=new google.maps.Point(Math.floor(o.x*t/this.options.tile),Math.floor(o.y*t/this.options.tile)),e=[];return this.error?e.push("Error: "+this.error):e=["Lat/Lng: "+this.location,"Zoom level: "+(this.map?this.map.getZoom():this.options.zoom),"World Coordinate: "+o,"Pixel Coordinate: "+i,"Tile Coordinate: "+n],e.join("<br>")},createInfoWindow:function(t,o){var i=new google.maps.InfoWindow;o instanceof String?i.setContent(o):o instanceof Function&&i.setContent(o.call(this)),i.setPosition(t),i.open(this.map),this.map.addListener("zoom_changed",function(){o instanceof String?i.setContent(o):o instanceof Function&&i.setContent(o.call(this)),i.open(this.map)}.bind(this))},displayMap:function(){return!!this.location&&(this.map=new google.maps.Map(this.$el[0],{center:this.location,zoom:this.options.zoom}),this.createInfoWindow(this.location,this.createInfoWindowContent),!0)}})});