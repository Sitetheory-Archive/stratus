//     Stratus.Views.Widgets.Map.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,o){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","stratus.views.widgets.base","//maps.googleapis.com/maps/api/js?key="+Stratus.Api.GoogleMaps],o):o(t.Stratus,t.$,t._)}(this,function(t,o,n){t.Views.Widgets.Map=t.Views.Widgets.Base.extend({location:null,map:null,tile:256,project:function(t){var o=Math.sin(t.lat()*Math.PI/180);return o=Math.min(Math.max(o,-.9999),.9999),new google.maps.Point(this.tile*(.5+t.lng()/360),this.tile*(.5-Math.log((1+o)/(1-o))/(4*Math.PI)))},createInfoWindowContent:function(t,o){var n=1<<o,e=this.project(t),i=new google.maps.Point(Math.floor(e.x*n),Math.floor(e.y*n)),a=new google.maps.Point(Math.floor(e.x*n/this.tile),Math.floor(e.y*n/this.tile));return["Lat/Lng: "+t,"Zoom level: "+o,"World Coordinate: "+e,"Pixel Coordinate: "+i,"Tile Coordinate: "+a].join("<br>")},onRender:function(o){t.Internals.Location().done(function(t){this.location=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),this.map=new google.maps.Map(this.$el[0],{center:this.location,zoom:13});var o=new google.maps.InfoWindow;o.setContent(this.createInfoWindowContent(this.location,this.map.getZoom())),o.setPosition(this.location),o.open(this.map),this.map.addListener("zoom_changed",function(){o.setContent(this.createInfoWindowContent(this.location,this.map.getZoom())),o.open(this.map)}.bind(this))}.bind(this),function(t){console.error("Location:",t.message)})}})});