//     Stratus.Views.Plugins.Carousel.js 1.0
//     Copyright (c) 2016 by Sitetheory, All Rights Reserved
//
//     All information contained herein is, and remains the
//     property of Sitetheory and its suppliers, if any.
//     The intellectual and technical concepts contained herein
//     are proprietary to Sitetheory and its suppliers and may be
//     covered by U.S. and Foreign Patents, patents in process,
//     and are protected by trade secret or copyright law.
//     Dissemination of this information or reproduction of this
//     material is strictly forbidden unless prior written
//     permission is obtained from Sitetheory.
//
//     For full details and documentation:
//     http://docs.sitetheory.io
!function(t,e){"function"==typeof define&&define.amd?define(["stratus","jquery","underscore","bootstrap","stratus.views.plugins.base"],e):e(t.Stratus,t.$,t._)}(this,function(t,e,a){t.Views.Plugins.Carousel=t.Views.Plugins.Base.extend({initialize:function(e){this.prepare(e);var a=this.$el.find(".carousel-inner > .item");if(t.Client.mobile&&this.$el.dataAttr("groupmobile")?this.batchItems(this.$el.dataAttr("groupmobile"),a):this.$el.dataAttr("group")&&this.batchItems(this.$el.dataAttr("group"),a),this.$el.carousel({interval:this.$el.dataAttr("interval")||5e3,pause:this.$el.dataAttr("pause")||"hover",wrap:this.$el.dataAttr("wrap")||!0,keyboard:this.$el.dataAttr("keyboard")||!0}),this.$el.on("slid.bs.carousel",function(){t.Environment.get("viewPortChange")===!1&&t.Environment.set("viewPortChange",!0)}),this.$el.dataAttr("startonscreen")!==!1){this.$el.carousel("pause");var s=this;this.onScreen=new t.Views.Plugins.OnScreen({el:this.el,onScreen:function(){s.$el.carousel("cycle")},offScreen:function(){s.$el.carousel("pause")}})}},batchItems:function(t,s){t=t<=0?1:t;var i=Math.round(12/t),n=this.$el.dataAttr("colminsize")?this.$el.dataAttr("colminsize"):"xs";if(t>1){var r=this.$el.find(".carousel-inner");r.empty()}var l=!1;a.each(s,function(s,o){if(t>1){var c,d=0,h=r.children(".item");h.length>0&&(c=e(a.last(h)),d=c.children(".nestedItem").length),(!d||d>=t)&&(c=e('<div class="item"></div>'),r.append(c)),e(s).removeClass("item").addClass("nestedItem col-"+n+"-"+i),c.append(e(s)),e(s).hasClass("active")&&(l=!0,c.addClass("active"))}else e(s).hasClass("active")&&(l=!0)}.bind(this)),l||e(a.first(this.$el.find(".carousel-inner .item"))).addClass("active");var o=e("[data-lazysrc]");o.length>0&&a.each(o,function(t){e(t).attr("data-src",e(t).attr("data-lazysrc")).attr("data-lazysrc",null)})}})});