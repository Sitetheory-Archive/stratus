!function(e,t){"function"==typeof define&&define.amd?define(["stratus","zepto","underscore","bootstrap","stratus.views.plugins.base","stratus.views.plugins.onscreen"],t):t(e.Stratus,e.$,e._)}(this,function(e,t,s){e.Views.Plugins.Carousel=e.Views.Plugins.Base.extend({initialize:function(t){this.prepare(t);var s=this.$el.find(".carousel-inner > .item");if(e.Client.mobile&&this.$el.dataAttr("groupmobile")?this.batchItems(this.$el.dataAttr("groupmobile"),s):this.$el.dataAttr("group")&&this.batchItems(this.$el.dataAttr("group"),s),this.$el.carousel({interval:this.$el.dataAttr("interval")||5e3,pause:this.$el.dataAttr("pause")||"hover",wrap:this.$el.dataAttr("wrap")||!0,keyboard:this.$el.dataAttr("keyboard")||!0}),this.$el.on("slid.bs.carousel",function(){e.Environment.get("viewPortChange")===!1&&e.Environment.set("viewPortChange",!0)}),this.$el.dataAttr("startonscreen")!==!1){this.$el.carousel("pause");var i=this;this.onScreen=new e.Views.Plugins.OnScreen({el:this.el,onScreen:function(){i.$el.carousel("cycle")},offScreen:function(){i.$el.carousel("pause")}})}},batchItems:function(e,i){e=e<=0?1:e;var a=Math.round(12/e),n=this.$el.dataAttr("colminsize")?this.$el.dataAttr("colminsize"):"xs";if(e>1){var r=this.$el.find(".carousel-inner");r.empty()}var l=!1;s.each(i,function(i,o){if(e>1){var c,d=0,h=r.children(".item");h.length>0&&(c=t(s.last(h)),d=c.children(".nestedItem").length),(!d||d>=e)&&(c=t('<div class="item"></div>'),r.append(c)),t(i).removeClass("item").addClass("nestedItem col-"+n+"-"+a),c.append(t(i)),t(i).hasClass("active")&&(l=!0,c.addClass("active"))}else t(i).hasClass("active")&&(l=!0)}.bind(this)),l||t(s.first(this.$el.find(".carousel-inner .item"))).addClass("active")}})});